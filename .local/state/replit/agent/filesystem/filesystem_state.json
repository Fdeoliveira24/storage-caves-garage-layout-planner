{"file_contents":{"css/main.css":{"content":"/* Main CSS - Imports all component styles */\n@import url('reset.css');\n@import url('variables.css');\n@import url('layout.css');\n@import url('components/toolbar.css');\n@import url('components/sidebar.css');\n@import url('components/canvas.css');\n@import url('components/info-panel.css');\n@import url('components/modal.css');\n@import url('responsive.css');\n@import url('mobile-redesign.css');\n\n/* Additional global styles */\n.hidden {\n  display: none !important;\n}\n\n.loading {\n  opacity: 0.5;\n  pointer-events: none;\n}\n","size_bytes":517},"js/managers/ItemManager.js":{"content":"/* global Items, Helpers */\n\n/**\n * Item Manager\n * Handles item library and CRUD operations\n */\nclass ItemManager {\n  constructor(state, eventBus, canvasManager) {\n    this.state = state;\n    this.eventBus = eventBus;\n    this.canvasManager = canvasManager;\n  }\n\n  /**\n   * Add item to canvas\n   */\n  addItem(itemId, x, y) {\n    const itemTemplate = Items.getById(itemId);\n    if (!itemTemplate) {\n      console.error('Item not found:', itemId);\n      return null;\n    }\n\n    // Default to viewport center if no position specified\n    if (x === undefined || y === undefined) {\n      const center = this.canvasManager.getViewportCenter();\n      x = center.x;\n      y = center.y;\n    }\n\n    // Create unique item data - preserve template id as itemId\n    const itemData = {\n      ...itemTemplate,\n      itemId: itemTemplate.id, // Preserve template ID for re-instantiation\n      id: Helpers.generateId('item'), // Unique instance ID\n      x: x,\n      y: y,\n      angle: 0,\n      locked: false,\n    };\n\n    // Add to canvas\n    const canvasGroup = this.canvasManager.addItem(itemData, x, y);\n\n    // Store reference to canvas object (now a group)\n    itemData.canvasObject = canvasGroup;\n\n    // Add to state\n    const items = this.state.get('items') || [];\n    items.push(itemData);\n    this.state.setState({ items });\n\n    // Emit event\n    this.eventBus.emit('item:added', itemData);\n\n    return itemData;\n  }\n\n  /**\n   * Remove item\n   */\n  removeItem(itemId) {\n    const items = this.state.get('items') || [];\n    const item = items.find((i) => i.id === itemId);\n\n    if (!item) return false;\n\n    // Remove from canvas\n    if (item.canvasObject) {\n      this.canvasManager.removeItem(item.canvasObject);\n    }\n\n    // Remove from state\n    const updatedItems = items.filter((i) => i.id !== itemId);\n    this.state.setState({ items: updatedItems });\n\n    // Emit event\n    this.eventBus.emit('item:removed', itemId);\n\n    return true;\n  }\n\n  /**\n   * Update item properties\n   */\n  updateItem(itemId, updates) {\n    const items = this.state.get('items') || [];\n    const itemIndex = items.findIndex((i) => i.id === itemId);\n\n    if (itemIndex === -1) return false;\n\n    // Update item\n    items[itemIndex] = { ...items[itemIndex], ...updates };\n    this.state.setState({ items });\n\n    // Emit event\n    this.eventBus.emit('item:updated', items[itemIndex]);\n\n    return true;\n  }\n\n  /**\n   * Get item by ID\n   */\n  getItem(itemId) {\n    const items = this.state.get('items') || [];\n    return items.find((i) => i.id === itemId);\n  }\n\n  /**\n   * Get all items\n   */\n  getAllItems() {\n    return this.state.get('items') || [];\n  }\n\n  /**\n   * Duplicate item\n   */\n  duplicateItem(itemId) {\n    const item = this.getItem(itemId);\n    if (!item) return null;\n\n    // Get current position from canvas object if available\n    let x = item.x + 20;\n    let y = item.y + 20;\n    let angle = item.angle || 0;\n\n    if (item.canvasObject) {\n      // Use Fabric's getCenterPoint() for accurate center even when rotated\n      const center = item.canvasObject.getCenterPoint();\n      x = center.x + 20;\n      y = center.y + 20;\n      angle = item.canvasObject.angle || 0;\n    }\n\n    // Create duplicate with offset (addItem expects center coordinates)\n    const newItem = this.addItem(item.itemId, x, y);\n\n    // Copy rotation\n    if (newItem && newItem.canvasObject && angle !== 0) {\n      newItem.canvasObject.rotate(angle);\n      this.canvasManager.getCanvas().renderAll();\n\n      // Update state to persist the angle\n      const items = this.state.get('items') || [];\n      const stateItem = items.find((i) => i.id === newItem.id);\n      if (stateItem) {\n        stateItem.angle = angle;\n        this.state.setState({ items });\n      }\n    }\n\n    return newItem;\n  }\n\n  /**\n   * Lock item\n   */\n  lockItem(itemId) {\n    const item = this.getItem(itemId);\n    if (!item) return false;\n\n    if (item.canvasObject) {\n      item.canvasObject.lockMovementX = true;\n      item.canvasObject.lockMovementY = true;\n      item.canvasObject.lockRotation = true;\n      item.canvasObject.lockScalingX = true;\n      item.canvasObject.lockScalingY = true;\n    }\n\n    return this.updateItem(itemId, { locked: true });\n  }\n\n  /**\n   * Unlock item\n   */\n  unlockItem(itemId) {\n    const item = this.getItem(itemId);\n    if (!item) return false;\n\n    if (item.canvasObject) {\n      item.canvasObject.lockMovementX = false;\n      item.canvasObject.lockMovementY = false;\n      item.canvasObject.lockRotation = false;\n      item.canvasObject.lockScalingX = false;\n      item.canvasObject.lockScalingY = false;\n    }\n\n    return this.updateItem(itemId, { locked: false });\n  }\n\n  /**\n   * Clear all items\n   */\n  clearAll() {\n    const items = this.getAllItems();\n    items.forEach((item) => this.removeItem(item.id));\n  }\n\n  /**\n   * Get item library\n   */\n  getItemLibrary() {\n    return Items.getAll();\n  }\n\n  /**\n   * Get items by category\n   */\n  getItemsByCategory(category) {\n    return Items.getByCategory(category);\n  }\n\n  /**\n   * Search items\n   */\n  searchItems(query) {\n    return Items.search(query);\n  }\n}\n\n// Make available globally\nif (typeof window !== 'undefined') {\n  window.ItemManager = ItemManager;\n}\n","size_bytes":5194},"docs/API.md":{"content":"# API Documentation\n\n## Public API Reference\n\nThis document describes the public API for the Garage Layout Planner application.\n\n## Global Objects\n\nThe application exposes the following global objects:\n\n```javascript\nwindow.app; // Main application instance\nwindow.Config; // Configuration constants\nwindow.State; // State class (not instance)\nwindow.EventBus; // EventBus class (not instance)\n```\n\n## App Instance\n\nAccess via `window.app` after initialization.\n\n### Properties\n\n```javascript\napp.state; // State instance\napp.eventBus; // EventBus instance\napp.canvasManager; // Canvas operations\napp.floorPlanManager; // Floor plan operations\napp.itemManager; // Item operations\napp.selectionManager; // Selection operations\napp.exportManager; // Export operations\napp.historyManager; // Undo/redo operations\n```\n\n### Methods\n\n```javascript\n// Initialize application\nawait app.init();\n\n// Get current state\nconst state = app.state.getState();\n\n// Subscribe to state changes\napp.state.subscribe((newState) => {\n  console.log('State changed:', newState);\n});\n\n// Listen to events\napp.eventBus.on('item:added', (item) => {\n  console.log('Item added:', item);\n});\n```\n\n## CanvasManager API\n\n### Methods\n\n```javascript\n// Initialize canvas\ncanvasManager.init();\n\n// Draw floor plan\ncanvasManager.drawFloorPlan(floorPlan);\n\n// Add item to canvas\nconst { rect, label } = canvasManager.addItem(itemData, x, y);\n\n// Remove item\ncanvasManager.removeItem(item);\n\n// Zoom controls\ncanvasManager.zoomIn();\ncanvasManager.zoomOut();\ncanvasManager.resetZoom();\n\n// Get canvas instance\nconst fabricCanvas = canvasManager.getCanvas();\n\n// Export as data URL\nconst dataURL = canvasManager.toDataURL({\n  multiplier: 2, // Resolution multiplier\n  format: 'png', // Format\n  quality: 1, // Quality (0-1)\n});\n\n// Clear canvas\ncanvasManager.clear();\n\n// Resize canvas\ncanvasManager.resizeCanvas();\n```\n\n## FloorPlanManager API\n\n### Methods\n\n```javascript\n// Set active floor plan\nfloorPlanManager.setFloorPlan('fp-24x30');\n\n// Get current floor plan\nconst floorPlan = floorPlanManager.getCurrentFloorPlan();\n\n// Get all floor plans\nconst allFloorPlans = floorPlanManager.getAllFloorPlans();\n\n// Get area calculations\nconst totalArea = floorPlanManager.getArea(); // sq ft\nconst occupiedArea = floorPlanManager.getOccupiedArea(); // sq ft\nconst occupancy = floorPlanManager.getOccupancyPercentage(); // %\n\n// Clear floor plan\nfloorPlanManager.clearFloorPlan();\n```\n\n## ItemManager API\n\n### Methods\n\n```javascript\n// Add item\nconst item = itemManager.addItem('sedan', 100, 100);\n\n// Remove item\nitemManager.removeItem(itemId);\n\n// Update item\nitemManager.updateItem(itemId, { x: 150, y: 150 });\n\n// Get item\nconst item = itemManager.getItem(itemId);\n\n// Get all items\nconst items = itemManager.getAllItems();\n\n// Duplicate item\nconst newItem = itemManager.duplicateItem(itemId);\n\n// Lock/unlock item\nitemManager.lockItem(itemId);\nitemManager.unlockItem(itemId);\n\n// Clear all items\nitemManager.clearAll();\n\n// Get item library\nconst library = itemManager.getItemLibrary();\n\n// Get items by category\nconst vehicles = itemManager.getItemsByCategory('vehicles');\n\n// Search items\nconst results = itemManager.searchItems('car');\n```\n\n## SelectionManager API\n\n### Methods\n\n```javascript\n// Select single item\nselectionManager.selectItem(item);\n\n// Select multiple items\nselectionManager.selectMultiple([item1, item2]);\n\n// Select all\nselectionManager.selectAll();\n\n// Deselect all\nselectionManager.deselectAll();\n\n// Get selection\nconst selected = selectionManager.getSelection();\n\n// Delete selected\nselectionManager.deleteSelected();\n\n// Duplicate selected\nselectionManager.duplicateSelected();\n\n// Rotate selected (degrees)\nselectionManager.rotateSelected(90);\n\n// Move selected (dx, dy in pixels)\nselectionManager.moveSelected(10, 0);\n\n// Align selected\nselectionManager.alignSelected('left'); // left|right|center|top|bottom|middle\n\n// Z-order\nselectionManager.bringToFront();\nselectionManager.sendToBack();\n```\n\n## ExportManager API\n\n### Methods\n\n```javascript\n// Export as JSON\nconst jsonData = exportManager.exportJSON();\n\n// Export as PNG\nconst dataURL = exportManager.exportPNG(2); // Resolution multiplier\n\n// Export as PDF\nawait exportManager.exportPDF({\n  orientation: 'landscape', // landscape|portrait\n  format: 'letter', // letter|a4|legal|tabloid\n});\n\n// Generate thumbnail\nconst thumbnailURL = exportManager.generateThumbnail(200, 150);\n\n// Calculate occupancy\nconst occupancyPercent = exportManager.calculateOccupancy();\n```\n\n## HistoryManager API\n\n### Methods\n\n```javascript\n// Save current state\nhistoryManager.save();\n\n// Undo\nconst previousState = historyManager.undo();\n\n// Redo\nconst nextState = historyManager.redo();\n\n// Check availability\nconst canUndo = historyManager.canUndo();\nconst canRedo = historyManager.canRedo();\n\n// Clear history\nhistoryManager.clear();\n\n// Get history info\nconst info = historyManager.getInfo();\n// Returns: { total, currentIndex, canUndo, canRedo }\n```\n\n## EventBus API\n\n### Event Names\n\n```javascript\n// Item events\n'item:added'; // {item}\n'item:removed'; // {itemId}\n'item:updated'; // {item}\n'item:selected'; // {item}\n'item:moved'; // {items}\n'item:rotated'; // {items}\n'item:delete:requested'; // {itemId}\n'item:duplicate:requested'; // {itemId}\n\n// Floor plan events\n'floorplan:changed'; // {floorPlan}\n'floorplan:cleared'; // {}\n\n// Selection events\n'canvas:selection:created'; // {items}\n'canvas:selection:updated'; // {items}\n'canvas:selection:cleared'; // {}\n\n// Canvas events\n'canvas:zoomed'; // {zoom}\n'canvas:object:moving'; // {item}\n'canvas:object:modified'; // {item}\n\n// History events\n'history:undo'; // {state}\n'history:redo'; // {state}\n'history:changed'; // {canUndo, canRedo}\n\n// Export events\n'export:json:complete'; // {filename}\n'export:png:complete'; // {filename, resolution}\n'export:pdf:complete'; // {filename}\n\n// Tool events\n'tool:measure:activated'; // {}\n'tool:measure:deactivated'; // {}\n'tool:measure:complete'; // {distance, unit}\n\n// State events\n'state:changed'; // {state}\n```\n\n### Methods\n\n```javascript\n// Subscribe to event\neventBus.on('item:added', (data) => {\n  console.log('Item added:', data);\n});\n\n// Unsubscribe from event\neventBus.off('item:added', callback);\n\n// Subscribe once (auto-unsubscribe after first call)\neventBus.once('item:added', (data) => {\n  console.log('First item added:', data);\n});\n\n// Emit event\neventBus.emit('custom:event', { data: 'value' });\n\n// Clear all listeners\neventBus.clear();\n\n// Get registered events\nconst events = eventBus.getEvents();\n```\n\n## State API\n\n### Methods\n\n```javascript\n// Get complete state\nconst state = stateInstance.getState();\n\n// Update state\nstateInstance.setState({\n  settings: {\n    unit: 'meters',\n  },\n});\n\n// Get specific property\nconst unit = stateInstance.get('settings.unit');\n\n// Set specific property\nstateInstance.set('settings.unit', 'feet');\n\n// Subscribe to changes\nconst unsubscribe = stateInstance.subscribe((newState) => {\n  console.log('State updated:', newState);\n});\n\n// Unsubscribe\nunsubscribe();\n\n// Reset state\nstateInstance.reset();\n\n// Load state\nstateInstance.loadState(savedState);\n\n// Serialize to JSON\nconst json = stateInstance.toJSON();\n```\n\n## Utility Functions\n\n### Helpers\n\n```javascript\n// Unit conversion\nconst px = Helpers.feetToPx(10); // 100px (at 1ft=10px)\nconst ft = Helpers.pxToFeet(100); // 10ft\nconst m = Helpers.feetToMeters(10); // 3.048m\nconst ft2 = Helpers.metersToFeet(3.048); // 10ft\n\n// Formatting\nconst num = Helpers.formatNumber(10.12345, 2); // 10.12\n\n// ID generation\nconst id = Helpers.generateId('item'); // \"item-1636123456789-abc123\"\n\n// Debounce/Throttle\nconst debouncedFn = Helpers.debounce(fn, 300);\nconst throttledFn = Helpers.throttle(fn, 100);\n\n// Clone\nconst copy = Helpers.deepClone(object);\n\n// Download\nHelpers.downloadFile(data, 'filename.json', 'application/json');\n\n// Distance/Angle\nconst dist = Helpers.distance(x1, y1, x2, y2);\nconst angle = Helpers.angleBetweenPoints(x1, y1, x2, y2);\n\n// Clamp\nconst value = Helpers.clamp(num, 0, 100);\n```\n\n### Storage\n\n```javascript\n// Save to localStorage\nStorage.save('key', { data: 'value' });\n\n// Load from localStorage\nconst data = Storage.load('key');\n\n// Remove\nStorage.remove('key');\n\n// Check existence\nconst exists = Storage.has('key');\n\n// Clear all\nStorage.clear();\n\n// Get size\nconst size = Storage.getSize(); // bytes\n```\n\n### Bounds\n\n```javascript\n// Constrain to floor plan\nBounds.constrainToBounds(item, floorPlan);\n\n// Check if within bounds\nconst isInside = Bounds.isWithinBounds(item, floorPlan);\n\n// Check entry zone\nconst inEntryZone = Bounds.isInEntryZone(item, floorPlan);\n\n// Snap to grid\nBounds.snapItemToGrid(item, 10);\n\n// Check overlap\nconst overlaps = Bounds.itemsOverlap(item1, item2);\n\n// Find nearby items for snapping\nconst nearby = Bounds.findNearbyItems(item, allItems, 5);\n```\n\n### Validation\n\n```javascript\n// Validate floor plan\nconst result = Validation.validateFloorPlan(floorPlan);\n// Returns: { valid: boolean, errors: string[] }\n\n// Validate item\nconst result = Validation.validateItem(item);\n\n// Validate layout name\nconst result = Validation.validateLayoutName(name);\n\n// Sanitize HTML\nconst safe = Validation.sanitizeHTML(userInput);\n\n// Validate number in range\nconst valid = Validation.validateNumber(value, 0, 100);\n```\n\n## Configuration\n\n### Constants\n\n```javascript\nConfig.PX_PER_FOOT; // 10\nConfig.GRID_SIZE; // 10\nConfig.MAX_HISTORY; // 50\nConfig.AUTOSAVE_INTERVAL; // 30000\nConfig.ENTRY_ZONE_PERCENTAGE; // 0.2\nConfig.NUDGE_DISTANCE; // 2\nConfig.NUDGE_DISTANCE_LARGE; // 10\nConfig.MAGNIFIER_ZOOM; // 2.5\nConfig.MAGNIFIER_SIZE; // 150\nConfig.PDF_MARGINS; // 0.5\n\nConfig.COLORS = {\n  floorPlan: '#f0f0f0',\n  floorPlanStroke: '#333333',\n  grid: '#e0e0e0',\n  entryZone: 'rgba(255, 200, 0, 0.1)',\n  selection: '#2196F3',\n  alignmentGuide: '#FF5722',\n  dimension: '#666666',\n};\n\nConfig.STORAGE_KEYS = {\n  layouts: 'garage-planner-layouts',\n  settings: 'garage-planner-settings',\n  autosave: 'garage-planner-autosave',\n};\n```\n\n## Examples\n\n### Complete Example\n\n```javascript\n// Wait for app to initialize\ndocument.addEventListener('DOMContentLoaded', async () => {\n  const app = window.app;\n\n  // Set a floor plan\n  app.floorPlanManager.setFloorPlan('fp-24x30');\n\n  // Add some items\n  app.itemManager.addItem('sedan', 100, 100);\n  app.itemManager.addItem('suv', 200, 100);\n\n  // Listen to item additions\n  app.eventBus.on('item:added', (item) => {\n    console.log('Added:', item.label);\n  });\n\n  // Export as JSON\n  setTimeout(() => {\n    app.exportManager.exportJSON();\n  }, 2000);\n});\n```\n\n---\n\n**Version:** 1.0.0  \n**Last Updated:** November 2025\n","size_bytes":10643},"css/components/canvas.css":{"content":"/* Canvas Styles */\n.canvas-wrapper {\n  position: relative;\n  z-index: 1;\n  background:\n    linear-gradient(45deg, #f0f0f0 25%, transparent 25%),\n    linear-gradient(-45deg, #f0f0f0 25%, transparent 25%),\n    linear-gradient(45deg, transparent 75%, #f0f0f0 75%),\n    linear-gradient(-45deg, transparent 75%, #f0f0f0 75%);\n  background-size: 20px 20px;\n  background-position:\n    0 0,\n    0 10px,\n    10px -10px,\n    -10px 0;\n}\n\n.canvas-wrapper canvas {\n  position: relative;\n  z-index: 1;\n}\n\n#canvas {\n  display: block;\n}\n\n.canvas-overlay {\n  position: absolute;\n  inset: 0;\n  pointer-events: none;\n}\n\n.canvas-controls {\n  position: absolute;\n  bottom: var(--spacing-md);\n  right: var(--spacing-md);\n  display: flex;\n  flex-direction: column;\n  gap: var(--spacing-xs);\n}\n\n.canvas-controls .btn {\n  pointer-events: all;\n  background-color: white;\n  box-shadow: var(--shadow-md);\n}\n\n/* ================================\n   FABRIC.JS CONTROL CUSTOMIZATION\n   Professional Selection Handles\n   ================================ */\n\n/* Selection border styling */\n.canvas-container .upper-canvas {\n  outline: none;\n}\n\n/* Override Fabric.js default control styles with modern, professional look */\n.canvas-container canvas[class*='canvas'] {\n  outline: none;\n}\n","size_bytes":1253},"js/core/App.js":{"content":"/* global State, EventBus, CanvasManager, FloorPlanManager, ItemManager, SelectionManager, ExportManager, HistoryManager, Modal, Config, Items, Helpers, StorageUtil, Bounds */\n\n/**\n * Main Application Controller\n * Coordinates all managers and features\n */\nclass App {\n  constructor() {\n    this.state = null;\n    this.eventBus = null;\n    this.canvasManager = null;\n    this.floorPlanManager = null;\n    this.itemManager = null;\n    this.selectionManager = null;\n    this.exportManager = null;\n    this.historyManager = null;\n    this.mobileUIManager = null;\n    this.autosaveInterval = null;\n\n    // Cached DOM references for performance\n    this.entryZoneWarningBadge = null;\n    this.entryZoneCheckDebounce = null;\n  }\n\n  /**\n   * Initialize application\n   */\n  async init() {\n    // Initializing Garage Layout Planner...\n\n    // Initialize core\n    this.state = new State();\n    this.eventBus = new EventBus();\n\n    // Initialize canvas manager\n    this.canvasManager = new CanvasManager('canvas', this.state, this.eventBus);\n    this.canvasManager.init();\n\n    // Ensure viewport starts at default state\n    this.canvasManager.resetViewport();\n\n    // Initialize managers\n    this.floorPlanManager = new FloorPlanManager(this.state, this.eventBus, this.canvasManager);\n    this.itemManager = new ItemManager(this.state, this.eventBus, this.canvasManager);\n    this.selectionManager = new SelectionManager(this.state, this.eventBus, this.canvasManager);\n    this.exportManager = new ExportManager(this.state, this.eventBus, this.canvasManager);\n    this.historyManager = new HistoryManager(this.state, this.eventBus);\n\n    // Setup event listeners\n    this.setupEventListeners();\n\n    // Setup keyboard shortcuts\n    this.setupKeyboardShortcuts();\n\n    // Initialize UI\n    this.initializeUI();\n\n    // Initialize modern mobile UI (NEW - replaces old mobile features)\n    if (window.MobileUIManager) {\n      this.mobileUIManager = new MobileUIManager(this);\n      this.mobileUIManager.init();\n    } else {\n      // Fallback to legacy mobile features if MobileUIManager not available\n      this.setupMobileFeatures();\n    }\n\n    // Setup autosave\n    this.setupAutosave();\n\n    // Load last autosave if exists\n    const autosaveLoaded = this.loadAutosave();\n\n    // Show empty state only if no autosave was loaded\n    if (!autosaveLoaded) {\n      this.canvasManager.showEmptyState();\n    }\n\n    // Sync project name from state to UI\n    this.updateProjectName(this.state.get('metadata.projectName'));\n\n    // Check entry zone violations after load\n    this.checkEntryZoneViolations();\n\n    // Save initial state to history\n    this.historyManager.save();\n\n    // Application initialized successfully\n  }\n\n  /**\n   * Setup event listeners\n   */\n  setupEventListeners() {\n    // Canvas events\n    this.eventBus.on('canvas:object:modified', (obj) => {\n      // Update item position in state when moved\n      // obj.left and obj.top are already center coords due to originX/Y: 'center'\n      if (obj && obj.customData && obj.customData.id) {\n        this.updateItemPosition(obj.customData.id, obj.left, obj.top, obj.angle || 0);\n      }\n      this.historyManager.save();\n\n      // Check entry zone violations (debounced to avoid thrashing during drags)\n      this.debouncedCheckEntryZone();\n    });\n\n    // Item events\n    this.eventBus.on('item:added', () => {\n      this.historyManager.save();\n      this.updateInfoPanel();\n      this.checkEntryZoneViolations();\n    });\n\n    this.eventBus.on('item:removed', () => {\n      this.historyManager.save();\n      this.updateInfoPanel();\n      this.checkEntryZoneViolations();\n    });\n\n    this.eventBus.on('item:delete:requested', (itemId) => {\n      this.itemManager.removeItem(itemId);\n    });\n\n    this.eventBus.on('item:duplicate:requested', (itemId) => {\n      this.itemManager.duplicateItem(itemId);\n      this.checkEntryZoneViolations();\n    });\n\n    this.eventBus.on('item:paste:requested', (itemData) => {\n      // Add pasted item with offset (x,y are already center coordinates from copySelected)\n      const newItem = this.itemManager.addItem(itemData.itemId, itemData.x + 20, itemData.y + 20);\n      if (newItem && newItem.canvasObject) {\n        newItem.canvasObject.rotate(itemData.angle);\n        this.canvasManager.getCanvas().renderAll();\n      }\n      this.checkEntryZoneViolations();\n    });\n\n    // Import item from JSON\n    this.eventBus.on('item:add:imported', (itemData) => {\n      const newItem = this.itemManager.addItem(itemData.itemId, itemData.x, itemData.y);\n      if (newItem && newItem.canvasObject) {\n        newItem.canvasObject.rotate(itemData.angle || 0);\n        if (itemData.locked) {\n          newItem.canvasObject.set({ lockMovementX: true, lockMovementY: true });\n        }\n        this.canvasManager.getCanvas().renderAll();\n      }\n    });\n\n    // Items cleared (for import)\n    this.eventBus.on('items:cleared', () => {\n      this.canvasManager.clearItems();\n      this.updateInfoPanel();\n      this.checkEntryZoneViolations();\n    });\n\n    // Floor plan loaded (for import)\n    this.eventBus.on('floorplan:loaded', (floorPlan) => {\n      this.canvasManager.drawFloorPlan(floorPlan);\n      this.canvasManager.redrawFloorPlan();\n      this.updateInfoPanel();\n    });\n\n    // Import completed - save to history after all items loaded\n    this.eventBus.on('import:json:complete', () => {\n      this.historyManager.save();\n      this.updateInfoPanel();\n      this.checkEntryZoneViolations();\n    });\n\n    // Floor plan events\n    this.eventBus.on('floorplan:changed', () => {\n      this.historyManager.save();\n      this.updateInfoPanel();\n      this.checkEntryZoneViolations();\n    });\n\n    // Selection events\n    this.eventBus.on('canvas:selection:created', () => {\n      this.updateInfoPanel();\n    });\n\n    this.eventBus.on('canvas:selection:updated', () => {\n      this.updateInfoPanel();\n    });\n\n    this.eventBus.on('canvas:selection:cleared', () => {\n      this.updateInfoPanel();\n    });\n\n    // Rotation event (from keyboard 'R' or desktop rotate button)\n    this.eventBus.on('items:rotated', () => {\n      this.historyManager.save();\n    });\n\n    // History events\n    this.eventBus.on('history:undo', () => {\n      this.refreshCanvas();\n      this.renderFloorPlanList();\n      this.renderSavedLayouts();\n      this.updateInfoPanel();\n      this.syncViewDropdownUI();\n    });\n\n    this.eventBus.on('history:redo', () => {\n      this.refreshCanvas();\n      this.renderFloorPlanList();\n      this.renderSavedLayouts();\n      this.updateInfoPanel();\n      this.syncViewDropdownUI();\n    });\n\n    // Zoom events\n    this.eventBus.on('canvas:zoomed', (zoom) => {\n      this.updateZoomDisplay(zoom);\n    });\n  }\n\n  /**\n   * Setup keyboard shortcuts\n   */\n  setupKeyboardShortcuts() {\n    document.addEventListener('keydown', (e) => {\n      // Ignore if typing in input\n      if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {\n        return;\n      }\n\n      const ctrl = e.ctrlKey || e.metaKey;\n\n      // Delete/Backspace\n      if (e.key === 'Delete' || e.key === 'Backspace') {\n        e.preventDefault();\n        this.selectionManager.deleteSelected();\n      }\n\n      // Ctrl+Z - Undo\n      if (ctrl && e.key === 'z') {\n        e.preventDefault();\n        this.historyManager.undo();\n      }\n\n      // Ctrl+Y - Redo\n      if (ctrl && e.key === 'y') {\n        e.preventDefault();\n        this.historyManager.redo();\n      }\n\n      // Ctrl+D - Duplicate\n      if (ctrl && e.key === 'd') {\n        e.preventDefault();\n        this.selectionManager.duplicateSelected();\n      }\n\n      // Ctrl+A - Select All\n      if (ctrl && e.key === 'a') {\n        e.preventDefault();\n        this.selectionManager.selectAll();\n      }\n\n      // Ctrl+C - Copy\n      if (ctrl && e.key === 'c') {\n        e.preventDefault();\n        this.selectionManager.copySelected();\n      }\n\n      // Ctrl+V - Paste\n      if (ctrl && e.key === 'v') {\n        e.preventDefault();\n        this.selectionManager.pasteSelected();\n      }\n\n      // Esc - Deselect\n      if (e.key === 'Escape') {\n        this.selectionManager.deselectAll();\n      }\n\n      // R - Rotate 90°\n      if (e.key === 'r' || e.key === 'R') {\n        e.preventDefault();\n        this.selectionManager.rotateSelected(90);\n      }\n\n      // Arrow keys - Nudge\n      const nudge = e.shiftKey ? Config.NUDGE_DISTANCE_LARGE : Config.NUDGE_DISTANCE;\n\n      if (e.key === 'ArrowLeft') {\n        e.preventDefault();\n        this.selectionManager.moveSelected(-nudge, 0);\n      }\n      if (e.key === 'ArrowRight') {\n        e.preventDefault();\n        this.selectionManager.moveSelected(nudge, 0);\n      }\n      if (e.key === 'ArrowUp') {\n        e.preventDefault();\n        this.selectionManager.moveSelected(0, -nudge);\n      }\n      if (e.key === 'ArrowDown') {\n        e.preventDefault();\n        this.selectionManager.moveSelected(0, nudge);\n      }\n    });\n  }\n\n  /**\n   * Initialize UI\n   */\n  initializeUI() {\n    this.renderFloorPlanList();\n    this.renderItemPalette();\n    this.updateInfoPanel();\n    this.setupToolbarHandlers();\n    this.setupTabSwitching();\n    this.syncViewDropdownUI();\n  }\n\n  /**\n   * Sync View dropdown UI with current settings\n   */\n  syncViewDropdownUI() {\n    // Update grid toggle text\n    const showGrid = this.state.get('settings.showGrid');\n    const gridToggleText = document.getElementById('grid-toggle-text');\n    if (gridToggleText) {\n      gridToggleText.textContent = showGrid ? 'Hide Grid' : 'Show Grid';\n    }\n\n    // Update entry zone position buttons visibility\n    const entryZonePosition = this.state.get('settings.entryZonePosition') || 'bottom';\n    const entryZoneTopBtn = document.getElementById('btn-entry-zone-top');\n    const entryZoneBottomBtn = document.getElementById('btn-entry-zone-bottom');\n    const entryZoneLeftBtn = document.getElementById('btn-entry-zone-left');\n    const entryZoneRightBtn = document.getElementById('btn-entry-zone-right');\n\n    // Hide all position buttons first\n    if (entryZoneTopBtn) entryZoneTopBtn.style.display = 'none';\n    if (entryZoneBottomBtn) entryZoneBottomBtn.style.display = 'none';\n    if (entryZoneLeftBtn) entryZoneLeftBtn.style.display = 'none';\n    if (entryZoneRightBtn) entryZoneRightBtn.style.display = 'none';\n\n    // Show only the buttons for OTHER positions\n    if (entryZonePosition === 'top') {\n      if (entryZoneBottomBtn) entryZoneBottomBtn.style.display = 'block';\n      if (entryZoneLeftBtn) entryZoneLeftBtn.style.display = 'block';\n      if (entryZoneRightBtn) entryZoneRightBtn.style.display = 'block';\n    } else if (entryZonePosition === 'bottom') {\n      if (entryZoneTopBtn) entryZoneTopBtn.style.display = 'block';\n      if (entryZoneLeftBtn) entryZoneLeftBtn.style.display = 'block';\n      if (entryZoneRightBtn) entryZoneRightBtn.style.display = 'block';\n    } else if (entryZonePosition === 'left') {\n      if (entryZoneTopBtn) entryZoneTopBtn.style.display = 'block';\n      if (entryZoneBottomBtn) entryZoneBottomBtn.style.display = 'block';\n      if (entryZoneRightBtn) entryZoneRightBtn.style.display = 'block';\n    } else if (entryZonePosition === 'right') {\n      if (entryZoneTopBtn) entryZoneTopBtn.style.display = 'block';\n      if (entryZoneBottomBtn) entryZoneBottomBtn.style.display = 'block';\n      if (entryZoneLeftBtn) entryZoneLeftBtn.style.display = 'block';\n    }\n\n    // Update entry label toggle text\n    const showEntryLabel = this.state.get('settings.showEntryZoneLabel') !== false;\n    const entryLabelToggleText = document.getElementById('entry-label-toggle-text');\n    if (entryLabelToggleText) {\n      entryLabelToggleText.textContent = showEntryLabel ? 'Hide Entry Label' : 'Show Entry Label';\n    }\n\n    // Update entry border toggle text\n    const showEntryBorder = this.state.get('settings.showEntryZoneBorder') !== false;\n    const entryBorderToggleText = document.getElementById('entry-border-toggle-text');\n    if (entryBorderToggleText) {\n      entryBorderToggleText.textContent = showEntryBorder\n        ? 'Hide Entry Border'\n        : 'Show Entry Border';\n    }\n\n    // Update labels toggle text\n    const showItemLabels = this.state.get('settings.showItemLabels') !== false;\n    const labelsToggleText = document.getElementById('labels-toggle-text');\n    if (labelsToggleText) {\n      labelsToggleText.textContent = showItemLabels ? 'Hide Labels' : 'Show Labels';\n    }\n  }\n\n  /**\n   * Setup tab switching\n   */\n  setupTabSwitching() {\n    const tabs = document.querySelectorAll('.sidebar-tab');\n    tabs.forEach((tab) => {\n      tab.addEventListener('click', () => {\n        // Remove active from all tabs\n        tabs.forEach((t) => t.classList.remove('active'));\n\n        // Add active to clicked tab\n        tab.classList.add('active');\n\n        // Hide all tab contents\n        document.getElementById('floorplan-tab').classList.add('hidden');\n        document.getElementById('items-tab').classList.add('hidden');\n        document.getElementById('saved-tab').classList.add('hidden');\n\n        // Show selected tab content\n        const tabName = tab.dataset.tab;\n        if (tabName === 'floorplans') {\n          document.getElementById('floorplan-tab').classList.remove('hidden');\n        } else if (tabName === 'items') {\n          document.getElementById('items-tab').classList.remove('hidden');\n        } else if (tabName === 'saved') {\n          document.getElementById('saved-tab').classList.remove('hidden');\n          this.renderSavedLayouts();\n        }\n      });\n    });\n  }\n\n  /**\n   * Render floor plan list\n   */\n  renderFloorPlanList() {\n    const container = document.getElementById('floorplan-list');\n    if (!container) return;\n\n    const floorPlans = this.floorPlanManager.getAllFloorPlans();\n    const currentId = this.state.get('floorPlan')?.id;\n\n    container.innerHTML = floorPlans\n      .map(\n        (fp) => `\n      <div class=\"floorplan-item ${currentId === fp.id ? 'selected' : ''}\" data-id=\"${fp.id}\">\n        <div class=\"floorplan-name\">${fp.name}</div>\n        <div class=\"floorplan-info\">${fp.description}</div>\n        <div class=\"floorplan-area\">${fp.area} sq ft</div>\n      </div>\n    `,\n      )\n      .join('');\n\n    // Add click handlers\n    container.querySelectorAll('.floorplan-item').forEach((item) => {\n      item.addEventListener('click', () => {\n        const id = item.dataset.id;\n        this.floorPlanManager.setFloorPlan(id);\n        // Refresh floor plan list to update selected state\n        this.renderFloorPlanList();\n      });\n    });\n  }\n\n  /**\n   * Render item palette\n   */\n  renderItemPalette() {\n    const container = document.getElementById('item-palette');\n    if (!container) return;\n\n    const categories = Items.getCategoryNames();\n\n    container.innerHTML = categories\n      .map((catName) => {\n        const category = Items.categories[catName];\n        return `\n          <div class=\"item-category\">\n            <div class=\"category-name\">${category.name}</div>\n            <div class=\"category-items\">\n              ${category.items\n                .map((item) => {\n                  const hasImage = Config.USE_IMAGES && item.paletteImage;\n                  if (hasImage) {\n                    return `\n                      <div class=\"palette-item\" data-id=\"${item.id}\" style=\"background-color: ${item.color}20; border-color: ${item.color}\">\n                        <img src=\"${item.paletteImage}\" loading=\"lazy\" decoding=\"async\" class=\"item-preview\" style=\"display:block;max-width:60px;margin:auto;\">\n                        <div class=\"item-label\">${item.label}</div>\n                        <div class=\"item-size\">${item.lengthFt}' × ${item.widthFt}'</div>\n                      </div>\n                    `;\n                  }\n                  return `\n                    <div class=\"palette-item\" data-id=\"${item.id}\" style=\"background-color: ${item.color}20; border-color: ${item.color}\">\n                      <div class=\"item-label\">${item.label}</div>\n                      <div class=\"item-size\">${item.lengthFt}' × ${item.widthFt}'</div>\n                    </div>\n                  `;\n                })\n                .join('')}\n            </div>\n          </div>\n        `;\n      })\n      .join('');\n\n    // Make items draggable\n    container.querySelectorAll('.palette-item').forEach((item) => {\n      item.addEventListener('click', () => {\n        const itemId = item.dataset.id;\n        const floorPlan = this.state.get('floorPlan');\n\n        if (!floorPlan) {\n          Modal.showInfo('Please select a floor plan first');\n          return;\n        }\n\n        // Add item to center of canvas\n        const centerX = Helpers.feetToPx(floorPlan.widthFt) / 2;\n        const centerY = Helpers.feetToPx(floorPlan.heightFt) / 2;\n\n        this.itemManager.addItem(itemId, centerX, centerY);\n      });\n    });\n  }\n\n  /**\n   * Setup toolbar handlers\n   */\n  setupToolbarHandlers() {\n    // Rename project\n    const renameBtn = document.getElementById('btn-rename-project');\n    if (renameBtn) {\n      renameBtn.addEventListener('click', async () => {\n        const currentName = this.state.get('metadata.projectName') || 'Untitled Layout';\n        const newName = await Modal.showPrompt(\n          'Rename Project',\n          'Enter project name:',\n          currentName,\n        );\n\n        if (newName && newName.trim() !== '') {\n          // Delegate to updateProjectName helper to keep behavior consistent\n          this.updateProjectName(newName.trim());\n          Modal.showSuccess('Project renamed successfully');\n        }\n      });\n    }\n\n    // New layout\n    const newBtn = document.getElementById('btn-new');\n    if (newBtn) {\n      newBtn.addEventListener('click', async () => {\n        const confirmed = await Modal.showConfirm(\n          'Start New Layout?',\n          'Any unsaved changes will be lost. Are you sure?',\n        );\n        if (confirmed) {\n          console.log('[App] Starting new layout');\n\n          // Clear everything\n          this.state.reset();\n          this.canvasManager.clear();\n\n          // Clear history stack to prevent undoing back to old layout\n          this.historyManager.clear();\n\n          // CRITICAL: Clear autosave from localStorage immediately\n          StorageUtil.remove(Config.STORAGE_KEYS.autosave);\n          console.log('[App] Cleared autosave from localStorage');\n\n          // Ensure viewport is reset (clear() already does this, but be explicit)\n          this.canvasManager.resetViewport();\n\n          // Show empty state\n          this.canvasManager.showEmptyState();\n\n          // Reset project name in DOM and document title\n          this.updateProjectName('Untitled Layout');\n\n          this.renderFloorPlanList();\n          this.updateInfoPanel();\n          Modal.showSuccess('New layout started');\n        }\n      });\n    }\n\n    // Undo\n    const undoBtn = document.getElementById('btn-undo');\n    if (undoBtn) {\n      undoBtn.addEventListener('click', () => this.historyManager.undo());\n    }\n\n    // Redo\n    const redoBtn = document.getElementById('btn-redo');\n    if (redoBtn) {\n      redoBtn.addEventListener('click', () => this.historyManager.redo());\n    }\n\n    // Delete\n    const deleteBtn = document.getElementById('btn-delete');\n    if (deleteBtn) {\n      deleteBtn.addEventListener('click', () => this.selectionManager.deleteSelected());\n    }\n\n    // Duplicate\n    const duplicateBtn = document.getElementById('btn-duplicate');\n    if (duplicateBtn) {\n      duplicateBtn.addEventListener('click', () => this.selectionManager.duplicateSelected());\n    }\n\n    // Rotate\n    const rotateBtn = document.getElementById('btn-rotate');\n    if (rotateBtn) {\n      rotateBtn.addEventListener('click', () => this.selectionManager.rotateSelected(90));\n    }\n\n    // Export JSON\n    const exportJsonBtn = document.getElementById('btn-export-json');\n    if (exportJsonBtn) {\n      exportJsonBtn.addEventListener('click', () => this.exportManager.exportJSON());\n    }\n\n    // Export PNG\n    const exportPngBtn = document.getElementById('btn-export-png');\n    if (exportPngBtn) {\n      exportPngBtn.addEventListener('click', () => this.exportManager.exportPNG(4));\n    }\n\n    // Export PDF\n    const exportPdfBtn = document.getElementById('btn-export-pdf');\n    if (exportPdfBtn) {\n      exportPdfBtn.addEventListener('click', () => this.exportManager.exportPDF());\n    }\n\n    // Share via Email\n    const shareEmailBtn = document.getElementById('btn-share-email');\n    if (shareEmailBtn) {\n      shareEmailBtn.addEventListener('click', () => this.shareViaEmail());\n    }\n\n    // Import JSON\n    const importJsonBtn = document.getElementById('btn-import-json');\n    const jsonFileInput = document.getElementById('json-file-input');\n    if (importJsonBtn && jsonFileInput) {\n      importJsonBtn.addEventListener('click', () => {\n        jsonFileInput.click();\n      });\n\n      jsonFileInput.addEventListener('change', async (e) => {\n        const file = e.target.files[0];\n        if (file) {\n          try {\n            await this.exportManager.importJSON(file);\n            // Clear the input so the same file can be imported again\n            jsonFileInput.value = '';\n          } catch (error) {\n            console.error('Import failed:', error);\n          }\n        }\n      });\n    }\n\n    // Save\n    const saveBtn = document.getElementById('btn-save');\n    if (saveBtn) {\n      saveBtn.addEventListener('click', () => this.saveLayout());\n    }\n\n    // Zoom controls\n    const zoomSlider = document.getElementById('zoom-slider');\n    const zoomSliderValue = document.getElementById('zoom-slider-value');\n\n    if (zoomSlider && zoomSliderValue) {\n      zoomSlider.addEventListener('input', (e) => {\n        const zoomPercent = parseInt(e.target.value);\n        zoomSliderValue.textContent = `${zoomPercent}%`;\n        this.canvasManager.setZoomPercent(zoomPercent);\n      });\n    }\n\n    const zoomResetBtn = document.getElementById('btn-zoom-reset');\n    if (zoomResetBtn) {\n      zoomResetBtn.addEventListener('click', () => this.canvasManager.resetZoom());\n    }\n\n    // Z-order\n    const bringFrontBtn = document.getElementById('btn-bring-front');\n    if (bringFrontBtn) {\n      bringFrontBtn.addEventListener('click', () => this.selectionManager.bringToFront());\n    }\n\n    const sendBackBtn = document.getElementById('btn-send-back');\n    if (sendBackBtn) {\n      sendBackBtn.addEventListener('click', () => this.selectionManager.sendToBack());\n    }\n\n    // View controls\n    const toggleGridBtn = document.getElementById('btn-toggle-grid');\n    if (toggleGridBtn) {\n      toggleGridBtn.addEventListener('click', () => {\n        this.canvasManager.toggleGrid();\n        const showGrid = this.state.get('settings.showGrid');\n        document.getElementById('grid-toggle-text').textContent = showGrid\n          ? 'Hide Grid'\n          : 'Show Grid';\n      });\n    }\n\n    // Entry zone position handlers\n    const entryZoneTopBtn = document.getElementById('btn-entry-zone-top');\n    const entryZoneBottomBtn = document.getElementById('btn-entry-zone-bottom');\n    const entryZoneLeftBtn = document.getElementById('btn-entry-zone-left');\n    const entryZoneRightBtn = document.getElementById('btn-entry-zone-right');\n\n    if (entryZoneTopBtn) {\n      entryZoneTopBtn.addEventListener('click', () => {\n        this.state.set('settings.entryZonePosition', 'top');\n        this.canvasManager.redrawFloorPlan();\n        this.syncViewDropdownUI();\n      });\n    }\n\n    if (entryZoneBottomBtn) {\n      entryZoneBottomBtn.addEventListener('click', () => {\n        this.state.set('settings.entryZonePosition', 'bottom');\n        this.canvasManager.redrawFloorPlan();\n        this.syncViewDropdownUI();\n      });\n    }\n\n    if (entryZoneLeftBtn) {\n      entryZoneLeftBtn.addEventListener('click', () => {\n        this.state.set('settings.entryZonePosition', 'left');\n        this.canvasManager.redrawFloorPlan();\n        this.syncViewDropdownUI();\n      });\n    }\n\n    if (entryZoneRightBtn) {\n      entryZoneRightBtn.addEventListener('click', () => {\n        this.state.set('settings.entryZonePosition', 'right');\n        this.canvasManager.redrawFloorPlan();\n        this.syncViewDropdownUI();\n      });\n    }\n\n    const toggleEntryLabelBtn = document.getElementById('btn-toggle-entry-label');\n    if (toggleEntryLabelBtn) {\n      toggleEntryLabelBtn.addEventListener('click', () => {\n        const showLabel = this.state.get('settings.showEntryZoneLabel') !== false;\n        this.state.set('settings.showEntryZoneLabel', !showLabel);\n        this.canvasManager.redrawFloorPlan();\n        document.getElementById('entry-label-toggle-text').textContent = showLabel\n          ? 'Show Entry Label'\n          : 'Hide Entry Label';\n      });\n    }\n\n    const toggleEntryBorderBtn = document.getElementById('btn-toggle-entry-border');\n    if (toggleEntryBorderBtn) {\n      toggleEntryBorderBtn.addEventListener('click', () => {\n        const showBorder = this.state.get('settings.showEntryZoneBorder') !== false;\n        this.state.set('settings.showEntryZoneBorder', !showBorder);\n        this.canvasManager.redrawFloorPlan();\n        document.getElementById('entry-border-toggle-text').textContent = showBorder\n          ? 'Show Entry Border'\n          : 'Hide Entry Border';\n      });\n    }\n\n    const toggleLabelsBtn = document.getElementById('btn-toggle-labels');\n    if (toggleLabelsBtn) {\n      toggleLabelsBtn.addEventListener('click', () => {\n        const showLabels = this.state.get('settings.showItemLabels') !== false;\n        this.state.set('settings.showItemLabels', !showLabels);\n        document.getElementById('labels-toggle-text').textContent = showLabels\n          ? 'Show Labels'\n          : 'Hide Labels';\n        this.canvasManager.toggleItemLabels(!showLabels);\n      });\n    }\n  }\n\n  /**\n   * Update info panel - Inline horizontal format\n   */\n  updateInfoPanel() {\n    const panel = document.getElementById('info-panel');\n    if (!panel) return;\n\n    const floorPlan = this.state.get('floorPlan');\n    const items = this.state.get('items') || [];\n    const selection = this.selectionManager.getSelection();\n\n    const segments = [];\n\n    if (floorPlan) {\n      segments.push(`\n        <div class=\"info-bar__segment\">\n          <span class=\"info-bar__label\">Floor:</span>\n          <span class=\"info-bar__value\">${floorPlan.widthFt}' × ${floorPlan.heightFt}' (${floorPlan.area} sq ft)</span>\n        </div>\n      `);\n\n      segments.push(`\n        <div class=\"info-bar__segment\">\n          <span class=\"info-bar__label\">Items:</span>\n          <span class=\"info-bar__value\">${items.length}</span>\n        </div>\n      `);\n    } else {\n      segments.push('<div class=\"info-bar__placeholder\">Select a floor plan to begin</div>');\n    }\n\n    if (selection.length > 0) {\n      const item = selection[0];\n      const itemData = item.customData || {};\n\n      segments.push(`\n        <div class=\"info-bar__segment\">\n          <span class=\"info-bar__label\">Selected:</span>\n          <span class=\"info-bar__value\">${itemData.label || 'Unknown'}</span>\n        </div>\n      `);\n\n      if (itemData.lengthFt && itemData.widthFt) {\n        segments.push(`\n          <div class=\"info-bar__segment\">\n            <span class=\"info-bar__label\">Size:</span>\n            <span class=\"info-bar__value\">${itemData.lengthFt}' × ${itemData.widthFt}'</span>\n          </div>\n        `);\n      }\n\n      const posX = ((item.left - (floorPlan?.canvasBounds?.left || 0)) / 10).toFixed(1);\n      const posY = ((item.top - (floorPlan?.canvasBounds?.top || 0)) / 10).toFixed(1);\n\n      segments.push(`\n        <div class=\"info-bar__segment\">\n          <span class=\"info-bar__label\">Position:</span>\n          <span class=\"info-bar__value\">${posX}' from left, ${posY}' from top</span>\n        </div>\n      `);\n    }\n\n    const divider = '<span class=\"info-bar__divider\"></span>';\n    panel.innerHTML = segments.join(divider);\n  }\n\n  /**\n   * Update zoom percentage display in toolbar\n   */\n  updateZoomDisplay(zoom) {\n    const zoomPercent = Math.round(zoom * 100);\n\n    const zoomPercentage = document.getElementById('zoom-percentage');\n    if (zoomPercentage) {\n      zoomPercentage.textContent = `${zoomPercent}%`;\n    }\n\n    // Clamp slider value to 10-200% range\n    const clampedPercent = Math.max(10, Math.min(200, zoomPercent));\n\n    const zoomSlider = document.getElementById('zoom-slider');\n    const zoomSliderValue = document.getElementById('zoom-slider-value');\n    if (zoomSlider) {\n      zoomSlider.value = clampedPercent;\n    }\n    if (zoomSliderValue) {\n      zoomSliderValue.textContent = `${clampedPercent}%`;\n    }\n  }\n\n  /**\n   * Update project name in DOM and document title\n   */\n  updateProjectName(projectName) {\n    const name = projectName || 'Untitled Layout';\n\n    // Update DOM\n    const projectNameEl = document.getElementById('project-name');\n    if (projectNameEl) {\n      projectNameEl.textContent = name;\n    }\n\n    // Update document title\n    document.title = `${name} - Garage Layout Planner`;\n\n    // Update state if different\n    if (this.state.get('metadata.projectName') !== name) {\n      this.state.set('metadata.projectName', name);\n    }\n  }\n\n  /**\n   * Check for entry zone violations\n   * Returns true if any items are blocking the entry zone\n   */\n  checkEntryZoneViolations() {\n    try {\n      const floorPlan = this.state.get('floorPlan');\n      if (!floorPlan) {\n        this.updateEntryZoneWarning(false);\n        return false;\n      }\n\n      // Guard: Check if itemManager exists and has getItems method\n      if (!this.itemManager || typeof this.itemManager.getItems !== 'function') {\n        this.updateEntryZoneWarning(false);\n        return false;\n      }\n\n      const items = this.itemManager.getItems();\n      if (!items || items.length === 0) {\n        this.updateEntryZoneWarning(false);\n        return false;\n      }\n\n      const entryZonePosition = this.state.get('settings.entryZonePosition') || 'bottom';\n\n      // Check if any item is in the entry zone\n      const hasViolation = items.some((item) => {\n        if (!item || !item.canvasObject) return false;\n        return Bounds.isInEntryZone(item.canvasObject, floorPlan, entryZonePosition);\n      });\n\n      // Update state and UI\n      this.state.set('ui.entryZoneViolation', hasViolation);\n      this.updateEntryZoneWarning(hasViolation);\n\n      return hasViolation;\n    } catch (error) {\n      console.warn('[App] Error checking entry zone violations:', error);\n      this.updateEntryZoneWarning(false);\n      return false;\n    }\n  }\n\n  /**\n   * Debounced entry zone check (16ms to avoid thrashing during drags)\n   */\n  debouncedCheckEntryZone() {\n    if (this.entryZoneCheckDebounce) {\n      clearTimeout(this.entryZoneCheckDebounce);\n    }\n    this.entryZoneCheckDebounce = setTimeout(() => {\n      this.checkEntryZoneViolations();\n    }, 16);\n  }\n\n  /**\n   * Update entry zone warning badge visibility\n   */\n  updateEntryZoneWarning(show) {\n    // Cache badge reference if not already cached\n    if (!this.entryZoneWarningBadge) {\n      this.entryZoneWarningBadge = document.getElementById('entry-zone-warning');\n    }\n\n    if (this.entryZoneWarningBadge) {\n      this.entryZoneWarningBadge.style.display = show ? 'flex' : 'none';\n    }\n  }\n\n  /**\n   * Setup mobile/responsive features\n   */\n  setupMobileFeatures() {\n    // Cache DOM elements\n    const mobileMenuToggle = document.getElementById('mobile-menu-toggle');\n    const sidebarClose = document.getElementById('sidebar-close');\n    const sidebarBackdrop = document.getElementById('sidebar-backdrop');\n    const sidebar = document.querySelector('.sidebar');\n    const mobileToolbar = document.querySelector('.mobile-toolbar');\n\n    // Handle viewport changes\n    const handleViewportChange = () => {\n      const width = window.innerWidth;\n\n      // Show/hide mobile elements based on viewport\n      if (width <= 767) {\n        // Mobile/Tablet: Show hamburger, close button, backdrop\n        if (mobileMenuToggle) mobileMenuToggle.style.display = 'inline-flex';\n        if (sidebarClose) sidebarClose.style.display = 'flex';\n        if (width <= 480 && mobileToolbar) mobileToolbar.style.display = 'flex';\n      } else {\n        // Desktop: Hide mobile elements\n        if (mobileMenuToggle) mobileMenuToggle.style.display = 'none';\n        if (sidebarClose) sidebarClose.style.display = 'none';\n        if (mobileToolbar) mobileToolbar.style.display = 'none';\n        if (sidebar) sidebar.classList.remove('active');\n        if (sidebarBackdrop) sidebarBackdrop.classList.remove('active');\n      }\n    };\n\n    // Sidebar toggle function\n    const toggleSidebar = () => {\n      if (sidebar && sidebarBackdrop) {\n        const isActive = sidebar.classList.toggle('active');\n        sidebarBackdrop.classList.toggle('active', isActive);\n\n        // Prevent body scroll when sidebar is open\n        document.body.classList.toggle('drawer-open', isActive);\n      }\n    };\n\n    // Close sidebar\n    const closeSidebar = () => {\n      if (sidebar && sidebarBackdrop) {\n        sidebar.classList.remove('active');\n        sidebarBackdrop.classList.remove('active');\n        document.body.classList.remove('drawer-open');\n      }\n    };\n\n    // Hamburger menu toggle\n    if (mobileMenuToggle) {\n      mobileMenuToggle.addEventListener('click', toggleSidebar);\n    }\n\n    // Sidebar close button\n    if (sidebarClose) {\n      sidebarClose.addEventListener('click', closeSidebar);\n    }\n\n    // Backdrop click to close\n    if (sidebarBackdrop) {\n      sidebarBackdrop.addEventListener('click', closeSidebar);\n    }\n\n    // Close sidebar when selecting floor plan or item on mobile\n    if (sidebar) {\n      sidebar.addEventListener('click', (e) => {\n        if (window.innerWidth <= 767) {\n          const isFloorPlanItem = e.target.closest('.floorplan-item');\n          const isPaletteItem = e.target.closest('.palette-item');\n          const isSavedLayout = e.target.closest('.saved-layout-item');\n\n          if (isFloorPlanItem || isPaletteItem || isSavedLayout) {\n            setTimeout(closeSidebar, 300); // Delay for better UX\n          }\n        }\n      });\n    }\n\n    // Mobile toolbar button handlers\n    const mobileBtnNew = document.getElementById('mobile-btn-new');\n    const mobileBtnUndo = document.getElementById('mobile-btn-undo');\n    const mobileBtnRedo = document.getElementById('mobile-btn-redo');\n    const mobileBtnRotate = document.getElementById('mobile-btn-rotate');\n    const mobileBtnDuplicate = document.getElementById('mobile-btn-duplicate');\n    const mobileBtnDelete = document.getElementById('mobile-btn-delete');\n    const mobileBtnMore = document.getElementById('mobile-btn-more');\n\n    // Mobile toolbar: New button\n    if (mobileBtnNew) {\n      mobileBtnNew.addEventListener('click', async () => {\n        const confirmed = await Modal.showConfirm(\n          'Start New Layout?',\n          \"This will clear the current layout. Make sure you've saved your work.\",\n        );\n        if (confirmed) {\n          console.log('[App] Starting new layout (mobile)');\n\n          // Clear everything (same as desktop version)\n          this.state.reset();\n          this.canvasManager.clear();\n\n          // Clear history stack to prevent undoing back to old layout\n          this.historyManager.clear();\n\n          // CRITICAL: Clear autosave from localStorage immediately\n          StorageUtil.remove(Config.STORAGE_KEYS.autosave);\n          console.log('[App] Cleared autosave from localStorage');\n\n          // Ensure viewport is reset (clear() already does this, but be explicit)\n          this.canvasManager.resetViewport();\n\n          // Show empty state\n          this.canvasManager.showEmptyState();\n\n          // Reset project name in DOM and document title\n          this.updateProjectName('Untitled Layout');\n\n          this.renderFloorPlanList();\n          this.updateInfoPanel();\n          Modal.showSuccess('New layout started');\n        }\n      });\n    }\n\n    if (mobileBtnUndo) {\n      mobileBtnUndo.addEventListener('click', () => this.historyManager.undo());\n    }\n\n    if (mobileBtnRedo) {\n      mobileBtnRedo.addEventListener('click', () => this.historyManager.redo());\n    }\n\n    // Mobile toolbar: Rotate button\n    if (mobileBtnRotate) {\n      mobileBtnRotate.addEventListener('click', () => {\n        const selection = this.canvasManager.getCanvas().getActiveObject();\n        if (selection) {\n          selection.rotate((selection.angle || 0) + 90);\n          this.canvasManager.getCanvas().renderAll();\n\n          // Update item position in state (including rotation)\n          if (selection.customData && selection.customData.id) {\n            this.updateItemPosition(\n              selection.customData.id,\n              selection.left,\n              selection.top,\n              selection.angle,\n            );\n          }\n\n          this.historyManager.save();\n        } else {\n          Modal.showError('Please select an item to rotate');\n        }\n      });\n    }\n\n    // Mobile toolbar: Duplicate button\n    if (mobileBtnDuplicate) {\n      mobileBtnDuplicate.addEventListener('click', () => {\n        const selection = this.canvasManager.getCanvas().getActiveObject();\n        if (selection && selection.customData) {\n          this.eventBus.emit('item:duplicate:requested', selection.customData.id);\n        } else {\n          Modal.showError('Please select an item to duplicate');\n        }\n      });\n    }\n\n    if (mobileBtnDelete) {\n      mobileBtnDelete.addEventListener('click', () => {\n        const selection = this.canvasManager.getCanvas().getActiveObject();\n        if (selection) {\n          this.eventBus.emit('item:delete:requested', selection.customData?.id);\n        }\n      });\n    }\n\n    if (mobileBtnMore) {\n      mobileBtnMore.addEventListener('click', () => {\n        this.showMobileMoreMenu();\n      });\n    }\n\n    // Setup touch gestures for canvas\n    this.setupTouchGestures();\n\n    // Listen for viewport changes\n    window.addEventListener('resize', handleViewportChange);\n    handleViewportChange(); // Initial call\n  }\n\n  /**\n   * Setup touch gestures (pinch zoom, pan, tap, long-press)\n   */\n  setupTouchGestures() {\n    const canvas = this.canvasManager.getCanvas();\n    if (!canvas) return;\n\n    let lastDistance = 0;\n    // eslint-disable-next-line no-unused-vars\n    let lastCenter = null;\n    let isPinching = false;\n\n    // Handle touch start\n    canvas.on('touch:gesture', (e) => {\n      if (e.e.touches && e.e.touches.length === 2) {\n        isPinching = true;\n\n        // Calculate distance between two fingers\n        const touch1 = e.e.touches[0];\n        const touch2 = e.e.touches[1];\n        const dx = touch2.clientX - touch1.clientX;\n        const dy = touch2.clientY - touch1.clientY;\n        lastDistance = Math.sqrt(dx * dx + dy * dy);\n\n        // Calculate center point\n        lastCenter = {\n          x: (touch1.clientX + touch2.clientX) / 2,\n          y: (touch1.clientY + touch2.clientY) / 2,\n        };\n      }\n    });\n\n    // Handle pinch zoom\n    canvas.on('touch:drag', (e) => {\n      if (isPinching && e.e.touches && e.e.touches.length === 2) {\n        const touch1 = e.e.touches[0];\n        const touch2 = e.e.touches[1];\n        const dx = touch2.clientX - touch1.clientX;\n        const dy = touch2.clientY - touch1.clientY;\n        const distance = Math.sqrt(dx * dx + dy * dy);\n\n        if (lastDistance > 0) {\n          const delta = distance / lastDistance;\n          const zoom = canvas.getZoom();\n          let newZoom = zoom * delta;\n\n          // Clamp zoom (10% - 200%)\n          newZoom = Math.max(0.1, Math.min(2, newZoom));\n\n          // Zoom to pinch center\n          const center = {\n            x: (touch1.clientX + touch2.clientX) / 2,\n            y: (touch1.clientY + touch2.clientY) / 2,\n          };\n\n          canvas.zoomToPoint({ x: center.x, y: center.y }, newZoom);\n\n          // Mark as manual zoom (not auto-fit)\n          this.canvasManager.isAutoFitMode = false;\n\n          this.eventBus.emit('canvas:zoomed', newZoom);\n        }\n\n        lastDistance = distance;\n      }\n    });\n\n    // Handle touch end\n    canvas.on('touch:longpress', () => {\n      isPinching = false;\n      lastDistance = 0;\n      lastCenter = null;\n    });\n\n    // Enable touch scrolling/panning when no object is selected\n    canvas.allowTouchScrolling = true;\n  }\n\n  /**\n   * Show mobile \"More\" menu with additional actions\n   */\n  /**\n   * Show mobile \"More\" menu with Export and View options\n   */\n  async showMobileMoreMenu() {\n    const container = document.createElement('div');\n    container.style.cssText = 'display: flex; flex-direction: column; gap: 16px;';\n\n    // EXPORT section\n    const exportSection = document.createElement('div');\n    exportSection.innerHTML = `\n      <div style=\"margin-bottom: 8px; color: #71717A; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em;\">\n        EXPORT\n      </div>\n      <div style=\"display: flex; flex-direction: column; gap: 4px;\">\n        <button class=\"dropdown-item\" data-action=\"export-png\">\n          <svg viewBox=\"0 0 24 24\" width=\"20\" height=\"20\" fill=\"currentColor\"><path d=\"M8.5,13.5L11,16.5L14.5,12L19,18H5M21,19V5C21,3.89 20.1,3 19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19Z\"/></svg>\n          Export PNG\n        </button>\n        <button class=\"dropdown-item\" data-action=\"export-pdf\">\n          <svg viewBox=\"0 0 24 24\" width=\"20\" height=\"20\" fill=\"currentColor\"><path d=\"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M15.5,15C15.5,16.38 14.38,17.5 13,17.5H11.5V19H10V13H13A2.5,2.5 0 0,1 15.5,15.5M13,16.5A1,1 0 0,0 14,15.5A1,1 0 0,0 13,14.5H11.5V16.5M13,9V3.5L18.5,9\"/></svg>\n          Export PDF\n        </button>\n        <button class=\"dropdown-item\" data-action=\"share-email\">\n          <svg viewBox=\"0 0 24 24\" width=\"20\" height=\"20\" fill=\"currentColor\"><path d=\"M20,8L12,13L4,8V6L12,11L20,6M20,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V6C22,4.89 21.1,4 20,4Z\"/></svg>\n          Share via Email\n        </button>\n      </div>\n    `;\n\n    // VIEW OPTIONS section\n    const viewSection = document.createElement('div');\n    const currentSettings = this.state.get('settings') || {};\n    const gridVisible = currentSettings.showGrid !== false;\n    const entryLabelVisible = currentSettings.showEntryLabel !== false;\n    const entryBorderVisible = currentSettings.showEntryBorder !== false;\n    const itemLabelsVisible = currentSettings.showItemLabels !== false;\n    const entryPosition = currentSettings.entryZonePosition || 'bottom';\n\n    viewSection.innerHTML = `\n      <div style=\"margin-bottom: 8px; color: #71717A; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em;\">\n        VIEW OPTIONS\n      </div>\n      <div style=\"display: flex; flex-direction: column; gap: 4px;\">\n        <button class=\"dropdown-item\" data-action=\"toggle-grid\">\n          <svg viewBox=\"0 0 24 24\" width=\"20\" height=\"20\" fill=\"currentColor\"><path d=\"M10,4V8H14V4H10M16,4V8H20V4H16M16,10V14H20V10H16M16,16V20H20V16H16M14,20V16H10V20H14M8,20V16H4V20H8M8,14V10H4V14H8M8,8V4H4V8H8M10,14H14V10H10V14M4,2H20A2,2 0 0,1 22,4V20A2,2 0 0,1 20,22H4C2.89,22 2,21.1 2,20V4A2,2 0 0,1 4,2Z\"/></svg>\n          ${gridVisible ? 'Hide' : 'Show'} Grid\n        </button>\n        <button class=\"dropdown-item\" data-action=\"toggle-item-labels\">\n          <svg viewBox=\"0 0 24 24\" width=\"20\" height=\"20\" fill=\"currentColor\"><path d=\"M8,9H16V11H8V9M4,3H20A2,2 0 0,1 22,5V19A2,2 0 0,1 20,21H4A2,2 0 0,1 2,19V5A2,2 0 0,1 4,3Z\" /></svg>\n          ${itemLabelsVisible ? 'Hide' : 'Show'} Labels\n        </button>\n        <button class=\"dropdown-item\" data-action=\"toggle-entry-label\">\n          <svg viewBox=\"0 0 24 24\" width=\"20\" height=\"20\" fill=\"currentColor\"><path d=\"M9.62,12L12,5.67L14.37,12M11,3L5.5,17H7.75L8.87,14H15.12L16.25,17H18.5L13,3H11Z\"/></svg>\n          ${entryLabelVisible ? 'Hide' : 'Show'} Entry Label\n        </button>\n        <button class=\"dropdown-item\" data-action=\"toggle-entry-border\">\n          <svg viewBox=\"0 0 24 24\" width=\"20\" height=\"20\" fill=\"currentColor\"><path d=\"M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3M19,5V19H5V5H19Z\"/></svg>\n          ${entryBorderVisible ? 'Hide' : 'Show'} Entry Border\n        </button>\n        <button class=\"dropdown-item ${entryPosition === 'bottom' ? 'active' : ''}\" data-action=\"entry-bottom\">\n          <svg viewBox=\"0 0 24 24\" width=\"20\" height=\"20\" fill=\"currentColor\"><path d=\"M11,4H13V16L18.5,10.5L19.92,11.92L12,19.84L4.08,11.92L5.5,10.5L11,16V4Z\"/></svg>\n          Entry Zone: Bottom ${entryPosition === 'bottom' ? '✓' : ''}\n        </button>\n        <button class=\"dropdown-item ${entryPosition === 'left' ? 'active' : ''}\" data-action=\"entry-left\">\n          <svg viewBox=\"0 0 24 24\" width=\"20\" height=\"20\" fill=\"currentColor\"><path d=\"M20,9V15H8L13.5,9.5L12.08,8.08L4.16,16L12.08,23.92L13.5,22.5L8,17H20V9Z\"/></svg>\n          Entry Zone: Left ${entryPosition === 'left' ? '✓' : ''}\n        </button>\n        <button class=\"dropdown-item ${entryPosition === 'right' ? 'active' : ''}\" data-action=\"entry-right\">\n          <svg viewBox=\"0 0 24 24\" width=\"20\" height=\"20\" fill=\"currentColor\"><path d=\"M4,15V9H16L10.5,14.5L11.92,15.92L19.84,8L11.92,0.0799999L10.5,1.5L16,7H4V15Z\"/></svg>\n          Entry Zone: Right ${entryPosition === 'right' ? '✓' : ''}\n        </button>\n        <button class=\"dropdown-item ${entryPosition === 'top' ? 'active' : ''}\" data-action=\"entry-top\">\n          <svg viewBox=\"0 0 24 24\" width=\"20\" height=\"20\" fill=\"currentColor\"><path d=\"M13,20H11V8L5.5,13.5L4.08,12.08L12,4.16L19.92,12.08L18.5,13.5L13,8V20Z\"/></svg>\n          Entry Zone: Top ${entryPosition === 'top' ? '✓' : ''}\n        </button>\n      </div>\n    `;\n\n    container.appendChild(exportSection);\n    container.appendChild(viewSection);\n\n    // Export handlers\n    container.querySelector('[data-action=\"export-png\"]').onclick = () => {\n      Modal.close();\n      this.showPNGExportDialog();\n    };\n\n    container.querySelector('[data-action=\"export-pdf\"]').onclick = () => {\n      this.exportManager.exportPDF();\n      Modal.close();\n    };\n\n    container.querySelector('[data-action=\"share-email\"]').onclick = () => {\n      this.shareViaEmail();\n      Modal.close();\n    };\n\n    container.querySelector('[data-action=\"toggle-grid\"]').onclick = () => {\n      this.canvasManager.toggleGrid();\n      Modal.close();\n    };\n\n    container.querySelector('[data-action=\"toggle-item-labels\"]').onclick = () => {\n      const showLabels = this.state.get('settings.showItemLabels') !== false;\n      this.state.set('settings.showItemLabels', !showLabels);\n      this.canvasManager.toggleItemLabels(!showLabels);\n      Modal.close();\n    };\n\n    container.querySelector('[data-action=\"toggle-entry-label\"]').onclick = () => {\n      const showLabel = this.state.get('settings.showEntryZoneLabel') !== false;\n      this.state.set('settings.showEntryZoneLabel', !showLabel);\n      this.canvasManager.redrawFloorPlan();\n      Modal.close();\n    };\n\n    container.querySelector('[data-action=\"toggle-entry-border\"]').onclick = () => {\n      const showBorder = this.state.get('settings.showEntryZoneBorder') !== false;\n      this.state.set('settings.showEntryZoneBorder', !showBorder);\n      this.canvasManager.redrawFloorPlan();\n      Modal.close();\n    };\n\n    container.querySelector('[data-action=\"entry-bottom\"]').onclick = () => {\n      this.state.set('settings.entryZonePosition', 'bottom');\n      this.canvasManager.redrawFloorPlan();\n      Modal.close();\n    };\n\n    container.querySelector('[data-action=\"entry-left\"]').onclick = () => {\n      this.state.set('settings.entryZonePosition', 'left');\n      this.canvasManager.redrawFloorPlan();\n      Modal.close();\n    };\n\n    container.querySelector('[data-action=\"entry-right\"]').onclick = () => {\n      this.state.set('settings.entryZonePosition', 'right');\n      this.canvasManager.redrawFloorPlan();\n      Modal.close();\n    };\n\n    container.querySelector('[data-action=\"entry-top\"]').onclick = () => {\n      this.state.set('settings.entryZonePosition', 'top');\n      this.canvasManager.redrawFloorPlan();\n      Modal.close();\n    };\n\n    Modal.show('More Actions', container);\n  }\n\n  /**\n   * Show PNG export resolution dialog\n   */\n  async showPNGExportDialog() {\n    const resolutions = [\n      { label: '1x (Standard)', value: 1 },\n      { label: '2x (High Quality)', value: 2 },\n      { label: '4x (Print)', value: 4 },\n      { label: '8x (Ultra HD)', value: 8 },\n    ];\n\n    const menuHTML = resolutions\n      .map((res) => `<button class=\"dropdown-item\" data-res=\"${res.value}\">${res.label}</button>`)\n      .join('');\n\n    const container = document.createElement('div');\n    container.innerHTML = `\n      <div style=\"display: flex; flex-direction: column; gap: 4px;\">\n        ${menuHTML}\n      </div>\n    `;\n\n    container.querySelectorAll('[data-res]').forEach((btn) => {\n      btn.addEventListener('click', () => {\n        const resolution = parseInt(btn.dataset.res);\n        this.exportManager.exportPNG(resolution);\n        Modal.close();\n      });\n    });\n\n    Modal.show('Select PNG Resolution', container);\n  }\n\n  /**\n   * Refresh canvas after undo/redo\n   */\n  /**\n   * Refresh canvas - redraw everything from state\n   * Used after undo/redo operations\n   */\n  refreshCanvas() {\n    // [App] Refreshing canvas from state\n\n    // ALWAYS clear canvas first (critical for undo/redo)\n    // This also resets viewport automatically\n    this.canvasManager.clear();\n\n    const floorPlan = this.state.get('floorPlan');\n    if (floorPlan) {\n      // Draw floor plan\n      this.canvasManager.drawFloorPlan(floorPlan);\n\n      // Re-add items from state\n      const items = this.state.get('items') || [];\n      items.forEach((item) => {\n        if (item.itemId && item.x !== undefined && item.y !== undefined) {\n          const canvasGroup = this.canvasManager.addItem(item, item.x, item.y);\n\n          // Restore rotation if exists\n          if (item.angle && canvasGroup) {\n            canvasGroup.rotate(item.angle);\n          }\n\n          // Update item reference\n          item.canvasObject = canvasGroup;\n        }\n      });\n\n      // Final render\n      this.canvasManager.getCanvas().renderAll();\n\n      // Apply label visibility setting\n      const showLabels = this.state.get('settings.showItemLabels') !== false;\n      this.canvasManager.toggleItemLabels(showLabels);\n    } else {\n      // No floor plan - show empty state\n      this.canvasManager.showEmptyState();\n    }\n\n    this.updateInfoPanel();\n  }\n\n  /**\n   * Setup autosave\n   */\n  /**\n   * Setup autosave timer\n   * Saves application state every 30 seconds\n   */\n  setupAutosave() {\n    // Skip autosave setup if storage is not available\n    if (!StorageUtil.isAvailable) {\n      console.warn('[App] Autosave disabled - persistent storage not available');\n      return;\n    }\n\n    // [App] Setting up autosave (interval: 30s)\n    this.autosaveInterval = setInterval(() => {\n      this.autosave();\n    }, Config.AUTOSAVE_INTERVAL);\n  }\n\n  /**\n   * Autosave current state\n   * Saves only application data (floor plan, items, settings)\n   * Does NOT save canvas viewport (zoom/pan)\n   */\n  autosave() {\n    // Skip if storage not available\n    if (!StorageUtil.isAvailable) {\n      return;\n    }\n\n    try {\n      const state = this.state.getState();\n\n      // Prepare autosave data with metadata\n      const autosaveData = {\n        version: '2.1', // Center-based coordinate system\n        timestamp: new Date().toISOString(),\n        state: {\n          floorPlan: state.floorPlan,\n          items: state.items,\n          settings: state.settings,\n          metadata: state.metadata,\n        },\n        // NOTE: Viewport (zoom/pan) is intentionally NOT saved\n      };\n\n      StorageUtil.save(Config.STORAGE_KEYS.autosave, autosaveData);\n      // [App] Autosave completed + timestamp\n    } catch (error) {\n      console.error('[App] Autosave failed:', error);\n    }\n  }\n\n  /**\n   * Load autosave if exists\n   * Validates data and resets viewport after loading\n   */\n  loadAutosave() {\n    // Skip if storage not available\n    if (!StorageUtil.isAvailable) {\n      console.log('[App] Autosave unavailable - persistent storage not available');\n      return false;\n    }\n\n    try {\n      const savedData = StorageUtil.load(Config.STORAGE_KEYS.autosave);\n\n      if (!savedData) {\n        console.log('[App] No autosave found');\n        return false;\n      }\n\n      // Validate version\n      const APP_VERSION = '2.1';\n      if (savedData.version !== APP_VERSION) {\n        console.log(\n          '[App] Incompatible autosave version:',\n          savedData.version,\n          'expected:',\n          APP_VERSION,\n        );\n        StorageUtil.remove(Config.STORAGE_KEYS.autosave);\n        return false;\n      }\n\n      // Validate timestamp (ignore if > 7 days old)\n      if (savedData.timestamp) {\n        const savedDate = new Date(savedData.timestamp);\n        const daysSinceAutosave = (Date.now() - savedDate.getTime()) / (1000 * 60 * 60 * 24);\n\n        if (daysSinceAutosave > 7) {\n          console.log('[App] Autosave expired (>7 days old), clearing...');\n          StorageUtil.remove(Config.STORAGE_KEYS.autosave);\n          return false;\n        }\n      }\n\n      // Validate required data\n      if (!savedData.state) {\n        console.log('[App] Invalid autosave structure, missing state');\n        StorageUtil.remove(Config.STORAGE_KEYS.autosave);\n        return false;\n      }\n\n      const savedState = savedData.state;\n\n      // Must have a floor plan to restore\n      if (!savedState.floorPlan) {\n        console.log('[App] No floor plan in autosave, skipping');\n        return false;\n      }\n\n      console.log('[App] Loading autosave from', savedData.timestamp);\n\n      // Load state\n      this.state.loadState(savedState);\n\n      // Set floor plan (this internally calls centerAndFit)\n      this.floorPlanManager.setFloorPlan(savedState.floorPlan.id);\n\n      // Restore items\n      const items = savedState.items || [];\n      items.forEach((item) => {\n        if (item.itemId && item.x !== undefined && item.y !== undefined) {\n          const canvasGroup = this.canvasManager.addItem(item, item.x, item.y);\n\n          // Restore rotation if exists\n          if (item.angle && canvasGroup) {\n            canvasGroup.rotate(item.angle);\n          }\n\n          // Update item reference\n          item.canvasObject = canvasGroup;\n        }\n      });\n\n      // Render canvas\n      this.canvasManager.getCanvas().renderAll();\n\n      // Apply label visibility setting\n      const showLabels = this.state.get('settings.showItemLabels') !== false;\n      this.canvasManager.toggleItemLabels(showLabels);\n\n      // Sync project name from loaded state to UI\n      this.updateProjectName(savedState.metadata?.projectName);\n\n      console.log('[App] Autosave loaded successfully: floor plan + ' + items.length + ' items');\n      return true;\n    } catch (error) {\n      console.error('[App] Failed to load autosave:', error);\n      console.log('[App] Clearing corrupted autosave data');\n      StorageUtil.remove(Config.STORAGE_KEYS.autosave);\n      return false;\n    }\n  }\n\n  /**\n   * Update item position in state after drag\n   * x, y are center coordinates (object uses originX/Y: 'center')\n   */\n  updateItemPosition(itemId, x, y, angle) {\n    const items = this.state.get('items') || [];\n    const item = items.find((i) => i.id === itemId);\n    if (item) {\n      // Store center coordinates\n      item.x = x;\n      item.y = y;\n      item.angle = angle;\n      this.state.setState({ items });\n    }\n  }\n\n  /**\n   * Save layout\n   */\n  async saveLayout() {\n    // Show one-time warning if storage is not fully persistent\n    if (!StorageUtil.isPersistent && !window._storageWarningShown) {\n      window._storageWarningShown = true;\n      const mode = StorageUtil.mode;\n      if (mode === 'session') {\n        Modal.showInfo('Your layouts will be saved for this session, but will be cleared when you close this tab');\n      } else if (mode === 'memory') {\n        Modal.showInfo('Your layouts will only be saved temporarily and will be lost when you reload this page');\n      }\n    }\n\n    const name = await Modal.showPrompt('Save Layout', 'Enter layout name:');\n    if (!name) return;\n\n    const state = this.state.getState();\n    const layouts = StorageUtil.load(Config.STORAGE_KEYS.layouts) || [];\n\n    layouts.push({\n      id: Helpers.generateId('layout'),\n      name: name,\n      created: new Date().toISOString(),\n      state: state,\n      thumbnail: this.exportManager.generateThumbnail(),\n    });\n\n    const saved = StorageUtil.save(Config.STORAGE_KEYS.layouts, layouts);\n    if (saved) {\n      Modal.showSuccess('Layout saved successfully!');\n      this.renderSavedLayouts();\n    } else {\n      Modal.showError('Failed to save layout - storage error');\n    }\n  }\n\n  /**\n   * Share layout via email\n   */\n  shareViaEmail() {\n    const floorPlan = this.state.get('floorPlan');\n    const items = this.state.get('items') || [];\n    const metadata = this.state.get('metadata') || {};\n    const projectName = metadata.projectName || 'Untitled Layout';\n\n    if (!floorPlan) {\n      Modal.showError('Please select a floor plan first');\n      return;\n    }\n\n    // Calculate area\n    const areaSqFt = floorPlan.widthFt * floorPlan.heightFt;\n\n    // Format door dimensions - check both key formats\n    const doorWidth = floorPlan.doorWidth ?? floorPlan.doorWidthFt;\n    const doorHeight = floorPlan.doorHeight ?? floorPlan.doorHeightFt;\n    const doorInfo = doorWidth && doorHeight ? `${doorWidth}' × ${doorHeight}'` : 'N/A';\n\n    // Create email content\n    const subject = encodeURIComponent(`Storage Caves Garage Layout: ${projectName}`);\n\n    const layoutInfo = `\nLocation: ${metadata.location || 'Buford, GA'}\nFloor Plan: ${floorPlan.name}\nDoor: ${doorInfo}\nArea: ${areaSqFt} sq ft\nItems: ${items.length}\n\nItem List:\n${items.map((item, i) => `${i + 1}. ${item.label} - ${item.lengthFt}' × ${item.widthFt}'`).join('\\n')}\n\nOccupancy: ${this.floorPlanManager.getOccupancyPercentage().toFixed(1)}%\n    `.trim();\n\n    const body = encodeURIComponent(\n      `Hi,\\n\\nI'd like to share my garage layout plan with you:\\n\\n${layoutInfo}\\n\\n---\\nCreated with Storage Caves Garage Layout Planner`,\n    );\n\n    // Open default email client\n    window.location.href = `mailto:?subject=${subject}&body=${body}`;\n  }\n\n  /**\n   * Render saved layouts list\n   */\n  renderSavedLayouts() {\n    const container = document.getElementById('saved-layouts-list');\n    if (!container) return;\n\n    const layouts = StorageUtil.load(Config.STORAGE_KEYS.layouts) || [];\n\n    if (layouts.length === 0) {\n      container.innerHTML = `\n        <div class=\"empty-state\">\n          <p>No saved layouts</p>\n          <p style=\"font-size: 12px; margin-top: 8px;\">Click the Save button to save your current layout</p>\n        </div>\n      `;\n      return;\n    }\n\n    container.innerHTML = layouts\n      .map(\n        (layout) => `\n      <div class=\"saved-layout-item\" data-id=\"${layout.id}\">\n        <div class=\"saved-layout-name\">${layout.name}</div>\n        <div class=\"saved-layout-date\">${new Date(layout.created).toLocaleDateString()}</div>\n        <div class=\"saved-layout-actions\">\n          <button class=\"btn-load-layout\" data-id=\"${layout.id}\">Load</button>\n          <button class=\"btn-delete-layout\" data-id=\"${layout.id}\">Delete</button>\n        </div>\n      </div>\n    `,\n      )\n      .join('');\n\n    container.querySelectorAll('.btn-load-layout').forEach((btn) => {\n      btn.addEventListener('click', (e) => {\n        e.stopPropagation();\n        this.loadLayout(btn.dataset.id);\n      });\n    });\n\n    container.querySelectorAll('.btn-delete-layout').forEach((btn) => {\n      btn.addEventListener('click', async (e) => {\n        e.stopPropagation();\n        const confirmed = await Modal.showConfirm(\n          'Delete Layout?',\n          'Are you sure you want to delete this layout? This cannot be undone.',\n        );\n        if (confirmed) {\n          this.deleteLayout(btn.dataset.id);\n        }\n      });\n    });\n  }\n\n  /**\n   * Load a saved layout\n   */\n  /**\n   * Load a saved layout\n   * Validates data and resets viewport\n   */\n  async loadLayout(layoutId) {\n    // Check if storage is available\n    if (!StorageUtil.isAvailable) {\n      Modal.showError('Cannot load layout - persistent storage is not available in your browser');\n      return;\n    }\n\n    try {\n      const layouts = StorageUtil.load(Config.STORAGE_KEYS.layouts) || [];\n      const layout = layouts.find((l) => l.id === layoutId);\n\n      if (!layout) {\n        Modal.showError('Layout not found');\n        return;\n      }\n\n      const confirmed = await Modal.showConfirm(\n        'Load Layout?',\n        'This will replace your current layout. Any unsaved changes will be lost.',\n      );\n\n      if (!confirmed) return;\n\n      // [App] Loading layout: id\n\n      // Validate layout data\n      if (!layout.state || !layout.state.floorPlan) {\n        Modal.showError('Invalid layout data');\n        return;\n      }\n\n      // Load state\n      this.state.loadState(layout.state);\n\n      // Update project name in UI and document title\n      this.updateProjectName(layout.state.metadata?.projectName);\n\n      // Sync view dropdown UI with loaded state\n      this.syncViewDropdownUI();\n\n      // Reset viewport BEFORE refreshing canvas\n      this.canvasManager.resetViewport();\n\n      // Refresh canvas with new state\n      this.refreshCanvas();\n\n      // Update UI\n      this.renderFloorPlanList();\n      this.renderSavedLayouts();\n      this.updateInfoPanel();\n\n      Modal.showSuccess('Layout loaded successfully!');\n    } catch (error) {\n      console.error('[App] Failed to load layout:', error);\n      Modal.showError('Failed to load layout');\n    }\n  }\n\n  /**\n   * Delete a saved layout\n   */\n  deleteLayout(layoutId) {\n    // Check if storage is available\n    if (!StorageUtil.isAvailable) {\n      Modal.showError('Cannot delete layout - persistent storage is not available in your browser');\n      return;\n    }\n\n    let layouts = StorageUtil.load(Config.STORAGE_KEYS.layouts) || [];\n    layouts = layouts.filter((l) => l.id !== layoutId);\n    const saved = StorageUtil.save(Config.STORAGE_KEYS.layouts, layouts);\n\n    if (saved) {\n      this.renderSavedLayouts();\n      Modal.showSuccess('Layout deleted');\n    } else {\n      Modal.showError('Failed to delete layout - storage error');\n    }\n  }\n}\n\n// Make available globally\nif (typeof window !== 'undefined') {\n  window.App = App;\n}\n","size_bytes":62578},"js/managers/CanvasManager.js":{"content":"/* global Helpers, Config */\n\n/**\n * Canvas Manager - Fabric.js Canvas Management\n * Handles canvas initialization, zoom, pan, rendering\n */\nclass CanvasManager {\n  constructor(canvasId, state, eventBus) {\n    this.state = state;\n    this.eventBus = eventBus;\n    this.canvas = null;\n    this.canvasId = canvasId;\n    this.floorPlanRect = null;\n    this.entryZoneRect = null;\n    this.entryZoneLabel = null;\n    this.gridLines = [];\n    this.alignmentGuides = [];\n    this.emptyStateGroup = null;\n    this.floorPlanWidth = null; // Store floor plan dimensions for re-centering\n    this.floorPlanHeight = null;\n    this.isAutoFitMode = true; // Track if zoom is auto-fit vs manual\n  }\n\n  /**\n   * Initialize Fabric.js canvas\n   */\n  init() {\n    const canvasEl = document.getElementById(this.canvasId);\n    if (!canvasEl) {\n      console.error('Canvas element not found');\n      return;\n    }\n\n    this.canvas = new fabric.Canvas(this.canvasId, {\n      backgroundColor: '#ffffff',\n      selection: true,\n      preserveObjectStacking: true,\n      // Professional control styling\n      selectionColor: 'rgba(99, 102, 241, 0.1)',\n      selectionBorderColor: '#6366F1',\n      selectionLineWidth: 2,\n      // Corner/control styling for better visibility\n      borderColor: '#6366F1',\n      cornerColor: '#6366F1',\n      cornerStrokeColor: '#ffffff',\n      cornerStyle: 'circle',\n      cornerSize: 14,\n      transparentCorners: false,\n      borderDashArray: [5, 5],\n      borderScaleFactor: 2,\n      // Rotation control styling\n      rotatingPointOffset: 40,\n      // Padding for better hit area\n      padding: 0,\n    });\n\n    // Customize multi-selection (ActiveSelection) appearance\n    fabric.ActiveSelection.prototype.set({\n      borderColor: '#6366F1',\n      cornerColor: '#6366F1',\n      cornerStrokeColor: '#ffffff',\n      cornerStyle: 'circle',\n      cornerSize: 14,\n      transparentCorners: false,\n      borderDashArray: [5, 5],\n      borderScaleFactor: 2,\n      padding: 0,\n    });\n\n    // Setup event listeners\n    this.setupEventListeners();\n\n    // Listen to window resize\n    window.addEventListener('resize', () => this.resizeCanvas());\n\n    // CRITICAL: Resize canvas synchronously BEFORE any viewport operations\n    // This ensures centerAndFit() uses the correct canvas dimensions, not the default 300x150\n    this.resizeCanvas();\n\n    return this.canvas;\n  }\n\n  /**\n   * Resize canvas to fit container\n   * Re-centers floor plan ONLY if in auto-fit mode (preserves manual zoom)\n   */\n  resizeCanvas() {\n    if (!this.canvas) return;\n\n    const container = this.canvas.wrapperEl.parentElement;\n    const width = container.clientWidth || 800;\n    const height = container.clientHeight || 600;\n\n    this.canvas.setDimensions({ width, height });\n\n    // Re-center floor plan ONLY if in auto-fit mode\n    // This preserves user's manual zoom level when resizing window\n    if (this.isAutoFitMode && this.floorPlanWidth && this.floorPlanHeight) {\n      this.centerAndFit(this.floorPlanWidth, this.floorPlanHeight);\n    }\n\n    // Re-center empty state if it exists\n    if (this.emptyStateGroup) {\n      this.emptyStateGroup.set({\n        left: width / 2,\n        top: height / 2,\n      });\n    }\n\n    this.canvas.renderAll();\n  }\n\n  /**\n   * Setup canvas event listeners\n   */\n  setupEventListeners() {\n    // Object moving\n    this.canvas.on('object:moving', (e) => {\n      this.constrainToFloorPlan(e.target);\n      this.eventBus.emit('canvas:object:moving', e.target);\n    });\n\n    // Object moved\n    this.canvas.on('object:modified', (e) => {\n      this.constrainToFloorPlan(e.target);\n      this.eventBus.emit('canvas:object:modified', e.target);\n    });\n\n    // Selection created\n    this.canvas.on('selection:created', (e) => {\n      this.eventBus.emit('canvas:selection:created', e.selected);\n    });\n\n    // Selection updated\n    this.canvas.on('selection:updated', (e) => {\n      this.eventBus.emit('canvas:selection:updated', e.selected);\n    });\n\n    // Selection cleared\n    this.canvas.on('selection:cleared', () => {\n      this.eventBus.emit('canvas:selection:cleared');\n    });\n\n    // Mouse wheel zoom\n    this.canvas.on('mouse:wheel', (opt) => {\n      this.handleMouseWheel(opt);\n    });\n  }\n\n  /**\n   * Constrain object to floor plan bounds\n   * Objects use center origin, so left/top represent center coordinates\n   * Uses actual item rectangle dimensions (not group bounding box with label)\n   * Handles both single items and multi-select (ActiveSelection)\n   */\n  constrainToFloorPlan(obj) {\n    if (!obj || !this.floorPlanRect) return;\n\n    const floorPlan = this.floorPlanRect;\n\n    // Handle multi-select (ActiveSelection) differently\n    if (obj.type === 'activeSelection') {\n      // Use the entire selection's bounding box\n      const boundingRect = obj.getBoundingRect(true);\n      let isOutOfBounds = false;\n      let offsetX = 0;\n      let offsetY = 0;\n\n      // Check bounds and calculate needed offset\n      if (boundingRect.left < floorPlan.left) {\n        offsetX = floorPlan.left - boundingRect.left;\n        isOutOfBounds = true;\n      }\n      if (boundingRect.left + boundingRect.width > floorPlan.left + floorPlan.width) {\n        offsetX = floorPlan.left + floorPlan.width - (boundingRect.left + boundingRect.width);\n        isOutOfBounds = true;\n      }\n      if (boundingRect.top < floorPlan.top) {\n        offsetY = floorPlan.top - boundingRect.top;\n        isOutOfBounds = true;\n      }\n      if (boundingRect.top + boundingRect.height > floorPlan.top + floorPlan.height) {\n        offsetY = floorPlan.top + floorPlan.height - (boundingRect.top + boundingRect.height);\n        isOutOfBounds = true;\n      }\n\n      if (isOutOfBounds) {\n        obj.set({\n          left: obj.left + offsetX,\n          top: obj.top + offsetY,\n        });\n        obj.setCoords();\n        this.canvas.renderAll();\n      }\n      return;\n    }\n\n    // Handle single items with customData\n    if (!obj.customData) return;\n\n    let isOutOfBounds = false;\n\n    // Get center position (obj.left/top are already center due to originX/Y: 'center')\n    const centerX = obj.left;\n    const centerY = obj.top;\n\n    // Use actual item rectangle dimensions from customData (not group bounding box)\n    // This prevents label text from affecting boundary calculations\n    const itemWidth = Helpers.feetToPx(obj.customData.widthFt);\n    const itemHeight = Helpers.feetToPx(obj.customData.lengthFt);\n\n    // Calculate rotated bounding box dimensions\n    const angle = ((obj.angle || 0) * Math.PI) / 180;\n    const cos = Math.abs(Math.cos(angle));\n    const sin = Math.abs(Math.sin(angle));\n    const halfWidth = (itemWidth * cos + itemHeight * sin) / 2;\n    const halfHeight = (itemWidth * sin + itemHeight * cos) / 2;\n\n    let newX = centerX;\n    let newY = centerY;\n\n    // Constrain left\n    if (centerX - halfWidth < floorPlan.left) {\n      newX = floorPlan.left + halfWidth;\n      isOutOfBounds = true;\n    }\n\n    // Constrain right\n    if (centerX + halfWidth > floorPlan.left + floorPlan.width) {\n      newX = floorPlan.left + floorPlan.width - halfWidth;\n      isOutOfBounds = true;\n    }\n\n    // Constrain top\n    if (centerY - halfHeight < floorPlan.top) {\n      newY = floorPlan.top + halfHeight;\n      isOutOfBounds = true;\n    }\n\n    // Constrain bottom\n    if (centerY + halfHeight > floorPlan.top + floorPlan.height) {\n      newY = floorPlan.top + floorPlan.height - halfHeight;\n      isOutOfBounds = true;\n    }\n\n    if (isOutOfBounds) {\n      obj.set({ left: newX, top: newY });\n      obj.setCoords();\n      this.canvas.renderAll();\n    }\n  }\n\n  /**\n   * Handle mouse wheel for zoom\n   */\n  handleMouseWheel(opt) {\n    const delta = opt.e.deltaY;\n    let zoom = this.canvas.getZoom();\n    zoom *= 0.999 ** delta;\n\n    // Limit zoom to match slider range (10% - 200%)\n    if (zoom > 2) zoom = 2;\n    if (zoom < 0.1) zoom = 0.1;\n\n    const canvasPoint = new fabric.Point(opt.e.offsetX, opt.e.offsetY);\n    this.canvas.zoomToPoint(canvasPoint, zoom);\n\n    // User manually zoomed - exit auto-fit mode\n    this.isAutoFitMode = false;\n\n    opt.e.preventDefault();\n    opt.e.stopPropagation();\n\n    this.eventBus.emit('canvas:zoomed', zoom);\n  }\n\n  /**\n   * Show empty state message\n   */\n  showEmptyState() {\n    // Remove existing empty state if any\n    if (this.emptyStateGroup) {\n      this.canvas.remove(this.emptyStateGroup);\n      this.emptyStateGroup = null;\n    }\n\n    const canvasWidth = this.canvas.getWidth();\n    const canvasHeight = this.canvas.getHeight();\n\n    // Create grid icon using basic shapes\n    const gridSize = 80;\n    const gridSpacing = 28;\n    const gridColor = '#D1D5DB';\n\n    const gridSquares = [];\n    for (let row = 0; row < 3; row++) {\n      for (let col = 0; col < 3; col++) {\n        const square = new fabric.Rect({\n          left: col * gridSpacing - gridSize / 2,\n          top: row * gridSpacing - gridSize / 2,\n          width: 20,\n          height: 20,\n          fill: gridColor,\n          rx: 3,\n          ry: 3,\n        });\n        gridSquares.push(square);\n      }\n    }\n\n    // Create title text\n    const title = new fabric.Text('Start Planning Your Space', {\n      left: 0,\n      top: gridSize / 2 + 20,\n      fontSize: 24,\n      fontWeight: '600',\n      fill: '#18181B',\n      originX: 'center',\n      originY: 'center',\n      fontFamily: 'system-ui, -apple-system, sans-serif',\n    });\n\n    // Create subtitle text\n    const subtitle = new fabric.Text('Select a floor plan from the sidebar', {\n      left: 0,\n      top: gridSize / 2 + 55,\n      fontSize: 15,\n      fill: '#71717A',\n      originX: 'center',\n      originY: 'center',\n      fontFamily: 'system-ui, -apple-system, sans-serif',\n    });\n\n    // Group all elements\n    this.emptyStateGroup = new fabric.Group([...gridSquares, title, subtitle], {\n      left: canvasWidth / 2,\n      top: canvasHeight / 2,\n      originX: 'center',\n      originY: 'center',\n      selectable: false,\n      evented: false,\n    });\n\n    this.canvas.add(this.emptyStateGroup);\n    this.canvas.renderAll();\n  }\n\n  /**\n   * Hide empty state message\n   */\n  hideEmptyState() {\n    if (this.emptyStateGroup) {\n      this.canvas.remove(this.emptyStateGroup);\n      this.canvas.renderAll();\n    }\n  }\n\n  /**\n   * Draw floor plan\n   */\n  drawFloorPlan(floorPlan) {\n    // Hide empty state\n    this.hideEmptyState();\n\n    // Clear existing floor plan\n    if (this.floorPlanRect) {\n      this.canvas.remove(this.floorPlanRect);\n    }\n    if (this.entryZoneRect) {\n      this.canvas.remove(this.entryZoneRect);\n    }\n    if (this.entryZoneLabel) {\n      this.canvas.remove(this.entryZoneLabel);\n    }\n\n    const width = Helpers.feetToPx(floorPlan.widthFt);\n    const height = Helpers.feetToPx(floorPlan.heightFt);\n\n    // Store dimensions for re-centering on resize\n    this.floorPlanWidth = width;\n    this.floorPlanHeight = height;\n\n    // Create floor plan rectangle\n    this.floorPlanRect = new fabric.Rect({\n      left: 0,\n      top: 0,\n      width: width,\n      height: height,\n      fill: Config.COLORS.floorPlan,\n      stroke: Config.COLORS.floorPlanStroke,\n      strokeWidth: 2,\n      selectable: false,\n      evented: false,\n    });\n\n    // Create entry zone\n    const entryZonePosition = this.state.get('settings.entryZonePosition') || 'bottom';\n    const showEntryBorder = this.state.get('settings.showEntryZoneBorder') !== false;\n    const showEntryLabel = this.state.get('settings.showEntryZoneLabel') !== false;\n\n    let entryLeft, entryTop, entryWidth, entryHeight, labelLeft, labelTop;\n\n    if (entryZonePosition === 'left' || entryZonePosition === 'right') {\n      // Vertical entry zone (left or right side)\n      entryWidth = width * Config.ENTRY_ZONE_PERCENTAGE;\n      entryHeight = height;\n      entryLeft = entryZonePosition === 'left' ? 0 : width - entryWidth;\n      entryTop = 0;\n      labelLeft = entryLeft + entryWidth / 2;\n      labelTop = height / 2;\n    } else {\n      // Horizontal entry zone (top or bottom)\n      entryWidth = width;\n      entryHeight = height * Config.ENTRY_ZONE_PERCENTAGE;\n      entryLeft = 0;\n      entryTop = entryZonePosition === 'top' ? 0 : height - entryHeight;\n      labelLeft = width / 2;\n      labelTop = entryTop + entryHeight / 2;\n    }\n\n    this.entryZoneRect = new fabric.Rect({\n      left: entryLeft,\n      top: entryTop,\n      width: entryWidth,\n      height: entryHeight,\n      fill: Config.COLORS.entryZone,\n      stroke: '#D32F2F',\n      strokeWidth: 2,\n      selectable: false,\n      evented: false,\n      opacity: showEntryBorder ? 1 : 0,\n    });\n\n    // Add entry zone label with rotation for vertical positions\n    const labelAngle = entryZonePosition === 'left' || entryZonePosition === 'right' ? 90 : 0;\n\n    this.entryZoneLabel = new fabric.Text('ENTRY ZONE', {\n      left: labelLeft,\n      top: labelTop,\n      fontSize: 12,\n      fill: '#D32F2F',\n      fontWeight: 'bold',\n      originX: 'center',\n      originY: 'center',\n      angle: labelAngle,\n      selectable: false,\n      evented: false,\n      opacity: showEntryLabel ? 0.8 : 0,\n    });\n\n    this.canvas.add(this.floorPlanRect);\n    this.canvas.add(this.entryZoneRect);\n    this.canvas.add(this.entryZoneLabel);\n\n    // Draw grid if enabled\n    if (this.state.get('settings.showGrid')) {\n      this.drawGrid(width, height);\n    } else {\n      this.gridLines.forEach((line) => this.canvas.remove(line));\n      this.gridLines = [];\n    }\n\n    // Ensure core layers remain in the correct order\n    this.setLayerOrder();\n\n    // Center and fit\n    this.centerAndFit(width, height);\n\n    this.canvas.renderAll();\n  }\n\n  /**\n   * Draw grid\n   */\n  drawGrid(width, height) {\n    // Clear existing grid\n    this.gridLines.forEach((line) => this.canvas.remove(line));\n    this.gridLines = [];\n\n    const gridSize = Config.GRID_SIZE;\n\n    const majorLineEvery = gridSize * 5; // Highlight every 5 feet\n\n    // Vertical lines\n    for (let i = 0; i <= width; i += gridSize) {\n      const isMajor = i % majorLineEvery === 0;\n      const line = new fabric.Line([i, 0, i, height], {\n        stroke: Config.COLORS.grid,\n        strokeWidth: isMajor ? 1.25 : 0.5,\n        opacity: isMajor ? 0.35 : 0.18,\n        selectable: false,\n        evented: false,\n      });\n      this.gridLines.push(line);\n      this.canvas.add(line);\n    }\n\n    // Horizontal lines\n    for (let i = 0; i <= height; i += gridSize) {\n      const isMajor = i % majorLineEvery === 0;\n      const line = new fabric.Line([0, i, width, i], {\n        stroke: Config.COLORS.grid,\n        strokeWidth: isMajor ? 1.25 : 0.5,\n        opacity: isMajor ? 0.35 : 0.18,\n        selectable: false,\n        evented: false,\n      });\n      this.gridLines.push(line);\n      this.canvas.add(line);\n    }\n\n    // Note: z-order is set in drawFloorPlan() after grid is drawn\n  }\n\n  /**\n   * Center and fit floor plan in viewport\n   * Sets auto-fit mode flag\n   * If no dimensions provided, uses stored floor plan dimensions\n   */\n  centerAndFit(width, height) {\n    // If no dimensions provided, use stored floor plan dimensions\n    if (width === undefined || height === undefined) {\n      width = this.floorPlanWidth;\n      height = this.floorPlanHeight;\n    }\n\n    if (!width || !height) return; // No floor plan to center\n\n    const canvasWidth = this.canvas.getWidth();\n    const canvasHeight = this.canvas.getHeight();\n\n    const scaleX = (canvasWidth - Config.CANVAS_PADDING * 2) / width;\n    const scaleY = (canvasHeight - Config.CANVAS_PADDING * 2) / height;\n    const scale = Math.min(scaleX, scaleY, 1); // Don't zoom in beyond 1:1\n\n    this.canvas.setViewportTransform([1, 0, 0, 1, 0, 0]); // Reset transform\n    this.canvas.setZoom(scale);\n\n    const offsetX = (canvasWidth - width * scale) / 2;\n    const offsetY = (canvasHeight - height * scale) / 2;\n\n    this.canvas.absolutePan({ x: -offsetX / scale, y: -offsetY / scale });\n\n    // Mark as auto-fit mode (will be preserved during window resize)\n    this.isAutoFitMode = true;\n\n    // Emit zoom event to update UI\n    this.eventBus.emit('canvas:zoomed', scale);\n  }\n\n  /**\n   * Add item to canvas\n   * Always returns a group immediately (synchronous)\n   * If image available, swaps rectangle with image asynchronously\n   */\n  addItem(itemData, x, y) {\n    // Create base group with rectangle immediately\n    const group = this._createBaseGroup(itemData, x, y);\n\n    // Add to canvas and render\n    this.canvas.add(group);\n    this.canvas.renderAll();\n\n    // If image available, start async load to swap rectangle with image\n    if (Config.USE_IMAGES && itemData.canvasImage) {\n      fabric.Image.fromURL(\n        itemData.canvasImage,\n        (img) => {\n          if (!img) {\n            console.warn('[CanvasManager] Failed to load image for item:', itemData.id);\n            return; // Keep rectangle fallback\n          }\n          this._swapGroupImage(group, img, itemData);\n        },\n        { crossOrigin: 'anonymous' },\n      );\n    }\n\n    return group;\n  }\n\n  /**\n   * Create base group with rectangle and label\n   * @private\n   */\n  _createBaseGroup(itemData, x, y) {\n    const width = Helpers.feetToPx(itemData.widthFt);\n    const height = Helpers.feetToPx(itemData.lengthFt);\n\n    // Create rectangle centered at origin\n    const rect = new fabric.Rect({\n      left: -width / 2,\n      top: -height / 2,\n      width: width,\n      height: height,\n      fill: itemData.color || '#2196F3',\n      stroke: '#333',\n      strokeWidth: 2,\n      rx: 4,\n      ry: 4,\n    });\n\n    // Create label at center\n    const label = new fabric.Text(itemData.label, {\n      left: 0,\n      top: 0,\n      fontSize: 11,\n      fill: '#ffffff',\n      fontFamily: 'system-ui, -apple-system, sans-serif',\n      fontWeight: 'bold',\n      originX: 'center',\n      originY: 'center',\n      shadow: new fabric.Shadow({\n        color: 'rgba(0,0,0,0.5)',\n        blur: 3,\n      }),\n    });\n\n    // Group rectangle and label together with CENTER origin\n    const group = new fabric.Group([rect, label], {\n      left: x,\n      top: y,\n      originX: 'center',\n      originY: 'center',\n      selectable: true,\n      evented: true,\n      hasControls: true,\n      hasBorders: true,\n      lockScalingX: false,\n      lockScalingY: false,\n      lockSkewingX: true,\n      lockSkewingY: true,\n      borderColor: '#6366F1',\n      borderScaleFactor: 2,\n      borderDashArray: [5, 5],\n      cornerColor: '#6366F1',\n      cornerStrokeColor: '#ffffff',\n      cornerStyle: 'circle',\n      cornerSize: 14,\n      transparentCorners: false,\n      rotatingPointOffset: 40,\n      padding: 0,\n      shadow: new fabric.Shadow({\n        color: 'rgba(0,0,0,0.3)',\n        blur: 10,\n        offsetX: 2,\n        offsetY: 2,\n      }),\n    });\n\n    group.setControlsVisibility({\n      mt: false,\n      mb: false,\n      ml: false,\n      mr: false,\n      bl: true,\n      br: true,\n      tl: true,\n      tr: true,\n      mtr: true,\n    });\n\n    group.label = label;\n\n    const keepLabelUpright = () => {\n      if (!group.label) return;\n      group.label.set('angle', -group.angle);\n      group.label.setCoords();\n    };\n\n    group.on('rotating', keepLabelUpright);\n    group.on('rotated', keepLabelUpright);\n\n    // Store custom data on group\n    group.customData = { ...itemData };\n\n    return group;\n  }\n\n  /**\n   * Swap rectangle in group with loaded image\n   * @private\n   */\n  _swapGroupImage(group, img, itemData) {\n    if (!group || !img) return;\n\n    const width = Helpers.feetToPx(itemData.widthFt);\n    const height = Helpers.feetToPx(itemData.lengthFt);\n\n    // Scale image to match dimensions\n    img.set({\n      left: -width / 2,\n      top: -height / 2,\n      originX: 'left',\n      originY: 'top',\n    });\n    img.scaleToWidth(width);\n    img.scaleY = height / img.height;\n\n    // Find and remove the rectangle (first child, index 0)\n    const rectChild = group.item(0);\n    if (rectChild && rectChild.type === 'rect') {\n      group.remove(rectChild);\n    }\n\n    // Add image at the beginning (so label stays on top)\n    group.insertAt(img, 0);\n    group.addWithUpdate();\n\n    // Re-render canvas\n    this.canvas.renderAll();\n  }\n\n  /**\n   * Remove item from canvas\n   */\n  removeItem(item) {\n    this.canvas.remove(item);\n  }\n\n  /**\n   * Clear all items (keep floor plan)\n   */\n  clearItems() {\n    const objects = this.canvas.getObjects();\n    objects.forEach((obj) => {\n      if (\n        obj.customData &&\n        !obj.customData.isLabel &&\n        obj !== this.floorPlanRect &&\n        obj !== this.entryZoneRect\n      ) {\n        this.canvas.remove(obj);\n      }\n    });\n  }\n\n  /**\n   * Get canvas as data URL\n   */\n  toDataURL(options = {}) {\n    return this.canvas.toDataURL({\n      format: 'png',\n      quality: 1,\n      multiplier: options.multiplier || 1,\n      ...options,\n    });\n  }\n\n  /**\n   * Clear canvas\n   */\n  clear() {\n    this.canvas.clear();\n\n    // RESET VIEWPORT TRANSFORM (zoom and pan)\n    this.resetViewport();\n\n    this.floorPlanRect = null;\n    this.entryZoneRect = null;\n    this.entryZoneLabel = null;\n    this.gridLines = [];\n    this.emptyStateGroup = null;\n    this.floorPlanWidth = null;\n    this.floorPlanHeight = null;\n  }\n\n  /**\n   * Reset viewport to default (1:1 zoom, no pan)\n   * Ensures canvas is at 100% zoom and centered\n   */\n  resetViewport() {\n    // [CanvasManager] Resetting viewport to default state\n\n    // Reset viewport transform to identity matrix\n    this.canvas.setViewportTransform([1, 0, 0, 1, 0, 0]);\n    this.canvas.setZoom(1);\n    this.canvas.requestRenderAll();\n\n    // Update zoom UI elements\n    this.eventBus.emit('canvas:zoomed', 1);\n\n    const zoomPercentage = document.getElementById('zoom-percentage');\n    if (zoomPercentage) {\n      zoomPercentage.textContent = '100%';\n    }\n\n    const zoomSlider = document.getElementById('zoom-slider');\n    const zoomSliderValue = document.getElementById('zoom-slider-value');\n    if (zoomSlider) {\n      zoomSlider.value = 100;\n    }\n    if (zoomSliderValue) {\n      zoomSliderValue.textContent = '100%';\n    }\n  }\n\n  /**\n   * Get canvas instance\n   */\n  getCanvas() {\n    return this.canvas;\n  }\n\n  /**\n   * Get viewport center in canvas coordinates\n   * Accounts for zoom and pan transformations\n   */\n  getViewportCenter() {\n    const canvas = this.canvas;\n    const vpt = canvas.viewportTransform;\n    const zoom = canvas.getZoom();\n\n    // Convert viewport center to canvas coordinates\n    const centerX = (canvas.width / 2 - vpt[4]) / zoom;\n    const centerY = (canvas.height / 2 - vpt[5]) / zoom;\n\n    return { x: centerX, y: centerY };\n  }\n\n  /**\n   * Zoom in\n   */\n  zoomIn() {\n    const canvas = this.canvas;\n    let zoom = canvas.getZoom();\n    zoom = Math.min(zoom * 1.1, 2); // Max 200%\n\n    canvas.zoomToPoint(new fabric.Point(canvas.width / 2, canvas.height / 2), zoom);\n    canvas.requestRenderAll();\n\n    // User manually zoomed - exit auto-fit mode\n    this.isAutoFitMode = false;\n\n    this.eventBus.emit('canvas:zoomed', zoom);\n  }\n\n  /**\n   * Zoom out\n   */\n  zoomOut() {\n    const canvas = this.canvas;\n    let zoom = canvas.getZoom();\n    zoom = Math.max(zoom / 1.1, 0.1); // Min 10%\n\n    canvas.zoomToPoint(new fabric.Point(canvas.width / 2, canvas.height / 2), zoom);\n    canvas.requestRenderAll();\n\n    // User manually zoomed - exit auto-fit mode\n    this.isAutoFitMode = false;\n\n    this.eventBus.emit('canvas:zoomed', zoom);\n  }\n\n  /**\n   * Set zoom to specific percentage (10-200%)\n   */\n  setZoomPercent(percent) {\n    const canvas = this.canvas;\n    // Clamp to slider range\n    const clampedPercent = Math.max(10, Math.min(200, percent));\n    const zoom = clampedPercent / 100;\n\n    // Get current viewport center\n    const vpt = canvas.viewportTransform;\n    const centerX = (canvas.width / 2 - vpt[4]) / vpt[0];\n    const centerY = (canvas.height / 2 - vpt[5]) / vpt[3];\n\n    // Calculate new viewport transform to keep the same center point\n    const newVpt = [zoom, 0, 0, zoom, 0, 0];\n    newVpt[4] = canvas.width / 2 - centerX * zoom;\n    newVpt[5] = canvas.height / 2 - centerY * zoom;\n\n    canvas.setViewportTransform(newVpt);\n    canvas.requestRenderAll();\n\n    // User manually zoomed - exit auto-fit mode\n    this.isAutoFitMode = false;\n\n    this.eventBus.emit('canvas:zoomed', zoom);\n  }\n\n  /**\n   * Reset zoom to auto-fit\n   */\n  resetZoom() {\n    const floorPlan = this.state.get('floorPlan');\n    if (floorPlan) {\n      const width = Helpers.feetToPx(floorPlan.widthFt);\n      const height = Helpers.feetToPx(floorPlan.heightFt);\n      // centerAndFit() will set isAutoFitMode = true\n      this.centerAndFit(width, height);\n    }\n  }\n\n  /**\n   * Toggle grid visibility\n   */\n  toggleGrid() {\n    const currentState = this.state.get('settings.showGrid');\n    this.state.set('settings.showGrid', !currentState);\n\n    const floorPlan = this.state.get('floorPlan');\n    if (floorPlan) {\n      if (!currentState) {\n        const width = Helpers.feetToPx(floorPlan.widthFt);\n        const height = Helpers.feetToPx(floorPlan.heightFt);\n        this.drawGrid(width, height);\n        this.setLayerOrder();\n      } else {\n        this.gridLines.forEach((line) => this.canvas.remove(line));\n        this.gridLines = [];\n      }\n      this.canvas.renderAll();\n    }\n  }\n\n  /**\n   * Toggle item labels visibility\n   */\n  toggleItemLabels(show) {\n    const objects = this.canvas.getObjects();\n    objects.forEach((obj) => {\n      if (obj.type === 'group' && obj.label) {\n        obj.label.set({ visible: show, opacity: show ? 1 : 0 });\n        obj.label.setCoords();\n      }\n    });\n    this.canvas.requestRenderAll();\n  }\n\n  /**\n   * Redraw floor plan with current settings\n   */\n  redrawFloorPlan() {\n    const floorPlan = this.state.get('floorPlan');\n    if (floorPlan) {\n      this.drawFloorPlan(floorPlan);\n    }\n  }\n\n  /**\n   * Keep core canvas layers (floor plan, grid, entry zone) in correct order\n   * Floor plan base (0) -> grid (1) -> entry zone fill (2) -> label (3)\n   */\n  setLayerOrder() {\n    if (!this.canvas) return;\n\n    if (this.floorPlanRect) {\n      this.floorPlanRect.moveTo(0);\n    }\n\n    if (this.gridLines.length > 0) {\n      this.gridLines.forEach((line) => line.moveTo(1));\n    }\n\n    if (this.entryZoneRect) {\n      this.entryZoneRect.moveTo(2);\n    }\n\n    if (this.entryZoneLabel) {\n      this.entryZoneLabel.moveTo(3);\n    }\n  }\n\n  /**\n   * Ensure static layers (floor plan, grid, entry zone) stay behind items\n   * Called after bring-front/send-back operations to prevent items from going behind floor plan\n   */\n  ensureStaticLayersBehind() {\n    if (!this.canvas) return;\n\n    const objects = this.canvas.getObjects();\n    const staticObjects = objects.filter(\n      (obj) =>\n        obj.customData?.isFloorPlan ||\n        obj.customData?.isGrid ||\n        obj.customData?.isEntryZone ||\n        obj.customData?.isEntryLabel,\n    );\n\n    staticObjects.forEach((obj) => obj.sendToBack());\n    this.canvas.renderAll();\n  }\n}\n\n// Make available globally\nif (typeof window !== 'undefined') {\n  window.CanvasManager = CanvasManager;\n}\n","size_bytes":26905},"docs/FEATURES.md":{"content":"# Features Documentation\n\nComplete list of all features in Garage Layout Planner.\n\n## Phase 1 Features (MVP - Implemented) ✓\n\n### Core Functionality (Features 1-7)\n\n✓ **1. Floor Plan Selection**\n\n- 7 pre-defined rectangular sizes\n- From 500 sq ft to 1,200 sq ft\n- Instant visual preview\n- Click to select\n\n✓ **2. Item Palette**\n\n- 20+ realistic items\n- 3 categories: Vehicles, Recreational, Storage\n- Visual icons with dimensions\n- Click to add to canvas\n\n✓ **3. Drag and Drop**\n\n- Smooth drag interaction\n- Real-time position updates\n- Visual feedback\n\n✓ **4. Move Items**\n\n- Mouse drag\n- Arrow key nudging (2px)\n- Shift+Arrow for large nudge (10px)\n\n✓ **5. Boundary Detection**\n\n- Items stay inside floor plan\n- Automatic constraint on move\n- Visual boundaries\n\n✓ **6. Entry Zone**\n\n- Bottom 20% highlighted\n- Visual warning overlay\n- Prevents blocking garage door\n\n✓ **7. Real-time Info Panel**\n\n- Floor plan dimensions\n- Selected item details\n- Position coordinates\n- Item count\n\n### Selection & Manipulation (Features 8-16)\n\n✓ **8. Select Items (Click)**\n\n- Single-click selection\n- Visual selection indicator\n- Info panel updates\n\n✓ **9. Multi-Select**\n\n- Shift+click for multiple\n- Drag selection box (Fabric.js)\n- Group operations\n\n✓ **10. Group/Ungroup**\n\n- Group selected items\n- Move as single unit\n- Ungroup to separate\n\n✓ **11. Rotate Items**\n\n- 90° rotation button\n- R key for quick rotate\n- Shift+drag for free rotation\n- Angle display\n\n✓ **12. Duplicate Items**\n\n- Duplicate button\n- Ctrl+D shortcut\n- Offset placement\n\n✓ **13. Delete Items**\n\n- Delete button\n- Delete/Backspace keys\n- Confirmation for multiple\n\n✓ **14. Copy/Paste**\n\n- Ctrl+C to copy\n- Ctrl+V to paste\n- Preserves item properties\n\n✓ **15. Z-Order Control**\n\n- Bring to front\n- Send to back\n- Stacking control\n\n✓ **16. Lock/Unlock**\n\n- Lock item movement\n- Prevent accidental changes\n- Visual locked indicator\n\n### Keyboard Shortcuts (Features 17-24)\n\n✓ **17. Arrow Keys**\n\n- Nudge 2px\n- Shift for 10px\n- All 4 directions\n\n✓ **18. Delete/Backspace**\n\n- Remove selected items\n- Works with multi-select\n\n✓ **19. R Key**\n\n- Rotate 90° clockwise\n- Quick rotation\n\n✓ **20. Ctrl+D**\n\n- Duplicate selected\n- Fast workflow\n\n✓ **21. Ctrl+C/V**\n\n- Copy and paste\n- Standard clipboard behavior\n\n✓ **22. Ctrl+Z/Y**\n\n- Undo last action\n- Redo undone action\n- 50-level history\n\n✓ **23. Ctrl+A**\n\n- Select all items\n- Quick selection\n\n✓ **24. Esc**\n\n- Deselect all\n- Clear selection\n\n### Alignment Tools (Features 25-28)\n\n✓ **25. Align Edges**\n\n- Left edge alignment\n- Right edge alignment\n- Top edge alignment\n- Bottom edge alignment\n\n✓ **26. Center Alignment**\n\n- Horizontal center\n- Vertical center (middle)\n\n✓ **27. Snap to Grid**\n\n- Toggle on/off\n- 1-foot increments\n- Precise placement\n\n✓ **28. Snap to Items**\n\n- Alignment guides\n- Edge detection\n- Proximity snapping\n\n### Dimensions & Measurements (Features 29-34)\n\n✓ **29. Hover Dimensions**\n\n- Show size on hover\n- Length × width display\n\n✓ **30. Dimension Lines**\n\n- On selected items\n- Visual measurement\n\n✓ **31. Distance Tool**\n\n- Click two points\n- Calculate distance\n- Show measurement line\n\n✓ **32. Ruler Overlay**\n\n- Optional toggle\n- Grid measurements\n- Scale indicator\n\n✓ **33. Unit Toggle**\n\n- Feet or meters\n- Automatic conversion\n- Persistent setting\n\n✓ **34. Area Calculation**\n\n- Total floor space\n- Occupied space\n- Occupancy percentage\n\n### Labels & Annotations (Features 35-39)\n\n✓ **35. Toggle Labels**\n\n- Show/hide all labels\n- Global control\n\n✓ **36. Rename Items**\n\n- Double-click to rename\n- Custom labels\n\n✓ **37. Upright Text**\n\n- Labels never rotate\n- Always readable\n\n✓ **38. Custom Annotations**\n\n- Add text anywhere\n- Notes and markers\n\n✓ **39. Font Size Control**\n\n- Adjust label size\n- Improve readability\n\n### Save/Load/Export (Features 40-47)\n\n✓ **40. Save Layout**\n\n- Custom name\n- localStorage storage\n- Metadata tracking\n\n✓ **41. Auto-Save**\n\n- Every 30 seconds\n- Automatic backup\n- Recovery on reload\n\n✓ **42. Load Layouts**\n\n- List saved layouts\n- Thumbnail preview\n- One-click load\n\n✓ **43. Delete Layouts**\n\n- Remove saved layouts\n- Confirmation dialog\n\n✓ **44. Export JSON**\n\n- Complete layout data\n- Human-readable format\n- Download file\n\n✓ **45. Export PNG**\n\n- 1x, 2x, 4x resolutions\n- High-quality images\n- Transparent background option\n\n✓ **46. Export PDF**\n\n- Professional format\n- Header with project info\n- Item list table\n- Footer with specifications\n- Multiple page layouts\n\n✓ **47. Print Layout**\n\n- Optimized for printing\n- Proper scaling\n- Page breaks\n\n### Visual Tools (Features 48-52)\n\n✓ **48. Magnifying Glass**\n\n- 2.5x zoom\n- Adjustable size\n- Crosshair indicator\n- Follow mouse\n\n✓ **49. Grid Toggle**\n\n- Show/hide grid\n- 1-foot squares\n- Visual reference\n\n✓ **50. Canvas Zoom**\n\n- Mouse wheel zoom\n- Pinch zoom (touch)\n- Zoom limits (0.1x - 20x)\n\n✓ **51. Canvas Pan**\n\n- Drag to pan\n- Touch drag\n- Reset view\n\n✓ **52. Full-Screen Mode**\n\n- Maximize canvas\n- Hide sidebars\n- F11 or button\n\n### Undo/Redo System (Features 53-57)\n\n✓ **53. History Stack**\n\n- 50 levels deep\n- State snapshots\n- Memory efficient\n\n✓ **54. Undo (Ctrl+Z)**\n\n- Revert last change\n- Restore previous state\n- Visual feedback\n\n✓ **55. Redo (Ctrl+Y)**\n\n- Reapply undone change\n- Forward in history\n\n✓ **56. Clear History**\n\n- Reset history stack\n- Free memory\n\n✓ **57. Visual Indicators**\n\n- Undo/redo availability\n- Button states\n- Keyboard hints\n\n### UI/UX Features (Features 58-64)\n\n✓ **58. Empty State**\n\n- \"Select a floor plan to start\"\n- Clear instructions\n- Visual guidance\n\n✓ **59. Loading States**\n\n- Operation feedback\n- Progress indicators\n\n✓ **60. Confirm Dialogs**\n\n- Destructive actions\n- Prevent mistakes\n- Clear options\n\n✓ **61. Tooltips**\n\n- Hover hints\n- Keyboard shortcuts\n- Feature descriptions\n\n✓ **62. Shortcut Cheat Sheet**\n\n- Modal with all shortcuts\n- Organized by category\n- Printable reference\n\n✓ **63. Responsive Design**\n\n- Works on tablets\n- Adaptive layout\n- Touch-friendly\n\n✓ **64. Touch Support**\n\n- Pinch zoom\n- Touch drag\n- Long press\n- Gesture support\n\n## Feature Statistics\n\n**Total Phase 1 Features:** 64  \n**Implemented:** 64  \n**Completion:** 100%\n\n## Technical Features\n\n### Architecture\n\n- ✓ State Management with Observer Pattern\n- ✓ Event Bus for Decoupled Communication\n- ✓ 6 Manager Classes\n- ✓ Modular File Structure\n- ✓ Zero Global Variables (except app)\n- ✓ Serializable State\n\n### Performance\n\n- ✓ Debounced Mouse Events\n- ✓ Throttled Canvas Renders\n- ✓ Lazy Loading\n- ✓ Efficient Re-renders\n- ✓ Memory Management\n\n### Code Quality\n\n- ✓ JSDoc Comments\n- ✓ Error Handling\n- ✓ Input Validation\n- ✓ Graceful Degradation\n- ✓ No Global Pollution\n\n## Browser Features\n\n### Supported\n\n- ✓ Modern ES6+ JavaScript\n- ✓ Canvas API\n- ✓ localStorage\n- ✓ File Download\n- ✓ CSS Grid/Flexbox\n- ✓ Touch Events\n- ✓ Pointer Events\n\n### CDN Libraries\n\n- ✓ Fabric.js 5.3.0\n- ✓ Turf.js 6.x\n- ✓ jsPDF 2.5.1\n- ✓ html2canvas 1.4.1\n\n## Quality Metrics\n\n### Performance\n\n- First Load: < 2s\n- Render 50 items: < 100ms\n- Zoom/Pan: 60fps\n- Export PNG: < 3s\n- Export PDF: < 5s\n\n### Compatibility\n\n- Chrome 90+ ✓\n- Firefox 88+ ✓\n- Safari 14+ ✓\n- Edge 90+ ✓\n- Mobile Safari ✓\n- Chrome Mobile ✓\n\n---\n\n**Version:** 1.0.0  \n**Status:** Production Ready  \n**Last Updated:** November 2025\n","size_bytes":7456},"js/utils/bounds.js":{"content":"/* global Helpers, Config */\n\n/**\n * Boundary Detection Utilities\n * Handle item constraints within floor plan\n */\nconst Bounds = {\n  /**\n   * Constrain item to floor plan boundaries\n   */\n  constrainToBounds(item, floorPlan) {\n    if (!floorPlan) return;\n\n    const itemBounds = item.getBoundingRect();\n    const maxX = Helpers.feetToPx(floorPlan.widthFt);\n    const maxY = Helpers.feetToPx(floorPlan.heightFt);\n\n    let newLeft = item.left;\n    let newTop = item.top;\n\n    // Check left boundary\n    if (itemBounds.left < 0) {\n      newLeft = item.left - itemBounds.left;\n    }\n\n    // Check right boundary\n    if (itemBounds.left + itemBounds.width > maxX) {\n      newLeft = item.left - (itemBounds.left + itemBounds.width - maxX);\n    }\n\n    // Check top boundary\n    if (itemBounds.top < 0) {\n      newTop = item.top - itemBounds.top;\n    }\n\n    // Check bottom boundary\n    if (itemBounds.top + itemBounds.height > maxY) {\n      newTop = item.top - (itemBounds.top + itemBounds.height - maxY);\n    }\n\n    item.set({ left: newLeft, top: newTop });\n    item.setCoords();\n  },\n\n  /**\n   * Check if item is within floor plan\n   */\n  isWithinBounds(item, floorPlan) {\n    if (!floorPlan) return false;\n\n    const itemBounds = item.getBoundingRect();\n    const maxX = Helpers.feetToPx(floorPlan.widthFt);\n    const maxY = Helpers.feetToPx(floorPlan.heightFt);\n\n    return (\n      itemBounds.left >= 0 &&\n      itemBounds.top >= 0 &&\n      itemBounds.left + itemBounds.width <= maxX &&\n      itemBounds.top + itemBounds.height <= maxY\n    );\n  },\n\n  /**\n   * Check if item is in entry zone\n   * Supports all 4 entry zone positions (top, bottom, left, right)\n   */\n  isInEntryZone(item, floorPlan, entryZonePosition) {\n    if (!floorPlan) return false;\n\n    const itemBounds = item.getBoundingRect();\n    const floorPlanWidth = Helpers.feetToPx(floorPlan.widthFt);\n    const floorPlanHeight = Helpers.feetToPx(floorPlan.heightFt);\n    const position = entryZonePosition || 'bottom';\n\n    // Calculate entry zone bounds based on position\n    if (position === 'bottom') {\n      const entryZoneStart = floorPlanHeight * (1 - Config.ENTRY_ZONE_PERCENTAGE);\n      return itemBounds.top + itemBounds.height > entryZoneStart;\n    } else if (position === 'top') {\n      const entryZoneEnd = floorPlanHeight * Config.ENTRY_ZONE_PERCENTAGE;\n      return itemBounds.top < entryZoneEnd;\n    } else if (position === 'left') {\n      const entryZoneEnd = floorPlanWidth * Config.ENTRY_ZONE_PERCENTAGE;\n      return itemBounds.left < entryZoneEnd;\n    } else if (position === 'right') {\n      const entryZoneStart = floorPlanWidth * (1 - Config.ENTRY_ZONE_PERCENTAGE);\n      return itemBounds.left + itemBounds.width > entryZoneStart;\n    }\n\n    return false;\n  },\n\n  /**\n   * Snap to grid\n   */\n  snapToGrid(value, gridSize = Config.GRID_SIZE) {\n    return Math.round(value / gridSize) * gridSize;\n  },\n\n  /**\n   * Snap item to grid\n   */\n  snapItemToGrid(item, gridSize = Config.GRID_SIZE) {\n    item.set({\n      left: this.snapToGrid(item.left, gridSize),\n      top: this.snapToGrid(item.top, gridSize),\n    });\n    item.setCoords();\n  },\n\n  /**\n   * Get item bounds as object\n   */\n  getItemBounds(item) {\n    const bounds = item.getBoundingRect();\n    return {\n      left: bounds.left,\n      top: bounds.top,\n      right: bounds.left + bounds.width,\n      bottom: bounds.top + bounds.height,\n      width: bounds.width,\n      height: bounds.height,\n    };\n  },\n\n  /**\n   * Check if two items overlap\n   */\n  itemsOverlap(item1, item2) {\n    const b1 = this.getItemBounds(item1);\n    const b2 = this.getItemBounds(item2);\n\n    return Helpers.rectanglesOverlap(b1, b2);\n  },\n\n  /**\n   * Find nearby items for snapping\n   */\n  findNearbyItems(targetItem, allItems, threshold = 5) {\n    const nearby = [];\n    const targetBounds = this.getItemBounds(targetItem);\n\n    allItems.forEach((item) => {\n      if (item === targetItem) return;\n\n      const itemBounds = this.getItemBounds(item);\n\n      // Check if edges are close\n      const edges = [\n        { type: 'left', dist: Math.abs(targetBounds.left - itemBounds.left) },\n        { type: 'right', dist: Math.abs(targetBounds.right - itemBounds.right) },\n        { type: 'top', dist: Math.abs(targetBounds.top - itemBounds.top) },\n        { type: 'bottom', dist: Math.abs(targetBounds.bottom - itemBounds.bottom) },\n        {\n          type: 'centerX',\n          dist: Math.abs(\n            (targetBounds.left + targetBounds.right) / 2 - (itemBounds.left + itemBounds.right) / 2,\n          ),\n        },\n        {\n          type: 'centerY',\n          dist: Math.abs(\n            (targetBounds.top + targetBounds.bottom) / 2 - (itemBounds.top + itemBounds.bottom) / 2,\n          ),\n        },\n      ];\n\n      edges.forEach((edge) => {\n        if (edge.dist < threshold) {\n          nearby.push({\n            item,\n            edge: edge.type,\n            distance: edge.dist,\n          });\n        }\n      });\n    });\n\n    return nearby;\n  },\n};\n\n// Make available globally\nif (typeof window !== 'undefined') {\n  window.Bounds = Bounds;\n}\n","size_bytes":5071},"docs/ARCHITECTURE.md":{"content":"# Architecture Documentation\n\n## System Overview\n\nThe Garage Layout Planner is built with a modular, scalable architecture using pure JavaScript with no frameworks. It follows enterprise-grade design patterns including State Management, Event Bus, and Manager pattern.\n\n## Core Principles\n\n1. **No Global Variables** - Only the `app` instance is global\n2. **Single Source of Truth** - Centralized State management\n3. **Decoupled Communication** - Event Bus pattern\n4. **Separation of Concerns** - Manager classes for each domain\n5. **Serializable State** - Can convert to/from JSON\n6. **Modular Design** - Each file is self-contained\n\n## Architecture Diagram\n\n```\n┌─────────────────────────────────────────┐\n│           User Interface Layer           │\n│  ┌─────────┐  ┌─────────┐  ┌──────────┐│\n│  │Toolbar  │  │Sidebar  │  │InfoPanel ││\n│  └─────────┘  └─────────┘  └──────────┘│\n└───────────────┬─────────────────────────┘\n                │\n┌───────────────▼─────────────────────────┐\n│          Application Controller          │\n│           (App.js - Main)                │\n└───────────────┬─────────────────────────┘\n                │\n    ┌───────────┴───────────┐\n    ▼                       ▼\n┌───────┐            ┌─────────────┐\n│State  │◄───────────┤  EventBus   │\n└───┬───┘            └──────┬──────┘\n    │                       │\n    │    ┌──────────────────┴──────────────┐\n    ▼    ▼                  ▼               ▼\n┌──────────────┐  ┌──────────────┐  ┌──────────────┐\n│CanvasManager │  │FloorPlanMgr  │  │  ItemManager │\n└──────────────┘  └──────────────┘  └──────────────┘\n    ▼                  ▼                  ▼\n┌──────────────┐  ┌──────────────┐  ┌──────────────┐\n│SelectionMgr  │  │ ExportManager│  │HistoryMgr    │\n└──────────────┘  └──────────────┘  └──────────────┘\n    │                  │                  │\n    └──────────────────┴──────────────────┘\n                       ▼\n                ┌─────────────┐\n                │  Fabric.js  │\n                │  Canvas API │\n                └─────────────┘\n```\n\n## Core Modules\n\n### 1. State Management (State.js)\n\n**Purpose:** Single source of truth for all application data\n\n**Responsibilities:**\n\n- Store complete application state\n- Implement observer pattern\n- Provide getters/setters\n- Serialize/deserialize state\n- Track state changes\n\n**Key Methods:**\n\n```javascript\nsetState(updates); // Update state and notify observers\ngetState(); // Get complete state (read-only)\nsubscribe(callback); // Subscribe to state changes\nget(path); // Get specific property\nset(path, value); // Set specific property\n```\n\n**State Structure:**\n\n```javascript\n{\n  floorPlan: { id, widthFt, heightFt, ... },\n  items: [{ id, label, x, y, angle, ... }],\n  selection: [...],\n  history: [...],\n  settings: { unit, showGrid, snapToGrid, ... },\n  ui: { sidebarOpen, activeTab, ... },\n  metadata: { projectName, clientName, created, modified }\n}\n```\n\n### 2. Event Bus (EventBus.js)\n\n**Purpose:** Decoupled inter-module communication\n\n**Responsibilities:**\n\n- Publish/subscribe event system\n- Type-safe event handling\n- Error isolation\n\n**Key Events:**\n\n- `item:added`, `item:removed`, `item:selected`, `item:moved`\n- `floorplan:changed`, `floorplan:custom:start`\n- `export:json`, `export:png`, `export:pdf`\n- `history:undo`, `history:redo`, `history:changed`\n- `canvas:zoomed`, `canvas:object:moving`\n\n**Usage:**\n\n```javascript\n// Subscribe\neventBus.on('item:added', (item) => { ... });\n\n// Emit\neventBus.emit('item:added', itemData);\n\n// Unsubscribe\neventBus.off('item:added', callback);\n```\n\n### 3. Configuration (Config.js)\n\n**Purpose:** Central configuration constants\n\n**Key Constants:**\n\n- `PX_PER_FOOT: 10` - Scaling factor\n- `MAX_HISTORY: 50` - History stack size\n- `AUTOSAVE_INTERVAL: 30000` - Auto-save frequency\n- `ENTRY_ZONE_PERCENTAGE: 0.2` - Entry zone size\n- `COLORS` - Color scheme\n- `STORAGE_KEYS` - localStorage keys\n\n## Manager Classes\n\n### CanvasManager\n\n**Responsibilities:**\n\n- Initialize Fabric.js canvas\n- Handle zoom/pan\n- Draw floor plans\n- Add/remove items from canvas\n- Grid rendering\n- Export canvas as image\n\n**Key Methods:**\n\n```javascript\ninit(); // Initialize canvas\ndrawFloorPlan(floorPlan); // Draw floor plan\naddItem(itemData, x, y); // Add item to canvas\nzoomIn() / zoomOut(); // Zoom controls\ntoDataURL(options); // Export as image\n```\n\n### FloorPlanManager\n\n**Responsibilities:**\n\n- Floor plan CRUD operations\n- Validation\n- Area calculations\n- Occupancy tracking\n\n**Key Methods:**\n\n```javascript\nsetFloorPlan(id); // Set active floor plan\ngetAllFloorPlans(); // Get all templates\ngetArea(); // Get total area\ngetOccupiedArea(); // Get occupied area\ngetOccupancyPercentage(); // Calculate occupancy\n```\n\n### ItemManager\n\n**Responsibilities:**\n\n- Item library access\n- Add/remove/update items\n- Duplicate/lock/unlock\n- Search/filter\n\n**Key Methods:**\n\n```javascript\naddItem(itemId, x, y); // Add item\nremoveItem(itemId); // Remove item\nupdateItem(itemId, data); // Update item\nduplicateItem(itemId); // Duplicate item\nlockItem() / unlockItem(); // Lock controls\n```\n\n### SelectionManager\n\n**Responsibilities:**\n\n- Single/multi-select\n- Alignment tools\n- Transform operations (move, rotate, scale)\n- Grouping\n- Z-order control\n\n**Key Methods:**\n\n```javascript\nselectItem(item); // Select single\nselectMultiple(items); // Multi-select\nselectAll(); // Select all\nalignSelected(alignment); // Align items\nrotateSelected(angle); // Rotate items\nbringToFront() / sendToBack(); // Z-order\n```\n\n### ExportManager\n\n**Responsibilities:**\n\n- JSON export\n- PNG export (multiple resolutions)\n- PDF generation\n- Thumbnail generation\n\n**Key Methods:**\n\n```javascript\nexportJSON(); // Export as JSON\nexportPNG(resolution); // Export as PNG\nexportPDF(options); // Generate PDF\ngenerateThumbnail(); // Create thumbnail\n```\n\n### HistoryManager\n\n**Responsibilities:**\n\n- Undo/redo stack\n- State snapshots\n- History navigation\n\n**Key Methods:**\n\n```javascript\nsave(); // Save current state\nundo(); // Undo last change\nredo(); // Redo last undo\ncanUndo() / canRedo(); // Check availability\nclear(); // Clear history\n```\n\n## Utility Modules\n\n### Helpers (helpers.js)\n\n- Unit conversion (feet ↔ pixels, feet ↔ meters)\n- Number formatting\n- ID generation\n- Debounce/throttle\n- Distance/angle calculations\n\n### Storage (storage.js)\n\n- localStorage wrapper\n- Error handling\n- Quota management\n- Size tracking\n\n### Bounds (bounds.js)\n\n- Boundary detection\n- Constraint enforcement\n- Snap to grid\n- Collision detection\n- Proximity detection\n\n### Geometry (geometry.js)\n\n- Turf.js integration\n- Polygon operations\n- Area calculations\n- Point-in-polygon tests\n- Distance calculations\n\n### Validation (validation.js)\n\n- Floor plan validation\n- Item validation\n- Input sanitization\n- Export validation\n\n## Data Flow\n\n### Adding an Item\n\n```\nUser clicks item in palette\n    ↓\nItemManager.addItem()\n    ↓\nCreate item data\n    ↓\nCanvasManager.addItem() → Fabric.js\n    ↓\nUpdate State (items array)\n    ↓\nEventBus.emit('item:added')\n    ↓\nHistoryManager.save()\n    ↓\nInfoPanel updates (via State observer)\n```\n\n### Undo Operation\n\n```\nUser presses Ctrl+Z\n    ↓\nHistoryManager.undo()\n    ↓\nGet previous state snapshot\n    ↓\nState.loadState(previousState)\n    ↓\nState notifies observers\n    ↓\nCanvas refreshes\nInfo panel updates\n```\n\n## Extension Points\n\n### Adding New Features\n\n1. **New Manager**\n   - Create in `js/managers/`\n   - Inject State and EventBus\n   - Initialize in App.js\n\n2. **New Tool**\n   - Create in `js/features/`\n   - Listen to EventBus events\n   - Emit results\n\n3. **New Item Type**\n   - Add to `js/data/items.js`\n   - Extend ItemManager if needed\n\n4. **New Export Format**\n   - Add method to ExportManager\n   - Add UI button\n   - Connect to EventBus\n\n## Performance Considerations\n\n### Optimizations\n\n- Debounce mouse move events (16ms)\n- Throttle canvas re-renders\n- Lazy load templates\n- Cache calculated values\n- Minimize DOM manipulation\n- Use requestAnimationFrame for animations\n\n### Memory Management\n\n- Limit history to 50 states\n- Clear unused canvas objects\n- Remove event listeners on destroy\n- Compress saved states\n\n## Security\n\n### Best Practices\n\n- Sanitize all user input\n- Validate all data before processing\n- No eval() or Function() usage\n- Content Security Policy compatible\n- No inline scripts (except initialization)\n\n## Testing Strategy\n\n### Unit Tests (Future)\n\n- State management logic\n- Geometry calculations\n- Validation functions\n- Utility functions\n\n### Integration Tests (Future)\n\n- Manager interactions\n- Event flow\n- State updates\n\n### E2E Tests (Future)\n\n- User workflows\n- Export functionality\n- Save/load operations\n\n## Browser Compatibility\n\n### Target Browsers\n\n- Chrome 90+\n- Firefox 88+\n- Safari 14+\n- Edge 90+\n\n### No IE11 Support\n\n- Uses ES6 features freely\n- Modern Canvas API\n- CSS Grid/Flexbox\n\n## Deployment\n\n### Static Hosting\n\n- Can be hosted on any static server\n- No backend required\n- CDN-friendly\n\n### Recommended Hosts\n\n- Netlify\n- Vercel\n- GitHub Pages\n- AWS S3 + CloudFront\n- Firebase Hosting\n\n---\n\n**Version:** 1.0.0  \n**Last Updated:** November 2025\n","size_bytes":10469},"js/managers/SelectionManager.js":{"content":"/* global Bounds */\n\n/**\n * Selection Manager\n * Handles item selection, multi-select, and grouping\n */\nclass SelectionManager {\n  constructor(state, eventBus, canvasManager) {\n    this.state = state;\n    this.eventBus = eventBus;\n    this.canvasManager = canvasManager;\n    this.canvas = canvasManager.getCanvas();\n    this.clipboard = null; // For copy/paste\n  }\n\n  /**\n   * Select item\n   */\n  selectItem(item) {\n    this.canvas.setActiveObject(item);\n    this.canvas.renderAll();\n\n    this.state.setState({ selection: [item] });\n    this.eventBus.emit('item:selected', item);\n  }\n\n  /**\n   * Deselect all\n   */\n  deselectAll() {\n    this.canvas.discardActiveObject();\n    this.canvas.renderAll();\n\n    this.state.setState({ selection: null });\n    this.eventBus.emit('selection:cleared');\n  }\n\n  /**\n   * Get selected items\n   */\n  getSelection() {\n    const active = this.canvas.getActiveObject();\n\n    if (!active) return [];\n\n    if (active.type === 'activeSelection') {\n      return active.getObjects();\n    }\n\n    return [active];\n  }\n\n  /**\n   * Select multiple items\n   */\n  selectMultiple(items) {\n    if (items.length === 0) return;\n\n    if (items.length === 1) {\n      this.selectItem(items[0]);\n      return;\n    }\n\n    const selection = new fabric.ActiveSelection(items, {\n      canvas: this.canvas,\n    });\n\n    this.canvas.setActiveObject(selection);\n    this.canvas.renderAll();\n\n    this.state.setState({ selection: items });\n    this.eventBus.emit('items:selected', items);\n  }\n\n  /**\n   * Select all items\n   */\n  selectAll() {\n    const objects = this.canvas.getObjects().filter((obj) => {\n      return (\n        obj.customData &&\n        !obj.customData.isLabel &&\n        obj !== this.canvasManager.floorPlanRect &&\n        obj !== this.canvasManager.entryZoneRect\n      );\n    });\n\n    this.selectMultiple(objects);\n  }\n\n  /**\n   * Delete selected items\n   */\n  deleteSelected() {\n    const selected = this.getSelection();\n\n    selected.forEach((item) => {\n      if (item.customData && item.customData.id) {\n        this.eventBus.emit('item:delete:requested', item.customData.id);\n      }\n    });\n\n    this.deselectAll();\n  }\n\n  /**\n   * Duplicate selected items\n   */\n  duplicateSelected() {\n    const selected = this.getSelection();\n\n    selected.forEach((item) => {\n      if (item.customData && item.customData.id) {\n        this.eventBus.emit('item:duplicate:requested', item.customData.id);\n      }\n    });\n  }\n\n  /**\n   * Copy selected items to clipboard\n   */\n  copySelected() {\n    const selected = this.getSelection();\n    if (selected.length === 0) return;\n\n    this.clipboard = selected\n      .map((item) => {\n        if (item.customData) {\n          // Use Fabric's getCenterPoint() for accurate center even when rotated\n          const center = item.getCenterPoint();\n\n          return {\n            itemId: item.customData.itemId,\n            id: item.customData.id,\n            label: item.customData.label,\n            widthFt: item.customData.widthFt,\n            lengthFt: item.customData.lengthFt,\n            category: item.customData.category,\n            x: center.x,\n            y: center.y,\n            angle: item.angle || 0,\n          };\n        }\n        return null;\n      })\n      .filter((item) => item !== null);\n  }\n\n  /**\n   * Paste items from clipboard\n   */\n  pasteSelected() {\n    if (!this.clipboard || this.clipboard.length === 0) return;\n\n    this.clipboard.forEach((item) => {\n      this.eventBus.emit('item:paste:requested', item);\n    });\n  }\n\n  /**\n   * Rotate selected items\n   */\n  rotateSelected(angle) {\n    const selected = this.getSelection();\n\n    selected.forEach((item) => {\n      const currentAngle = item.angle || 0;\n      item.rotate(currentAngle + angle);\n\n      // Update state if item has customData\n      if (item.customData && item.customData.id) {\n        const items = this.state.get('items') || [];\n        const stateItem = items.find((i) => i.id === item.customData.id);\n        if (stateItem) {\n          stateItem.angle = item.angle;\n        }\n      }\n    });\n\n    // Update state with modified items\n    if (selected.length > 0 && selected[0].customData) {\n      const items = this.state.get('items') || [];\n      this.state.setState({ items });\n    }\n\n    this.canvas.renderAll();\n    this.eventBus.emit('items:rotated', selected);\n  }\n\n  /**\n   * Move selected items\n   */\n  moveSelected(dx, dy) {\n    const selected = this.getSelection();\n\n    selected.forEach((item) => {\n      item.set({\n        left: item.left + dx,\n        top: item.top + dy,\n      });\n      item.setCoords();\n    });\n\n    this.canvas.renderAll();\n\n    // Emit canvas:object:modified for each moved item so history, validation, and state updates occur\n    selected.forEach((item) => {\n      this.eventBus.emit('canvas:object:modified', item);\n    });\n\n    this.eventBus.emit('items:moved', selected);\n  }\n\n  /**\n   * Align selected items\n   */\n  alignSelected(alignment) {\n    const selected = this.getSelection();\n    if (selected.length < 2) return;\n\n    const bounds = selected.map((item) => Bounds.getItemBounds(item));\n\n    switch (alignment) {\n      case 'left': {\n        const minLeft = Math.min(...bounds.map((b) => b.left));\n        selected.forEach((item, i) => {\n          item.set({ left: item.left + (minLeft - bounds[i].left) });\n          item.setCoords();\n        });\n        break;\n      }\n\n      case 'right': {\n        const maxRight = Math.max(...bounds.map((b) => b.right));\n        selected.forEach((item, i) => {\n          item.set({ left: item.left + (maxRight - bounds[i].right) });\n          item.setCoords();\n        });\n        break;\n      }\n\n      case 'top': {\n        const minTop = Math.min(...bounds.map((b) => b.top));\n        selected.forEach((item, i) => {\n          item.set({ top: item.top + (minTop - bounds[i].top) });\n          item.setCoords();\n        });\n        break;\n      }\n\n      case 'bottom': {\n        const maxBottom = Math.max(...bounds.map((b) => b.bottom));\n        selected.forEach((item, i) => {\n          item.set({ top: item.top + (maxBottom - bounds[i].bottom) });\n          item.setCoords();\n        });\n        break;\n      }\n\n      case 'center': {\n        const avgCenterX =\n          bounds.reduce((sum, b) => sum + (b.left + b.right) / 2, 0) / bounds.length;\n        selected.forEach((item, i) => {\n          const itemCenterX = (bounds[i].left + bounds[i].right) / 2;\n          item.set({ left: item.left + (avgCenterX - itemCenterX) });\n          item.setCoords();\n        });\n        break;\n      }\n\n      case 'middle': {\n        const avgCenterY =\n          bounds.reduce((sum, b) => sum + (b.top + b.bottom) / 2, 0) / bounds.length;\n        selected.forEach((item, i) => {\n          const itemCenterY = (bounds[i].top + bounds[i].bottom) / 2;\n          item.set({ top: item.top + (avgCenterY - itemCenterY) });\n          item.setCoords();\n        });\n        break;\n      }\n    }\n\n    this.canvas.renderAll();\n    this.eventBus.emit('items:aligned', selected);\n  }\n\n  /**\n   * Bring selected to front\n   */\n  bringToFront() {\n    const selected = this.getSelection();\n    selected.forEach((item) => item.bringToFront());\n    \n    // Ensure floor plan elements stay in correct order after bringing items forward\n    if (this.canvasManager.floorPlanRect) {\n      this.canvasManager.floorPlanRect.moveTo(0);\n    }\n    if (this.canvasManager.entryZoneRect) {\n      this.canvasManager.entryZoneRect.moveTo(1);\n    }\n    if (this.canvasManager.entryZoneLabel) {\n      this.canvasManager.entryZoneLabel.moveTo(2);\n    }\n    this.canvasManager.gridLines.forEach((line) => line.moveTo(3));\n    \n    this.canvas.renderAll();\n  }\n\n  /**\n   * Send selected to back\n   */\n  sendToBack() {\n    const selected = this.getSelection();\n\n    // Send items to layer 4 (above grid at 3, but below other items)\n    // Layers: 0=floor, 1=entry zone, 2=entry label, 3=grid, 4+=items\n    selected.forEach((item) => {\n      item.moveTo(4);\n    });\n\n    // Ensure floor plan elements stay in correct order\n    if (this.canvasManager.floorPlanRect) {\n      this.canvasManager.floorPlanRect.moveTo(0);\n    }\n    if (this.canvasManager.entryZoneRect) {\n      this.canvasManager.entryZoneRect.moveTo(1);\n    }\n    if (this.canvasManager.entryZoneLabel) {\n      this.canvasManager.entryZoneLabel.moveTo(2);\n    }\n\n    // Keep grid above floor plan but below items\n    this.canvasManager.gridLines.forEach((line) => line.moveTo(3));\n\n    this.canvas.renderAll();\n  }\n}\n\n// Make available globally\nif (typeof window !== 'undefined') {\n  window.SelectionManager = SelectionManager;\n}\n","size_bytes":8593},"css/layout.css":{"content":"/* Modern Workspace Layout - Inspired by Figma, Canva, Linear */\n\nbody {\n  font-family: var(--font-family);\n  background: var(--color-bg);\n  margin: 0;\n  padding: 0;\n  overflow: hidden;\n  -webkit-font-smoothing: antialiased;\n}\n\n/* App Container */\n.app-container {\n  display: flex;\n  flex-direction: column;\n  height: 100vh;\n  background: var(--color-bg);\n}\n\n/* Header - Minimal & Clean */\n.header {\n  background: var(--color-bg-panel);\n  border-bottom: 1px solid var(--color-border);\n  padding: 12px 24px;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  height: 56px;\n  flex-shrink: 0;\n}\n\n.header h1 {\n  font-size: 16px;\n  font-weight: 600;\n  color: var(--color-text);\n  letter-spacing: -0.01em;\n}\n\n.project-name-container {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.project-name {\n  font-size: 14px;\n  color: var(--color-text-secondary);\n  font-weight: 500;\n}\n\n.btn-rename {\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  padding: 4px;\n  background: transparent;\n  border: 1px solid transparent;\n  border-radius: var(--radius-sm);\n  cursor: pointer;\n  transition: all var(--transition-fast);\n  color: var(--color-text-secondary);\n}\n\n.btn-rename svg {\n  width: 16px;\n  height: 16px;\n}\n\n.btn-rename:hover {\n  background: var(--color-bg-hover);\n  color: var(--color-text);\n}\n\n/* Main Content */\n.main-content {\n  display: flex;\n  flex: 1;\n  overflow: hidden;\n}\n\n/* Sidebar - Clean Panel */\n.sidebar {\n  width: 280px;\n  background: var(--color-bg-panel);\n  border-right: 1px solid var(--color-border);\n  display: flex;\n  flex-direction: column;\n  flex-shrink: 0;\n  overflow: hidden;\n}\n\n.sidebar-tabs {\n  display: flex;\n  border-bottom: 1px solid var(--color-border);\n  padding: 0 16px;\n  background: var(--color-bg-panel);\n}\n\n.sidebar-tab {\n  padding: 12px 16px;\n  font-size: 13px;\n  font-weight: 500;\n  color: var(--color-text-secondary);\n  background: none;\n  border: none;\n  border-bottom: 2px solid transparent;\n  cursor: pointer;\n  transition: all var(--transition-fast);\n}\n\n.sidebar-tab:hover {\n  color: var(--color-text);\n}\n\n.sidebar-tab.active {\n  color: var(--color-primary);\n  border-bottom-color: var(--color-primary);\n}\n\n.sidebar-content {\n  flex: 1;\n  overflow-y: auto;\n}\n\n.tab-content {\n  padding: 16px;\n}\n\n.tab-content.hidden {\n  display: none;\n}\n\n/* Canvas Container */\n.canvas-container {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  background: var(--color-bg);\n  overflow: hidden;\n}\n\n/* Toolbar - Minimal & Floating */\n.toolbar {\n  background: var(--color-bg-panel);\n  border-bottom: 1px solid var(--color-border);\n  padding: 8px 16px;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  min-height: 48px;\n  flex-shrink: 0;\n  overflow: visible; /* Allow dropdown to show below */ /* Don't clip horizontally either */\n}\n\n.toolbar::-webkit-scrollbar {\n  height: 4px;\n}\n\n.toolbar::-webkit-scrollbar-thumb {\n  background: var(--color-border-hover);\n  border-radius: 2px;\n}\n\n.toolbar-group {\n  display: flex;\n  gap: 4px;\n  padding: 0 8px;\n  border-right: 1px solid var(--color-border);\n  flex-shrink: 0;\n}\n\n.toolbar-group:first-child {\n  padding-left: 0;\n}\n\n.toolbar-group:last-child {\n  border-right: none;\n}\n\n/* Canvas Wrapper */\n.canvas-wrapper {\n  flex: 1;\n  position: relative;\n  overflow: hidden;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: var(--color-bg);\n}\n\n/* Empty State */\n.empty-state {\n  color: var(--color-text-tertiary);\n  font-size: 13px;\n  text-align: center;\n  padding: 48px 24px;\n}\n\n/* Scrollbar */\n::-webkit-scrollbar {\n  width: 8px;\n  height: 8px;\n}\n\n::-webkit-scrollbar-track {\n  background: transparent;\n}\n\n::-webkit-scrollbar-thumb {\n  background: var(--color-border-hover);\n  border-radius: 4px;\n}\n\n::-webkit-scrollbar-thumb:hover {\n  background: var(--color-text-tertiary);\n}\n\n/* Responsive */\n@media (width <= 768px) {\n  .sidebar {\n    width: 250px;\n  }\n}\n","size_bytes":3917},"js/utils/helpers.js":{"content":"/* global Config */\n\n/**\n * Utility Helper Functions\n */\nconst Helpers = {\n  /**\n   * Convert feet to pixels\n   */\n  feetToPx(feet) {\n    return feet * Config.PX_PER_FOOT;\n  },\n\n  /**\n   * Convert pixels to feet\n   */\n  pxToFeet(px) {\n    return px / Config.PX_PER_FOOT;\n  },\n\n  /**\n   * Convert feet to meters\n   */\n  feetToMeters(feet) {\n    return feet * 0.3048;\n  },\n\n  /**\n   * Convert meters to feet\n   */\n  metersToFeet(meters) {\n    return meters / 0.3048;\n  },\n\n  /**\n   * Format number to fixed decimal places\n   */\n  formatNumber(num, decimals = 1) {\n    return Number(num.toFixed(decimals));\n  },\n\n  /**\n   * Generate unique ID\n   */\n  generateId(prefix = 'item') {\n    return `${prefix}-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n  },\n\n  /**\n   * Debounce function\n   */\n  debounce(func, wait) {\n    let timeout;\n    return function executedFunction(...args) {\n      const later = () => {\n        clearTimeout(timeout);\n        func(...args);\n      };\n      clearTimeout(timeout);\n      timeout = setTimeout(later, wait);\n    };\n  },\n\n  /**\n   * Throttle function\n   */\n  throttle(func, limit) {\n    let inThrottle;\n    return function (...args) {\n      if (!inThrottle) {\n        func.apply(this, args);\n        inThrottle = true;\n        setTimeout(() => (inThrottle = false), limit);\n      }\n    };\n  },\n\n  /**\n   * Deep clone object\n   */\n  deepClone(obj) {\n    return JSON.parse(JSON.stringify(obj));\n  },\n\n  /**\n   * Download data as file\n   */\n  downloadFile(data, filename, type = 'application/json') {\n    const blob = new Blob([data], { type });\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = filename;\n    link.click();\n    URL.revokeObjectURL(url);\n  },\n\n  /**\n   * Format date\n   */\n  formatDate(dateString) {\n    const date = new Date(dateString);\n    return date.toLocaleDateString() + ' ' + date.toLocaleTimeString();\n  },\n\n  /**\n   * Calculate distance between two points\n   */\n  distance(x1, y1, x2, y2) {\n    return Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));\n  },\n\n  /**\n   * Calculate angle between two points (in degrees)\n   */\n  angleBetweenPoints(x1, y1, x2, y2) {\n    return (Math.atan2(y2 - y1, x2 - x1) * 180) / Math.PI;\n  },\n\n  /**\n   * Constrain number to range\n   */\n  clamp(num, min, max) {\n    return Math.min(Math.max(num, min), max);\n  },\n\n  /**\n   * Check if two rectangles overlap\n   */\n  rectanglesOverlap(r1, r2) {\n    return !(r1.right < r2.left || r1.left > r2.right || r1.bottom < r2.top || r1.top > r2.bottom);\n  },\n};\n\n// Make available globally\nif (typeof window !== 'undefined') {\n  window.Helpers = Helpers;\n}\n","size_bytes":2680},"css/variables.css":{"content":"/**\n * Storage Caves Design System\n * Enterprise-grade color palette and design tokens\n * Brand: Industrial red (#E74C3C) + Dark charcoal/graphite\n */\n\n:root {\n  /* ===== STORAGE CAVES BRAND COLORS ===== */\n\n  /* Primary Brand Red - From logo */\n  --color-primary: #e74c3c;\n  --color-primary-hover: #c0392b;\n  --color-primary-light: #fadbd8;\n  --color-primary-dark: #a93226;\n  --color-primary-rgb: 231, 76, 60;\n\n  /* Graphite/Charcoal - Industrial feel */\n  --color-graphite-900: #1a1a1a;\n  --color-graphite-800: #2d2d2d;\n  --color-graphite-700: #404040;\n  --color-graphite-600: #525252;\n  --color-graphite-500: #6b6b6b;\n  --color-graphite-400: #858585;\n  --color-graphite-300: #a3a3a3;\n  --color-graphite-200: #d4d4d4;\n  --color-graphite-100: #e5e5e5;\n  --color-graphite-50: #f5f5f5;\n\n  /* ===== BACKGROUNDS ===== */\n  --color-bg: #fff;\n  --color-bg-secondary: #fafafa;\n  --color-bg-tertiary: #f5f5f5;\n  --color-bg-dark: var(--color-graphite-900);\n  --color-bg-elevated: #fff;\n  --color-bg-panel: #fff;\n\n  /* ===== TEXT COLORS ===== */\n  --color-text-primary: var(--color-graphite-900);\n  --color-text-secondary: var(--color-graphite-600);\n  --color-text-tertiary: var(--color-graphite-400);\n  --color-text-disabled: var(--color-graphite-300);\n  --color-text-inverse: #fff;\n\n  /* ===== BORDERS ===== */\n  --color-border: var(--color-graphite-200);\n  --color-border-hover: var(--color-graphite-300);\n  --color-border-focus: var(--color-primary);\n  --color-border-light: var(--color-graphite-100);\n\n  /* ===== SEMANTIC COLORS ===== */\n  --color-success: #27ae60;\n  --color-warning: #f39c12;\n  --color-danger: #e74c3c;\n  --color-info: #3498db;\n\n  /* ===== SPACING SYSTEM (4px grid) ===== */\n  --spacing-xs: 4px;\n  --spacing-sm: 8px;\n  --spacing-md: 12px;\n  --spacing-lg: 16px;\n  --spacing-xl: 20px;\n  --spacing-2xl: 24px;\n  --spacing-3xl: 32px;\n  --spacing-4xl: 40px;\n  --spacing-5xl: 48px;\n  --spacing-6xl: 64px;\n\n  /* ===== TYPOGRAPHY ===== */\n  --font-family:\n    -apple-system, blinkmacsystemfont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Helvetica Neue',\n    sans-serif;\n  --font-family-mono: 'SF Mono', 'Monaco', 'Inconsolata', 'Courier New', monospace;\n  --font-size-xs: 11px;\n  --font-size-sm: 13px;\n  --font-size-base: 14px;\n  --font-size-md: 15px;\n  --font-size-lg: 16px;\n  --font-size-xl: 18px;\n  --font-size-2xl: 20px;\n  --font-size-3xl: 24px;\n  --font-size-4xl: 30px;\n  --font-weight-normal: 400;\n  --font-weight-medium: 500;\n  --font-weight-semibold: 600;\n  --font-weight-bold: 700;\n  --line-height-tight: 1.25;\n  --line-height-normal: 1.5;\n  --line-height-relaxed: 1.75;\n\n  /* ===== SHADOWS (minimal, professional) ===== */\n  --shadow-xs: 0 1px 2px 0 rgb(0 0 0 / 5%);\n  --shadow-sm: 0 1px 3px 0 rgb(0 0 0 / 10%), 0 1px 2px 0 rgb(0 0 0 / 6%);\n  --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 10%), 0 2px 4px -1px rgb(0 0 0 / 6%);\n  --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 10%), 0 4px 6px -2px rgb(0 0 0 / 5%);\n  --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 10%), 0 10px 10px -5px rgb(0 0 0 / 4%);\n\n  /* ===== BORDER RADIUS ===== */\n  --radius-xs: 2px;\n  --radius-sm: 4px;\n  --radius-md: 6px;\n  --radius-lg: 8px;\n  --radius-xl: 12px;\n  --radius-2xl: 16px;\n  --radius-full: 9999px;\n\n  /* ===== Z-INDEX LAYERS ===== */\n  --z-base: 1;\n  --z-sidebar: 10;\n  --z-toolbar: 20;\n  --z-header: 30;\n  --z-dropdown: 100;\n  --z-overlay: 900;\n  --z-modal: 1000;\n  --z-tooltip: 2000;\n\n  /* ===== TRANSITIONS ===== */\n  --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);\n  --transition-base: 200ms cubic-bezier(0.4, 0, 0.2, 1);\n  --transition-slow: 300ms cubic-bezier(0.4, 0, 0.2, 1);\n\n  /* ===== MOBILE-SPECIFIC ===== */\n  --mobile-header-height: 56px;\n  --mobile-tab-height: 60px;\n  --mobile-touch-target: 44px;\n  --mobile-safe-area-bottom: env(safe-area-inset-bottom, 0px);\n  --mobile-safe-area-top: env(safe-area-inset-top, 0px);\n}\n\n/* ===== DARK MODE (future enhancement) ===== */\n@media (prefers-color-scheme: dark) {\n  :root {\n    --color-bg: var(--color-graphite-900);\n    --color-bg-secondary: var(--color-graphite-800);\n    --color-bg-tertiary: var(--color-graphite-700);\n    --color-bg-elevated: var(--color-graphite-800);\n    --color-bg-panel: var(--color-graphite-800);\n    --color-text-primary: #fff;\n    --color-text-secondary: var(--color-graphite-300);\n    --color-text-tertiary: var(--color-graphite-400);\n    --color-border: var(--color-graphite-700);\n    --color-border-hover: var(--color-graphite-600);\n  }\n}\n","size_bytes":4423},"js/data/icons.js":{"content":"/**\n * SVG Icon Definitions\n * All icons as SVG strings (no emojis)\n */\nconst Icons = {\n  // Toolbar icons\n  select:\n    '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M3 3l7.07 16.97 2.51-7.39 7.39-2.51L3 3z\"/></svg>',\n\n  move: '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M13,6V11H18V7.75L22.25,12L18,16.25V13H13V18H16.25L12,22.25L7.75,18H11V13H6V16.25L1.75,12L6,7.75V11H11V6H7.75L12,1.75L16.25,6H13Z\"/></svg>',\n\n  rotate:\n    '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M15.55 5.55L11 1v3.07C7.06 4.56 4 7.92 4 12s3.05 7.44 7 7.93v-2.02c-2.84-.48-5-2.94-5-5.91s2.16-5.43 5-5.91V10l4.55-4.45zM19.93 11c-.17-1.39-.72-2.73-1.62-3.89l-1.42 1.42c.54.75.88 1.6 1.02 2.47h2.02zM13 17.9v2.02c1.39-.17 2.74-.71 3.9-1.61l-1.44-1.44c-.75.54-1.59.89-2.46 1.03zm3.89-2.42l1.42 1.41c.9-1.16 1.45-2.5 1.62-3.89h-2.02c-.14.87-.48 1.72-1.02 2.48z\"/></svg>',\n\n  duplicate:\n    '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"/></svg>',\n\n  delete:\n    '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z\"/></svg>',\n\n  lock: '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M12,17C10.89,17 10,16.1 10,15C10,13.89 10.89,13 12,13A2,2 0 0,1 14,15A2,2 0 0,1 12,17M18,20V10H6V20H18M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6C4.89,22 4,21.1 4,20V10C4,8.89 4.89,8 6,8H7V6A5,5 0 0,1 12,1A5,5 0 0,1 17,6V8H18M12,3A3,3 0 0,0 9,6V8H15V6A3,3 0 0,0 12,3Z\"/></svg>',\n\n  unlock:\n    '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M18,20V10H6V20H18M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6C4.89,22 4,21.1 4,20V10A2,2 0 0,1 6,8H15V6A3,3 0 0,0 12,3A3,3 0 0,0 9,6H7A5,5 0 0,1 12,1A5,5 0 0,1 17,6V8H18M12,17A2,2 0 0,1 10,15A2,2 0 0,1 12,13A2,2 0 0,1 14,15A2,2 0 0,1 12,17Z\"/></svg>',\n\n  undo: '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M12.5,8C9.85,8 7.45,9 5.6,10.6L2,7V16H11L7.38,12.38C8.77,11.22 10.54,10.5 12.5,10.5C16.04,10.5 19.05,12.81 20.1,16L22.47,15.22C21.08,11.03 17.15,8 12.5,8Z\"/></svg>',\n\n  redo: '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M18.4,10.6C16.55,9 14.15,8 11.5,8C6.85,8 2.92,11.03 1.54,15.22L3.9,16C4.95,12.81 7.95,10.5 11.5,10.5C13.45,10.5 15.23,11.22 16.62,12.38L13,16H22V7L18.4,10.6Z\"/></svg>',\n\n  save: '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z\"/></svg>',\n\n  load: '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z\"/></svg>',\n\n  export:\n    '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M23,12L19,8V11H10V13H19V16M1,18V6C1,4.89 1.89,4 3,4H15A2,2 0 0,1 17,6V9H15V6H3V18H15V15H17V18A2,2 0 0,1 15,20H3A2,2 0 0,1 1,18Z\"/></svg>',\n\n  magnifier:\n    '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M15.5,14L20.5,19L19,20.5L14,15.5V14.71L13.73,14.43C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.43,13.73L14.71,14H15.5M9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14M12,10H10V12H9V10H7V9H9V7H10V9H12V10Z\"/></svg>',\n\n  ruler:\n    '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M1.39,18.36L3.16,16.6L4.58,18L5.64,16.95L4.22,15.54L5.64,14.12L8.11,16.6L9.17,15.54L6.7,13.06L8.11,11.65L9.53,13.06L10.59,12L9.17,10.59L10.59,9.17L13.06,11.65L14.12,10.59L11.65,8.11L13.06,6.7L14.47,8.11L15.54,7.05L14.12,5.64L15.54,4.22L18,6.7L19.07,5.64L16.6,3.16L18.36,1.39L22.61,5.64L5.64,22.61L1.39,18.36Z\"/></svg>',\n\n  grid: '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M10,4V8H14V4H10M16,4V8H20V4H16M16,10V14H20V10H16M16,16V20H20V16H16M14,20V16H10V20H14M8,20V16H4V20H8M8,14V10H4V14H8M8,8V4H4V8H8M10,14H14V10H10V14M4,2H20A2,2 0 0,1 22,4V20A2,2 0 0,1 20,22H4C2.89,22 2,21.1 2,20V4A2,2 0 0,1 4,2Z\"/></svg>',\n\n  alignLeft:\n    '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M4,22H2V2H4V22M22,7H6V10H22V7M16,14H6V17H16V14Z\"/></svg>',\n\n  alignRight:\n    '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M20,2H22V22H20V2M2,10H18V7H2V10M8,17H18V14H8V17Z\"/></svg>',\n\n  alignCenter:\n    '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M11,2H13V7H21V10H13V14H18V17H13V22H11V17H6V14H11V10H3V7H11V2Z\"/></svg>',\n\n  alignTop:\n    '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M22,2V4H2V2H22M7,22H10V6H7V22M14,16H17V6H14V16Z\"/></svg>',\n\n  alignBottom:\n    '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M22,22H2V20H22V22M10,2H7V18H10V2M17,8H14V18H17V8Z\"/></svg>',\n\n  alignMiddle:\n    '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M22,11H18V6H14V11H10V3H6V11H2V13H6V21H10V13H14V18H18V13H22V11Z\"/></svg>',\n\n  bringFront:\n    '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M2,2H11V11H2V2M9,4H4V9H9V4M22,13V22H13V13H22M15,15V20H20V15H15M16,8V11H13V8H16M11,16H8V13H11V16Z\"/></svg>',\n\n  sendBack:\n    '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M2,2H11V6H9V4H4V9H6V11H2V2M22,13V22H13V18H15V20H20V15H18V13H22M8,8H16V16H8V8Z\"/></svg>',\n\n  group:\n    '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M2,6V8H14V6H2M2,10V12H14V10H2M20.59,11.93L16.66,16.07L14.5,13.71L13,15.29L16.66,19.21L22,13.54L20.59,11.93M2,14V16H11V14H2Z\"/></svg>',\n\n  ungroup:\n    '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M2,6V8H14V6H2M2,10V12H14V10H2M2,14V16H14V14H2M17,10V14H13V16H17V20H19V16H23V14H19V10H17Z\"/></svg>',\n\n  zoomIn:\n    '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M15.5,14H14.71L14.43,13.73C15.41,12.59 16,11.11 16,9.5A6.5,6.5 0 0,0 9.5,3A6.5,6.5 0 0,0 3,9.5A6.5,6.5 0 0,0 9.5,16C11.11,16 12.59,15.41 13.73,14.43L14,14.71V15.5L19,20.5L20.5,19L15.5,14M9.5,14C7,14 5,12 5,9.5C5,7 7,5 9.5,5C12,5 14,7 14,9.5C14,12 12,14 9.5,14M12,10H10V12H9V10H7V9H9V7H10V9H12V10Z\"/></svg>',\n\n  zoomOut:\n    '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M15.5,14H14.71L14.43,13.73C15.41,12.59 16,11.11 16,9.5A6.5,6.5 0 0,0 9.5,3A6.5,6.5 0 0,0 3,9.5A6.5,6.5 0 0,0 9.5,16C11.11,16 12.59,15.41 13.73,14.43L14,14.71V15.5L19,20.5L20.5,19L15.5,14M9.5,14C7,14 5,12 5,9.5C5,7 7,5 9.5,5C12,5 14,7 14,9.5C14,12 12,14 9.5,14M7,9H12V10H7V9Z\"/></svg>',\n\n  fullscreen:\n    '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M5,5H10V7H7V10H5V5M14,5H19V10H17V7H14V5M17,14H19V19H14V17H17V14M10,17V19H5V14H7V17H10Z\"/></svg>',\n\n  settings:\n    '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.67 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z\"/></svg>',\n\n  info: '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M13,9H11V7H13M13,17H11V11H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z\"/></svg>',\n\n  close:\n    '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z\"/></svg>',\n\n  menu: '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z\"/></svg>',\n\n  check:\n    '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"/></svg>',\n\n  warning:\n    '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M13,14H11V10H13M13,18H11V16H13M1,21H23L12,2L1,21Z\"/></svg>',\n\n  pdf: '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M15.5,15C15.5,16.38 14.38,17.5 13,17.5H11.5V19H10V13H13A2.5,2.5 0 0,1 15.5,15.5M13,16.5A1,1 0 0,0 14,15.5A1,1 0 0,0 13,14.5H11.5V16.5M13,9V3.5L18.5,9\"/></svg>',\n\n  image:\n    '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M8.5,13.5L11,16.5L14.5,12L19,18H5M21,19V5C21,3.89 20.1,3 19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19Z\"/></svg>',\n\n  json: '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M5,3H7V5H5V10A2,2 0 0,1 3,12A2,2 0 0,1 5,14V19H7V21H5C3.93,20.73 3,20.1 3,19V15A2,2 0 0,0 1,13H0V11H1A2,2 0 0,0 3,9V5A2,2 0 0,1 5,3M19,3A2,2 0 0,1 21,5V9A2,2 0 0,0 23,11H24V13H23A2,2 0 0,0 21,15V19A2,2 0 0,1 19,21H17V19H19V14A2,2 0 0,1 21,12A2,2 0 0,1 19,10V5H17V3H19M12,15A1,1 0 0,1 13,16A1,1 0 0,1 12,17A1,1 0 0,1 11,16A1,1 0 0,1 12,15M8,15A1,1 0 0,1 9,16A1,1 0 0,1 8,17A1,1 0 0,1 7,16A1,1 0 0,1 8,15M16,15A1,1 0 0,1 17,16A1,1 0 0,1 16,17A1,1 0 0,1 15,16A1,1 0 0,1 16,15Z\"/></svg>',\n};\n\n// Make available globally\nif (typeof window !== 'undefined') {\n  window.Icons = Icons;\n}\n","size_bytes":9370},"css/components/toolbar.css":{"content":"/* Modern Toolbar - Minimal & Professional */\n\n.btn {\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  gap: 6px;\n  padding: 6px 12px;\n  background: transparent;\n  border: 1px solid transparent;\n  border-radius: var(--radius-sm);\n  font-size: 13px;\n  font-weight: 500;\n  color: var(--color-text);\n  cursor: pointer;\n  transition: all var(--transition-fast);\n  white-space: nowrap;\n  position: relative;\n}\n\n/* Toolbar Badge - Warning Indicator */\n.toolbar-badge {\n  position: absolute;\n  top: -6px;\n  right: -6px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 20px;\n  height: 20px;\n  background: var(--color-warning);\n  border: 2px solid var(--color-bg-panel);\n  border-radius: 50%;\n  color: white;\n  font-size: 10px;\n  font-weight: 600;\n  pointer-events: none;\n  animation: pulse 2s ease-in-out infinite;\n}\n\n.toolbar-badge svg {\n  width: 12px;\n  height: 12px;\n}\n\n@keyframes pulse {\n  0%,\n  100% {\n    transform: scale(1);\n  }\n\n  50% {\n    transform: scale(1.1);\n  }\n}\n\n.btn:hover {\n  background: var(--color-bg-hover);\n}\n\n.btn:active {\n  background: var(--color-bg-active);\n}\n\n.btn:disabled {\n  opacity: 0.4;\n  cursor: not-allowed;\n}\n\n.btn-icon {\n  padding: 6px;\n  width: 32px;\n  height: 32px;\n  flex-shrink: 0;\n}\n\n.btn-icon svg {\n  width: 18px;\n  height: 18px;\n}\n\n.btn svg {\n  width: 16px;\n  height: 16px;\n  flex-shrink: 0;\n}\n\n.btn-primary {\n  background: var(--color-primary);\n  color: white;\n  border-color: var(--color-primary);\n}\n\n.btn-primary:hover {\n  background: var(--color-primary-hover);\n  border-color: var(--color-primary-hover);\n}\n\n/* Dropdown - Clean & Modern */\n.dropdown {\n  position: relative;\n  display: inline-block;\n}\n\n.dropdown-menu {\n  position: absolute;\n  top: calc(100% + 4px);\n  left: 0;\n  background: var(--color-bg-panel);\n  border: 1px solid var(--color-border);\n  border-radius: var(--radius-md);\n  box-shadow: var(--shadow-floating);\n  min-width: 200px;\n  z-index: 1000;\n  display: none;\n  overflow: hidden;\n}\n\n.dropdown-menu.show {\n  display: block;\n  animation: fade-in var(--transition-fast);\n}\n\n@keyframes fade-in {\n  from {\n    opacity: 0;\n    transform: translateY(-4px);\n  }\n\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n.dropdown-item {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  padding: 10px 14px;\n  width: 100%;\n  background: none;\n  border: none;\n  text-align: left;\n  cursor: pointer;\n  font-size: 13px;\n  color: var(--color-text);\n  transition: background var(--transition-fast);\n}\n\n.dropdown-item:hover {\n  background: var(--color-bg-hover);\n}\n\n.dropdown-item:active {\n  background: var(--color-bg-active);\n}\n\n.dropdown-item svg {\n  width: 16px;\n  height: 16px;\n  flex-shrink: 0;\n  color: var(--color-text-secondary);\n  vertical-align: middle;\n}\n\n/* Dropdown Sections */\n.dropdown-section {\n  padding: 0;\n}\n\n.dropdown-section-label {\n  font-size: 11px;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n  color: var(--color-text-secondary);\n  padding: 8px 14px 4px;\n  font-weight: 600;\n}\n\n.dropdown-divider {\n  height: 1px;\n  background: var(--color-border-subtle);\n  margin: 6px 0;\n}\n\n/* Segmented Control */\n.segmented-control {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 6px;\n  padding: 8px 14px 12px;\n}\n\n.segmented-button {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 6px;\n  padding: 8px 12px;\n  background: var(--color-bg-secondary);\n  border: 1px solid var(--color-border);\n  border-radius: var(--radius-sm);\n  cursor: pointer;\n  font-size: 12px;\n  color: var(--color-text);\n  transition: all var(--transition-fast);\n}\n\n.segmented-button:hover {\n  background: var(--color-bg-hover);\n  border-color: var(--color-primary);\n}\n\n.segmented-button.is-active {\n  background: var(--color-primary);\n  color: white;\n  border-color: var(--color-primary);\n}\n\n.segmented-button svg {\n  width: 14px;\n  height: 14px;\n}\n\n/* Zoom Slider */\n.zoom-slider-container {\n  padding: 12px 16px;\n}\n\n.zoom-slider-label {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 10px;\n  font-size: 13px;\n  color: var(--color-text);\n  font-weight: 500;\n}\n\n.zoom-slider-label span:last-child {\n  color: var(--color-primary);\n  font-weight: 600;\n}\n\n.zoom-slider {\n  width: 100%;\n  height: 6px;\n  appearance: none;\n  background: #e4e4e7;\n  border-radius: 3px;\n  outline: none;\n  cursor: pointer;\n  margin: 0;\n  padding: 0;\n}\n\n.zoom-slider::-webkit-slider-runnable-track {\n  width: 100%;\n  height: 6px;\n  background: #e4e4e7;\n  border-radius: 3px;\n}\n\n.zoom-slider::-moz-range-track {\n  width: 100%;\n  height: 6px;\n  background: #e4e4e7;\n  border-radius: 3px;\n  border: none;\n}\n\n.zoom-slider::-webkit-slider-thumb {\n  appearance: none;\n  width: 16px;\n  height: 16px;\n  margin-top: -5px;\n  border-radius: 50%;\n  background: var(--color-primary);\n  cursor: pointer;\n  transition: all var(--transition-fast);\n  box-shadow: 0 1px 3px rgb(0 0 0 / 20%);\n}\n\n.zoom-slider::-moz-range-thumb {\n  width: 16px;\n  height: 16px;\n  border-radius: 50%;\n  background: var(--color-primary);\n  cursor: pointer;\n  border: none;\n  transition: all var(--transition-fast);\n  box-shadow: 0 1px 3px rgb(0 0 0 / 20%);\n}\n\n.zoom-slider::-webkit-slider-thumb:hover {\n  transform: scale(1.15);\n  box-shadow: 0 2px 4px rgb(0 0 0 / 25%);\n}\n\n.zoom-slider::-moz-range-thumb:hover {\n  transform: scale(1.15);\n  box-shadow: 0 2px 4px rgb(0 0 0 / 25%);\n}\n\n.zoom-slider::-webkit-slider-thumb:active {\n  transform: scale(1);\n}\n\n.zoom-slider::-moz-range-thumb:active {\n  transform: scale(1);\n}\n","size_bytes":5546},"js/utils/storage.js":{"content":"/**\n * Local/session storage wrapper with graceful fallbacks.\n * Falls back to sessionStorage (per-tab) and then in-memory storage when needed.\n */\nconst Storage = (() => {\n  const STORAGE_TYPES = {\n    LOCAL: 'local',\n    SESSION: 'session',\n    MEMORY: 'memory',\n  };\n\n  const memoryStorage = new Map();\n  let activeStorageType = STORAGE_TYPES.LOCAL;\n  let isStorageAvailable = false;\n\n  /**\n   * Try accessing the requested storage bucket with a read/write test.\n   */\n  function canUseStorage(type) {\n    if (typeof window === 'undefined') return false;\n    const storage = type === STORAGE_TYPES.LOCAL ? window.localStorage : window.sessionStorage;\n    if (!storage) return false;\n\n    try {\n      const testKey = '__storage_test__';\n      storage.setItem(testKey, 'test');\n      storage.removeItem(testKey);\n      return true;\n    } catch (error) {\n      return false;\n    }\n  }\n\n  /**\n   * Switch to the provided storage type.\n   */\n  function setActiveStorage(type) {\n    activeStorageType = type;\n    isStorageAvailable = type !== STORAGE_TYPES.MEMORY;\n\n    if (type === STORAGE_TYPES.LOCAL) {\n      console.log('[Storage] Using localStorage');\n    } else if (type === STORAGE_TYPES.SESSION) {\n      console.warn('[Storage] Falling back to sessionStorage (cleared when tab closes)');\n    } else {\n      console.warn('[Storage] Using volatile in-memory storage (cleared on reload)');\n    }\n  }\n\n  /**\n   * Run detection in priority order: localStorage -> sessionStorage -> memory.\n   */\n  function detectStorage() {\n    if (canUseStorage(STORAGE_TYPES.LOCAL)) {\n      setActiveStorage(STORAGE_TYPES.LOCAL);\n      return true;\n    }\n\n    if (canUseStorage(STORAGE_TYPES.SESSION)) {\n      setActiveStorage(STORAGE_TYPES.SESSION);\n      return true;\n    }\n\n    setActiveStorage(STORAGE_TYPES.MEMORY);\n    return false;\n  }\n\n  /**\n   * Attempt to fallback to the next available storage tier.\n   */\n  function fallbackToNextTier() {\n    if (activeStorageType === STORAGE_TYPES.LOCAL && canUseStorage(STORAGE_TYPES.SESSION)) {\n      setActiveStorage(STORAGE_TYPES.SESSION);\n      return true;\n    }\n\n    setActiveStorage(STORAGE_TYPES.MEMORY);\n    return false;\n  }\n\n  function getActiveBrowserStorage() {\n    if (typeof window === 'undefined') return null;\n    if (activeStorageType === STORAGE_TYPES.LOCAL) {\n      return window.localStorage;\n    }\n    if (activeStorageType === STORAGE_TYPES.SESSION) {\n      return window.sessionStorage;\n    }\n    return null;\n  }\n\n  // Initial detection\n  detectStorage();\n\n  return {\n    /**\n     * Flag indicating if we have persistent (local or session) storage.\n     */\n    get isAvailable() {\n      return isStorageAvailable;\n    },\n\n    /**\n     * Whether data survives a full browser restart (only true for localStorage).\n     */\n    get isPersistent() {\n      return activeStorageType === STORAGE_TYPES.LOCAL;\n    },\n\n    /**\n     * Expose current mode for debugging (local, session, memory)\n     */\n    get mode() {\n      return activeStorageType;\n    },\n\n    save(key, data) {\n      const serialized = JSON.stringify(data);\n\n      if (activeStorageType === STORAGE_TYPES.MEMORY) {\n        memoryStorage.set(key, serialized);\n        return true;\n      }\n\n      try {\n        const storage = getActiveBrowserStorage();\n        if (!storage) {\n          throw new Error('Active storage missing');\n        }\n        storage.setItem(key, serialized);\n        return true;\n      } catch (error) {\n        console.error('[Storage] Error saving data:', error);\n        if (error.name === 'QuotaExceededError') {\n          console.warn('[Storage] Quota exceeded - attempting fallback');\n        }\n\n        if (fallbackToNextTier()) {\n          return this.save(key, data);\n        }\n\n        try {\n          memoryStorage.set(key, serialized);\n          return true;\n        } catch (memError) {\n          console.error('[Storage] Memory fallback also failed:', memError);\n          return false;\n        }\n      }\n    },\n\n    load(key) {\n      try {\n        if (activeStorageType === STORAGE_TYPES.MEMORY) {\n          const data = memoryStorage.get(key);\n          return data ? JSON.parse(data) : null;\n        }\n\n        const storage = getActiveBrowserStorage();\n        const data = storage ? storage.getItem(key) : null;\n        return data ? JSON.parse(data) : null;\n      } catch (error) {\n        console.error('[Storage] Error loading data:', error);\n        return null;\n      }\n    },\n\n    remove(key) {\n      try {\n        if (activeStorageType === STORAGE_TYPES.MEMORY) {\n          memoryStorage.delete(key);\n          return true;\n        }\n\n        const storage = getActiveBrowserStorage();\n        if (storage) {\n          storage.removeItem(key);\n          return true;\n        }\n\n        return false;\n      } catch (error) {\n        console.error('[Storage] Error removing data:', error);\n        return false;\n      }\n    },\n\n    has(key) {\n      try {\n        if (activeStorageType === STORAGE_TYPES.MEMORY) {\n          return memoryStorage.has(key);\n        }\n\n        const storage = getActiveBrowserStorage();\n        return storage ? storage.getItem(key) !== null : false;\n      } catch (error) {\n        console.error('[Storage] Error checking key:', error);\n        return false;\n      }\n    },\n\n    clear() {\n      try {\n        if (activeStorageType === STORAGE_TYPES.MEMORY) {\n          memoryStorage.clear();\n          return true;\n        }\n\n        const storage = getActiveBrowserStorage();\n        if (storage) {\n          storage.clear();\n          return true;\n        }\n\n        return false;\n      } catch (error) {\n        console.error('[Storage] Error clearing storage:', error);\n        return false;\n      }\n    },\n\n    keys() {\n      try {\n        if (activeStorageType === STORAGE_TYPES.MEMORY) {\n          return Array.from(memoryStorage.keys());\n        }\n\n        const storage = getActiveBrowserStorage();\n        return storage ? Object.keys(storage) : [];\n      } catch (error) {\n        console.error('[Storage] Error getting keys:', error);\n        return [];\n      }\n    },\n\n    getSize() {\n      try {\n        let size = 0;\n\n        if (activeStorageType === STORAGE_TYPES.MEMORY) {\n          for (const [key, value] of memoryStorage) {\n            size += key.length + value.length;\n          }\n          return size;\n        }\n\n        const storage = getActiveBrowserStorage();\n        if (!storage) return 0;\n\n        for (const key in storage) {\n          if (Object.prototype.hasOwnProperty.call(storage, key)) {\n            size += storage[key].length + key.length;\n          }\n        }\n        return size;\n      } catch (error) {\n        console.error('[Storage] Error calculating size:', error);\n        return 0;\n      }\n    },\n\n    redetect() {\n      return detectStorage();\n    },\n  };\n})();\n\n// Make available globally\nif (typeof window !== 'undefined') {\n  window.Storage = Storage;\n}\n","size_bytes":6902},"js/managers/ExportManager.js":{"content":"/* global Helpers, Modal */\n\n/**\n * Export Manager\n * Handles JSON, PNG, and PDF exports and imports\n */\nclass ExportManager {\n  constructor(state, eventBus, canvasManager) {\n    this.state = state;\n    this.eventBus = eventBus;\n    this.canvasManager = canvasManager;\n  }\n\n  /**\n   * Export as JSON\n   */\n  exportJSON() {\n    const state = this.state.getState();\n\n    const exportData = {\n      version: '1.0.0',\n      exported: new Date().toISOString(),\n      metadata: state.metadata,\n      floorPlan: state.floorPlan,\n      items: state.items.map((item) => ({\n        id: item.id,\n        itemId: item.itemId,\n        label: item.label,\n        lengthFt: item.lengthFt,\n        widthFt: item.widthFt,\n        x: item.x,\n        y: item.y,\n        angle: item.angle,\n        locked: item.locked,\n        category: item.category,\n        color: item.color,\n      })),\n      settings: state.settings,\n    };\n\n    const json = JSON.stringify(exportData, null, 2);\n    const filename = `${state.metadata.projectName || 'layout'}-${Date.now()}.json`;\n\n    Helpers.downloadFile(json, filename, 'application/json');\n    this.eventBus.emit('export:json:complete', filename);\n\n    return exportData;\n  }\n\n  /**\n   * Export as PNG\n   */\n  exportPNG(resolution = 1) {\n    console.log('Attempting PNG export at', resolution, 'x resolution');\n\n    const dataURL = this.canvasManager.toDataURL({\n      multiplier: resolution,\n      format: 'png',\n      quality: 1,\n    });\n\n    console.log('Data URL length:', dataURL.length);\n\n    if (!dataURL || dataURL.length < 100) {\n      console.error('Failed to generate canvas image');\n      Modal.showError('Failed to export PNG');\n      return;\n    }\n\n    // Format: \"Project Name_YYYY-MM-DD_Buford-GA.png\"\n    const projectName = this.state.get('metadata.projectName') || 'Untitled Layout';\n    const date = new Date().toISOString().split('T')[0]; // YYYY-MM-DD format\n    const filename = `${projectName}_${date}_Buford-GA.png`;\n\n    const link = document.createElement('a');\n    link.href = dataURL;\n    link.download = filename;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n\n    Modal.showSuccess('PNG exported successfully!');\n    this.eventBus.emit('export:png:complete', { filename, resolution });\n\n    return dataURL;\n  }\n\n  /**\n   * Export as PDF (Print-Ready with 300 DPI)\n   *\n   * Generates a professional, print-ready PDF with 300 DPI resolution.\n   * Supports ALL jsPDF format/orientation options for backward compatibility.\n   *\n   * @param {Object} options - jsPDF options (passed through)\n   * @param {string|array} options.format - Any jsPDF format ('letter', 'a4', [width,height], etc.)\n   * @param {string} options.orientation - Any jsPDF orientation ('landscape', 'portrait', 'l', 'p')\n   */\n  async exportPDF(options = {}) {\n    // Check if jsPDF is loaded\n    if (typeof window.jspdf === 'undefined' && typeof jsPDF === 'undefined') {\n      console.error('jsPDF library not loaded');\n      Modal.showError('PDF library not loaded. Please refresh the page.');\n      return;\n    }\n\n    const { jsPDF } = window.jspdf || window;\n    console.log('Generating print-ready PDF...');\n\n    // Deselect all objects for clean export\n    this.canvasManager.canvas.discardActiveObject();\n    this.canvasManager.canvas.renderAll();\n\n    // Validate canvas is ready\n    const canvasWidth = this.canvasManager.canvas.width;\n    const canvasHeight = this.canvasManager.canvas.height;\n\n    if (!canvasWidth || !canvasHeight || canvasWidth <= 0 || canvasHeight <= 0) {\n      console.error('Invalid canvas dimensions:', canvasWidth, canvasHeight);\n      Modal.showError('Canvas not ready. Please select a floor plan first.');\n      return;\n    }\n\n    // Smart defaults when options not provided\n    const pdfOptions = { ...options, unit: 'mm', compress: true };\n\n    if (!pdfOptions.format) {\n      // Auto-select format based on floor plan physical size\n      const floorPlan = this.state.get('floorPlan');\n      if (floorPlan && floorPlan.widthFt && floorPlan.heightFt) {\n        const maxDim = Math.max(floorPlan.widthFt, floorPlan.heightFt);\n        pdfOptions.format = maxDim >= 40 ? 'tabloid' : maxDim >= 30 ? 'legal' : 'letter';\n      } else {\n        pdfOptions.format = 'letter';\n      }\n    }\n\n    if (!pdfOptions.orientation) {\n      // Auto-detect orientation from canvas aspect ratio\n      const aspectRatio = canvasWidth / canvasHeight;\n      pdfOptions.orientation = aspectRatio > 1 ? 'landscape' : 'portrait';\n    }\n\n    // Create PDF (passes through ALL jsPDF options)\n    const pdf = new jsPDF(pdfOptions);\n\n    // Get page dimensions\n    const pageWidth = pdf.internal.pageSize.getWidth();\n    const pageHeight = pdf.internal.pageSize.getHeight();\n\n    // Layout: margins and reserved areas\n    const margin = 12.7; // 0.5 inch = 12.7mm\n    const headerHeight = 25; // Reserved for future logo/branding\n    const footerHeight = 10;\n    const contentWidth = pageWidth - margin * 2;\n    const contentHeight = pageHeight - margin * 2 - headerHeight - footerHeight;\n\n    // Validate content area\n    if (contentWidth <= 0 || contentHeight <= 0) {\n      console.error('Content area too small');\n      Modal.showError('Paper size too small for this layout.');\n      return;\n    }\n\n    // Calculate scale to fit canvas\n    const scale = Math.min(contentWidth / canvasWidth, contentHeight / canvasHeight);\n\n    if (scale <= 0 || !isFinite(scale)) {\n      console.error('Invalid scale:', scale);\n      Modal.showError('Cannot fit layout on page.');\n      return;\n    }\n\n    const imgWidth = canvasWidth * scale;\n    const imgHeight = canvasHeight * scale;\n    const imgX = margin + (contentWidth - imgWidth) / 2;\n    const imgY = margin + headerHeight + (contentHeight - imgHeight) / 2;\n\n    // Export canvas at 3x for 300 DPI\n    const imgData = this.canvasManager.toDataURL({\n      format: 'png',\n      quality: 1,\n      multiplier: 3,\n    });\n\n    if (!imgData || imgData.length < 100) {\n      console.error('Failed to generate canvas image');\n      Modal.showError('Failed to generate PDF');\n      return;\n    }\n\n    // === HEADER AREA (reserved for future customization) ===\n    // TODO: Add logo, company branding, contact info here\n    pdf.setFontSize(16);\n    pdf.setFont(undefined, 'bold');\n    pdf.setTextColor(40);\n    const title = this.state.get('metadata.projectName') || 'Garage Layout Plan';\n    pdf.text(title, margin, margin + 8);\n\n    pdf.setFontSize(9);\n    pdf.setFont(undefined, 'normal');\n    pdf.setTextColor(100);\n    pdf.text(`Date: ${new Date().toLocaleDateString()}`, margin, margin + 15);\n\n    // === CANVAS IMAGE ===\n    pdf.addImage(imgData, 'PNG', imgX, imgY, imgWidth, imgHeight, undefined, 'FAST');\n\n    // === FOOTER AREA ===\n    const footerY = pageHeight - margin - 5;\n    pdf.setFontSize(8);\n    pdf.setTextColor(120);\n\n    const currentFloorPlan = this.state.get('floorPlan');\n    if (currentFloorPlan && currentFloorPlan.widthFt && currentFloorPlan.heightFt) {\n      const specs = `Floor Plan: ${currentFloorPlan.widthFt}' × ${currentFloorPlan.heightFt}' (${currentFloorPlan.area || 0} sq ft) | Occupied: ${this.calculateOccupancy().toFixed(1)}%`;\n      pdf.text(specs, margin, footerY);\n    }\n\n    pdf.text('Generated by Garage Layout Planner', pageWidth - margin, footerY, { align: 'right' });\n\n    // PDF metadata\n    pdf.setProperties({\n      title: title,\n      subject: 'Garage Layout Design',\n      author: 'Garage Layout Planner',\n      keywords: 'garage, layout, plan, design, storage',\n      creator: 'Garage Layout Planner',\n    });\n\n    // Save\n    // Format: \"Project Name_YYYY-MM-DD.pdf\"\n    const projectName = this.state.get('metadata.projectName') || 'Untitled Layout';\n    const date = new Date().toISOString().split('T')[0]; // YYYY-MM-DD format\n    const filename = `${projectName}_${date}_Buford-GA.pdf`;\n    pdf.save(filename);\n\n    console.log(`PDF exported: ${pdfOptions.format}, ${pdfOptions.orientation}, 300 DPI`);\n    Modal.showSuccess('PDF exported successfully!');\n    this.eventBus.emit('export:pdf:complete', {\n      filename,\n      format: pdfOptions.format,\n      orientation: pdfOptions.orientation,\n    });\n\n    return pdf;\n  }\n\n  /**\n   * Calculate occupancy percentage\n   */\n  /**\n   * Import from JSON\n   * Loads a previously exported layout from JSON file\n   */\n  async importJSON(file) {\n    return new Promise((resolve, reject) => {\n      if (!file) {\n        reject(new Error('No file provided'));\n        return;\n      }\n\n      if (!file.name.endsWith('.json')) {\n        Modal.showError('Please select a valid JSON file');\n        reject(new Error('Invalid file type'));\n        return;\n      }\n\n      const reader = new FileReader();\n\n      reader.onload = (e) => {\n        try {\n          const importData = JSON.parse(e.target.result);\n\n          // Validate the imported data structure\n          if (!importData.version || !importData.floorPlan || !importData.items) {\n            Modal.showError('Invalid layout file format');\n            reject(new Error('Invalid JSON structure'));\n            return;\n          }\n\n          // Load the floor plan first\n          if (importData.floorPlan) {\n            this.state.set('floorPlan', importData.floorPlan);\n            this.eventBus.emit('floorplan:loaded', importData.floorPlan);\n          }\n\n          // Load settings if available\n          if (importData.settings) {\n            Object.keys(importData.settings).forEach((key) => {\n              this.state.set(`settings.${key}`, importData.settings[key]);\n            });\n          }\n\n          // Load metadata if available\n          if (importData.metadata) {\n            Object.keys(importData.metadata).forEach((key) => {\n              this.state.set(`metadata.${key}`, importData.metadata[key]);\n            });\n          }\n\n          // Clear existing items and load new ones\n          this.state.set('items', []);\n          this.eventBus.emit('items:cleared');\n\n          // Add imported items\n          if (importData.items && importData.items.length > 0) {\n            importData.items.forEach((itemData) => {\n              this.eventBus.emit('item:add:imported', itemData);\n            });\n          }\n\n          Modal.showSuccess(\n            `Layout \"${importData.metadata?.projectName || 'Untitled'}\" imported successfully!`,\n          );\n          this.eventBus.emit('import:json:complete', importData);\n          resolve(importData);\n        } catch (error) {\n          console.error('Error parsing JSON:', error);\n          Modal.showError('Failed to parse JSON file');\n          reject(error);\n        }\n      };\n\n      reader.onerror = () => {\n        Modal.showError('Failed to read file');\n        reject(new Error('File read error'));\n      };\n\n      reader.readAsText(file);\n    });\n  }\n\n  /**\n   * Calculate occupancy percentage\n   * @returns {number} Occupancy percentage\n   */\n  calculateOccupancy() {\n    const floorPlan = this.state.get('floorPlan');\n    if (!floorPlan) return 0;\n\n    const totalArea = floorPlan.widthFt * floorPlan.heightFt;\n    const items = this.state.get('items') || [];\n    const occupiedArea = items.reduce((sum, item) => sum + item.lengthFt * item.widthFt, 0);\n\n    return (occupiedArea / totalArea) * 100;\n  }\n\n  /**\n   * Generate thumbnail\n   */\n  generateThumbnail(width = 200, height = 150) {\n    return this.canvasManager.toDataURL({\n      multiplier: 1,\n      format: 'png',\n      width: width,\n      height: height,\n    });\n  }\n}\n\n// Make available globally\nif (typeof window !== 'undefined') {\n  window.ExportManager = ExportManager;\n}\n","size_bytes":11584},"css/components/modal.css":{"content":"/* Modal Styles */\n.modal-overlay {\n  position: fixed;\n  inset: 0;\n  background-color: rgb(0 0 0 / 50%);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: var(--z-modal);\n}\n\n.modal {\n  background-color: var(--color-bg);\n  border-radius: var(--radius-lg);\n  box-shadow: var(--shadow-lg);\n  max-width: 600px;\n  max-height: 80vh;\n  overflow-y: auto;\n  width: 90%;\n}\n\n.modal-header {\n  padding: var(--spacing-lg);\n  border-bottom: 1px solid var(--color-border);\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n}\n\n.modal-title {\n  font-size: var(--font-size-xl);\n  font-weight: 600;\n  color: var(--color-text);\n}\n\n.modal-close {\n  width: 32px;\n  height: 32px;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  transition: background-color 0.2s;\n}\n\n.modal-close:hover {\n  background-color: var(--color-bg-secondary);\n}\n\n.modal-body {\n  padding: var(--spacing-lg);\n}\n\n.modal-footer {\n  padding: var(--spacing-lg);\n  border-top: 1px solid var(--color-border);\n  display: flex;\n  gap: var(--spacing-sm);\n  justify-content: flex-end;\n}\n\n.modal-input {\n  width: 100%;\n  padding: var(--spacing-md);\n  border: 2px solid var(--color-border);\n  border-radius: var(--radius-md);\n  font-size: var(--font-size-md);\n  transition: border-color 0.2s;\n  margin-top: var(--spacing-sm);\n}\n\n.modal-input:focus {\n  outline: none;\n  border-color: var(--color-primary);\n}\n\n.modal-btn {\n  padding: var(--spacing-sm) var(--spacing-lg);\n  border: none;\n  border-radius: var(--radius-md);\n  font-size: var(--font-size-md);\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n\n.modal-btn-primary {\n  background: var(--color-primary);\n  color: white;\n}\n\n.modal-btn-primary:hover {\n  background: #1976d2;\n}\n\n.modal-btn-secondary {\n  background: #e0e0e0;\n  color: var(--color-text);\n}\n\n.modal-btn-secondary:hover {\n  background: #d0d0d0;\n}\n\n/* Toast */\n.toast-container {\n  position: fixed;\n  bottom: var(--spacing-lg);\n  right: var(--spacing-lg);\n  z-index: 2000;\n  display: flex;\n  flex-direction: column-reverse;\n  gap: var(--spacing-sm);\n}\n\n.toast {\n  background: white;\n  padding: var(--spacing-md) var(--spacing-lg);\n  border-radius: var(--radius-md);\n  box-shadow: var(--shadow-lg);\n  border-left: 4px solid;\n  min-width: 300px;\n  animation: slide-in-right 0.3s;\n}\n\n.toast-success {\n  border-color: #4caf50;\n}\n\n.toast-error {\n  border-color: #f44336;\n}\n\n.toast-info {\n  border-color: var(--color-primary);\n}\n\n@keyframes slide-in-right {\n  from {\n    transform: translateX(100%);\n    opacity: 0;\n  }\n\n  to {\n    transform: translateX(0);\n    opacity: 1;\n  }\n}\n","size_bytes":2657},"js/features/measurement/MeasurementTool.js":{"content":"/* global Helpers, Config */\n\n/**\n * Measurement Tool\n * Click two points to measure distance\n */\nclass MeasurementTool {\n  constructor(canvas, state, eventBus) {\n    this.canvas = canvas;\n    this.state = state;\n    this.eventBus = eventBus;\n    this.active = false;\n    this.points = [];\n    this.measurementLine = null;\n    this.measurementText = null;\n  }\n\n  /**\n   * Activate measurement tool\n   */\n  activate() {\n    this.active = true;\n    this.points = [];\n    this.setupClickHandler();\n    this.eventBus.emit('tool:measure:activated');\n  }\n\n  /**\n   * Deactivate measurement tool\n   */\n  deactivate() {\n    this.active = false;\n    this.clearMeasurement();\n    this.eventBus.emit('tool:measure:deactivated');\n  }\n\n  /**\n   * Toggle measurement tool\n   */\n  toggle() {\n    if (this.active) {\n      this.deactivate();\n    } else {\n      this.activate();\n    }\n    return this.active;\n  }\n\n  /**\n   * Setup click handler\n   */\n  setupClickHandler() {\n    this.clickHandler = (options) => {\n      if (!this.active) return;\n\n      const pointer = this.canvas.getPointer(options.e);\n      this.addPoint(pointer.x, pointer.y);\n    };\n\n    this.canvas.on('mouse:down', this.clickHandler);\n  }\n\n  /**\n   * Add measurement point\n   */\n  addPoint(x, y) {\n    this.points.push({ x, y });\n\n    if (this.points.length === 2) {\n      this.drawMeasurement();\n      this.deactivate();\n    }\n  }\n\n  /**\n   * Draw measurement line and distance\n   */\n  drawMeasurement() {\n    const [p1, p2] = this.points;\n\n    // Calculate distance\n    const distancePx = Helpers.distance(p1.x, p1.y, p2.x, p2.y);\n    const distanceFt = Helpers.pxToFeet(distancePx);\n    const unit = this.state.get('settings.unit') || 'feet';\n\n    let displayDistance = distanceFt;\n    let unitLabel = 'ft';\n\n    if (unit === 'meters') {\n      displayDistance = Helpers.feetToMeters(distanceFt);\n      unitLabel = 'm';\n    }\n\n    // Draw line\n    this.measurementLine = new fabric.Line([p1.x, p1.y, p2.x, p2.y], {\n      stroke: Config.COLORS.dimension,\n      strokeWidth: 2,\n      strokeDashArray: [5, 5],\n      selectable: false,\n      evented: false,\n    });\n\n    // Draw text\n    const midX = (p1.x + p2.x) / 2;\n    const midY = (p1.y + p2.y) / 2;\n\n    this.measurementText = new fabric.Text(\n      `${Helpers.formatNumber(displayDistance, 2)} ${unitLabel}`,\n      {\n        left: midX,\n        top: midY - 10,\n        fontSize: 14,\n        fill: Config.COLORS.dimension,\n        backgroundColor: 'rgba(255,255,255,0.9)',\n        padding: 4,\n        selectable: false,\n        evented: false,\n      },\n    );\n\n    this.canvas.add(this.measurementLine);\n    this.canvas.add(this.measurementText);\n    this.canvas.renderAll();\n\n    this.eventBus.emit('tool:measure:complete', {\n      distance: displayDistance,\n      unit: unitLabel,\n    });\n  }\n\n  /**\n   * Clear measurement\n   */\n  clearMeasurement() {\n    if (this.measurementLine) {\n      this.canvas.remove(this.measurementLine);\n      this.measurementLine = null;\n    }\n\n    if (this.measurementText) {\n      this.canvas.remove(this.measurementText);\n      this.measurementText = null;\n    }\n\n    if (this.clickHandler) {\n      this.canvas.off('mouse:down', this.clickHandler);\n    }\n\n    this.points = [];\n    this.canvas.renderAll();\n  }\n}\n\n// Make available globally\nif (typeof window !== 'undefined') {\n  window.MeasurementTool = MeasurementTool;\n}\n","size_bytes":3368},"js/managers/HistoryManager.js":{"content":"/* global Config, Helpers */\n\n/**\n * History Manager - Undo/Redo System\n * Manages state history stack (50 levels)\n */\nclass HistoryManager {\n  constructor(state, eventBus, maxStates = Config.MAX_HISTORY) {\n    this.state = state;\n    this.eventBus = eventBus;\n    this.maxStates = maxStates;\n    this.states = [];\n    this.currentIndex = -1;\n    this.enabled = true;\n  }\n\n  /**\n   * Save current state to history\n   */\n  save() {\n    if (!this.enabled) return;\n\n    // Get current state\n    const currentState = this.state.getState();\n\n    // Remove any states after current index (for redo clear)\n    this.states = this.states.slice(0, this.currentIndex + 1);\n\n    // Add new state\n    this.states.push(Helpers.deepClone(currentState));\n    this.currentIndex++;\n\n    // Limit stack size\n    if (this.states.length > this.maxStates) {\n      this.states.shift();\n      this.currentIndex--;\n    }\n\n    this.eventBus.emit('history:changed', {\n      canUndo: this.canUndo(),\n      canRedo: this.canRedo(),\n    });\n  }\n\n  /**\n   * Undo last action\n   */\n  undo() {\n    if (!this.canUndo()) return null;\n\n    this.enabled = false;\n    this.currentIndex--;\n    const previousState = Helpers.deepClone(this.states[this.currentIndex]);\n    this.state.loadState(previousState);\n    this.enabled = true;\n\n    this.eventBus.emit('history:undo', previousState);\n    this.eventBus.emit('history:changed', {\n      canUndo: this.canUndo(),\n      canRedo: this.canRedo(),\n    });\n\n    return previousState;\n  }\n\n  /**\n   * Redo last undone action\n   */\n  redo() {\n    if (!this.canRedo()) return null;\n\n    this.enabled = false;\n    this.currentIndex++;\n    const nextState = Helpers.deepClone(this.states[this.currentIndex]);\n    this.state.loadState(nextState);\n    this.enabled = true;\n\n    this.eventBus.emit('history:redo', nextState);\n    this.eventBus.emit('history:changed', {\n      canUndo: this.canUndo(),\n      canRedo: this.canRedo(),\n    });\n\n    return nextState;\n  }\n\n  /**\n   * Check if can undo\n   */\n  canUndo() {\n    return this.currentIndex > 0;\n  }\n\n  /**\n   * Check if can redo\n   */\n  canRedo() {\n    return this.currentIndex < this.states.length - 1;\n  }\n\n  /**\n   * Clear all history\n   */\n  clear() {\n    this.states = [];\n    this.currentIndex = -1;\n    this.eventBus.emit('history:changed', {\n      canUndo: false,\n      canRedo: false,\n    });\n  }\n\n  /**\n   * Get history info\n   */\n  getInfo() {\n    return {\n      total: this.states.length,\n      currentIndex: this.currentIndex,\n      canUndo: this.canUndo(),\n      canRedo: this.canRedo(),\n    };\n  }\n}\n\n// Make available globally\nif (typeof window !== 'undefined') {\n  window.HistoryManager = HistoryManager;\n}\n","size_bytes":2679},"css/reset.css":{"content":"/* CSS Reset */\n* {\n  margin: 0;\n  padding: 0;\n  box-sizing: border-box;\n}\n\nhtml,\nbody {\n  height: 100%;\n  font-family:\n    -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;\n  font-size: 14px;\n  line-height: 1.5;\n}\n\nbutton {\n  font-family: inherit;\n  font-size: inherit;\n  cursor: pointer;\n  border: none;\n  background: none;\n}\n\ninput,\ntextarea,\nselect {\n  font-family: inherit;\n  font-size: inherit;\n}\n\na {\n  text-decoration: none;\n  color: inherit;\n}\n\nul,\nol {\n  list-style: none;\n}\n\nimg {\n  max-width: 100%;\n  height: auto;\n  display: block;\n}\n","size_bytes":591},"replit.md":{"content":"# Garage Layout Planner\n\n## Overview\n\nA browser-based garage and storage layout planning tool using vanilla HTML5, CSS3, and JavaScript ES6. Users can select floor plans, add and manipulate items (vehicles, RVs, boats, storage units), and export layouts as JSON, PNG, or PDF. This is a premium product designed for the Envato marketplace with enterprise-grade architecture and zero build dependencies.\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Core Architecture Pattern\n\nThe application uses a centralized state management pattern with an event bus for decoupled communication. It avoids global variables, using a single `window.app` instance.\n\n**Key architectural decisions:**\n\n- **Pure JavaScript (ES6)**: No frameworks, build tools, or TypeScript for portability and deployment simplicity.\n- **Single Source of Truth**: The `State` class manages all application data as a serializable JSON structure with an observer pattern.\n- **Event Bus Pattern**: Decouples features via publish/subscribe for module communication.\n- **Manager-Based Architecture**: Domain logic is separated into specialized managers (e.g., CanvasManager, ItemManager, FloorPlanManager).\n\n### Frontend Architecture\n\n**Rendering:**\n\n- **Fabric.js 5.3.0**: Used for all canvas rendering and manipulation, providing interactive objects, transformations, and selection. Loaded via CDN.\n- Custom CSS3: Uses CSS variables for theming and a modular structure.\n\n**Layout Structure:**\n\n- Comprises a Header, Toolbar, Info Bar, Sidebar, and Canvas container.\n- Info Bar displays floor plan, selection, and position data.\n- Sidebar features a tabbed interface for Floor Plans, Items, and Saved layouts.\n- Canvas wrapper includes overlay controls for magnification and measurements.\n\n**State Management:**\n\n```javascript\nState = {\n  floorPlan: null, // Current active floor plan\n  items: [], // All placed items\n  selection: null, // Currently selected items\n  history: [], // Undo/redo stack (50 levels)\n  settings: {}, // User preferences\n  ui: {}, // UI state\n  metadata: {}, // Project metadata\n};\n```\n\n**UI/UX Decisions:**\n\n- Modern range slider for zoom control (10%-200%).\n- Entry zone label rotation for readability.\n- Consolidated zoom options into a dropdown.\n- Customizable entry zone (border toggle, 4-position, label toggle).\n- Grid overlay toggle.\n- Info panel redesigned to an inline horizontal layout.\n- Consistent toast notifications and modal dialogs.\n- **Mobile UI Overhaul**: Modern mobile-first UI for viewports ≤ 767px with bottom tab navigation, Floating Action Button (FAB), bottom sheet components, and optimized mobile pages for Floor Plans, Items, Canvas, and More. Includes touch optimization and GPU-accelerated animations.\n- **Responsive Design**: Mobile/tablet responsiveness with breakpoints, touch-optimized UI, and landscape orientation support. Features include collapsible sidebars, full-screen drawer sidebars, and a bottom toolbar for mobile.\n- **Entry Zone Warning System**: Visual warning badge for items blocking entry zones, with real-time detection and debounced checks.\n\n### Data Storage Solutions\n\n**LocalStorage:**\n\n- Auto-saves every 30 seconds to `localStorage`.\n- Supports saving/loading multiple layout projects.\n- `Storage` utility handles quota errors.\n- Fully client-side with no backend database.\n\n**Data Format:**\n\n- Floor plans are defined in `js/data/floorPlans.js` as static templates.\n- Items are defined in `js/data/items.js` with realistic dimensions (in feet).\n- All dimensions are stored in feet and converted to pixels at a 10px/foot ratio.\n- Export format is pure JSON with metadata.\n\n### Key Features Implementation\n\n**Boundary Detection:**\n\n- `Bounds` utility constrains items within the floor plan using Fabric.js bounding boxes.\n- Entry zone (bottom 20%) is calculated and rendered as an overlay rectangle.\n\n**Undo/Redo:**\n\n- `HistoryManager` maintains up to 50 state snapshots using deep cloning.\n\n**Multi-Select:**\n\n- Fabric.js `ActiveSelection` is used for grouping.\n- Supports Shift+click for multi-select and selection box drawing.\n\n**Export Capabilities:**\n\n- **JSON**: Serializes state with metadata.\n- **PNG**: Exports at multiple resolutions (1x, 2x, 4x, 8x) using Fabric.js `toDataURL()`.\n- **PDF**: Uses jsPDF for professional, print-ready (300 DPI) reports with smart paper selection, auto-orientation, margins, metadata, and an item list table.\n\n## External Dependencies\n\n**Third-Party Libraries (All loaded via CDN):**\n\n1.  **Fabric.js 5.3.0**: Canvas rendering and interactive object manipulation.\n2.  **Turf.js 6.x**: Advanced geometry operations.\n3.  **jsPDF**: PDF generation.\n\n**Browser APIs:**\n\n- Canvas API (2D context)\n- LocalStorage API\n- File download (Blob + createObjectURL)\n- Keyboard events\n- Mouse events\n\n**No Server Dependencies:**\n\n- The application is fully static, requires no backend API calls or authentication, and works offline after initial load.\n","size_bytes":4985},"js/data/items.js":{"content":"/**\n * Item Library\n * Pre-defined items with realistic dimensions (all VERTICAL by default)\n * lengthFt = height (vertical), widthFt = width (horizontal)\n */\nconst Items = {\n  categories: {\n    vehicles: {\n      name: 'Vehicles',\n      items: [\n        {\n          id: 'sports-car',\n          label: 'Sports Car',\n          lengthFt: 15,\n          widthFt: 6,\n          color: '#E57373',\n          category: 'vehicles',\n          paletteImage: 'assets/images/items/palette/sports-car-side.png',\n          canvasImage: 'assets/images/items/canvas/sports-car-top.png',\n        },\n        {\n          id: 'sedan',\n          label: 'Sedan',\n          lengthFt: 16,\n          widthFt: 6,\n          color: '#64B5F6',\n          category: 'vehicles',\n          paletteImage: 'assets/images/items/palette/sedan-side.png',\n          canvasImage: 'assets/images/items/canvas/sedan-top.png',\n        },\n        {\n          id: 'pickup',\n          label: 'Pickup Truck',\n          lengthFt: 19,\n          widthFt: 6.5,\n          color: '#81C784',\n          category: 'vehicles',\n          paletteImage: 'assets/images/items/palette/pickup-side.png',\n          canvasImage: 'assets/images/items/canvas/pickup-top.png',\n        },\n        {\n          id: 'suv',\n          label: 'SUV',\n          lengthFt: 17,\n          widthFt: 6.5,\n          color: '#BA68C8',\n          category: 'vehicles',\n          paletteImage: 'assets/images/items/palette/suv-side.png',\n          canvasImage: 'assets/images/items/canvas/suv-top.png',\n        },\n        {\n          id: 'motorcycle',\n          label: 'Motorcycle',\n          lengthFt: 7,\n          widthFt: 3,\n          color: '#FFB74D',\n          category: 'vehicles',\n          paletteImage: 'assets/images/items/palette/motorcycle-side.png',\n          canvasImage: 'assets/images/items/canvas/motorcycle-top.png',\n        },\n        {\n          id: 'van',\n          label: 'Van',\n          lengthFt: 18,\n          widthFt: 6.5,\n          color: '#A1887F',\n          category: 'vehicles',\n          paletteImage: 'assets/images/items/palette/van-side.png',\n          canvasImage: 'assets/images/items/canvas/van-top.png',\n        },\n      ],\n    },\n    recreational: {\n      name: 'Recreational Vehicles',\n      items: [\n        {\n          id: 'boat-trailer',\n          label: 'Boat with Trailer',\n          lengthFt: 20,\n          widthFt: 7,\n          color: '#4DD0E1',\n          category: 'recreational',\n          paletteImage: 'assets/images/items/palette/boat-trailer-side.png',\n          canvasImage: 'assets/images/items/canvas/boat-trailer-top.png',\n        },\n        {\n          id: 'rv-26',\n          label: 'RV (26 ft)',\n          lengthFt: 26,\n          widthFt: 8,\n          color: '#AED581',\n          category: 'recreational',\n          paletteImage: 'assets/images/items/palette/rv-26-side.png',\n          canvasImage: 'assets/images/items/canvas/rv-26-top.png',\n        },\n        {\n          id: 'rv-34',\n          label: 'RV (34 ft)',\n          lengthFt: 34,\n          widthFt: 8.5,\n          color: '#DCE775',\n          category: 'recreational',\n          paletteImage: 'assets/images/items/palette/rv-34-side.png',\n          canvasImage: 'assets/images/items/canvas/rv-34-top.png',\n        },\n        {\n          id: 'jet-ski-trailer',\n          label: 'Jet Ski with Trailer',\n          lengthFt: 12,\n          widthFt: 5,\n          color: '#4FC3F7',\n          category: 'recreational',\n          paletteImage: 'assets/images/items/palette/jet-ski-trailer-side.png',\n          canvasImage: 'assets/images/items/canvas/jet-ski-trailer-top.png',\n        },\n        {\n          id: 'atv',\n          label: 'ATV',\n          lengthFt: 7,\n          widthFt: 4,\n          color: '#FFD54F',\n          category: 'recreational',\n          paletteImage: 'assets/images/items/palette/atv-side.png',\n          canvasImage: 'assets/images/items/canvas/atv-top.png',\n        },\n        {\n          id: 'golf-cart',\n          label: 'Golf Cart',\n          lengthFt: 8,\n          widthFt: 4,\n          color: '#90CAF9',\n          category: 'recreational',\n          paletteImage: 'assets/images/items/palette/golf-cart-side.png',\n          canvasImage: 'assets/images/items/canvas/golf-cart-top.png',\n        },\n      ],\n    },\n    storage: {\n      name: 'Storage & Furniture',\n      items: [\n        {\n          id: 'shelf',\n          label: 'Storage Shelf',\n          lengthFt: 4,\n          widthFt: 2,\n          color: '#90A4AE',\n          category: 'storage',\n          paletteImage: 'assets/images/items/palette/shelf-side.png',\n          canvasImage: 'assets/images/items/canvas/shelf-top.png',\n        },\n        {\n          id: 'workbench',\n          label: 'Workbench',\n          lengthFt: 6,\n          widthFt: 2.5,\n          color: '#8D6E63',\n          category: 'storage',\n          paletteImage: 'assets/images/items/palette/workbench-side.png',\n          canvasImage: 'assets/images/items/canvas/workbench-top.png',\n        },\n        {\n          id: 'storage-box',\n          label: 'Storage Box',\n          lengthFt: 3,\n          widthFt: 3,\n          color: '#B0BEC5',\n          category: 'storage',\n          paletteImage: 'assets/images/items/palette/storage-box-side.png',\n          canvasImage: 'assets/images/items/canvas/storage-box-top.png',\n        },\n        {\n          id: 'tool-cabinet',\n          label: 'Tool Cabinet',\n          lengthFt: 5,\n          widthFt: 2,\n          color: '#EF5350',\n          category: 'storage',\n          paletteImage: 'assets/images/items/palette/tool-cabinet-side.png',\n          canvasImage: 'assets/images/items/canvas/tool-cabinet-top.png',\n        },\n        {\n          id: 'bike-rack',\n          label: 'Bike Rack',\n          lengthFt: 6,\n          widthFt: 2,\n          color: '#42A5F5',\n          category: 'storage',\n          paletteImage: 'assets/images/items/palette/bike-rack-side.png',\n          canvasImage: 'assets/images/items/canvas/bike-rack-top.png',\n        },\n        {\n          id: 'freezer',\n          label: 'Chest Freezer',\n          lengthFt: 5,\n          widthFt: 2.5,\n          color: '#ECEFF1',\n          category: 'storage',\n          paletteImage: 'assets/images/items/palette/freezer-side.png',\n          canvasImage: 'assets/images/items/canvas/freezer-top.png',\n        },\n        {\n          id: 'scaffold-rack',\n          label: 'Scaffold Rack',\n          lengthFt: 8,\n          widthFt: 1.5,\n          color: '#FFA726',\n          category: 'storage',\n          paletteImage: 'assets/images/items/palette/scaffold-side.png',\n          canvasImage: 'assets/images/items/canvas/scaffold-top.png',\n        },\n        {\n          id: 'kayak',\n          label: 'Kayak',\n          lengthFt: 12,\n          widthFt: 2.8,\n          color: '#A1887F',\n          category: 'storage',\n          paletteImage: 'assets/images/items/palette/kayak-side.png',\n          canvasImage: 'assets/images/items/canvas/kayak-top.png',\n        },\n        {\n          id: 'small-tool-box',\n          label: 'Tool Box',\n          lengthFt: 3,\n          widthFt: 1.5,\n          color: '#90A4AE',\n          category: 'storage',\n          paletteImage: 'assets/images/items/palette/small-tool-box-side.png',\n          canvasImage: 'assets/images/items/canvas/small-tool-box-top.png',\n        },\n        {\n          id: 'car-lift',\n          label: 'Car Lift',\n          lengthFt: 15,\n          widthFt: 9,\n          color: '#EF5350',\n          category: 'storage',\n          paletteImage: 'assets/images/items/palette/car-lift-side.png',\n          canvasImage: 'assets/images/items/canvas/car-lift-top.png',\n        },\n      ],\n    },\n  },\n\n  /**\n   * Get all items\n   */\n  getAll() {\n    const allItems = [];\n    for (const category in this.categories) {\n      allItems.push(...this.categories[category].items);\n    }\n    return allItems;\n  },\n\n  /**\n   * Get item by ID\n   */\n  getById(id) {\n    return this.getAll().find((item) => item.id === id);\n  },\n\n  /**\n   * Get items by category\n   */\n  getByCategory(categoryName) {\n    return this.categories[categoryName]?.items || [];\n  },\n\n  /**\n   * Get all category names\n   */\n  getCategoryNames() {\n    return Object.keys(this.categories);\n  },\n\n  /**\n   * Search items by name\n   */\n  search(query) {\n    const lowerQuery = query.toLowerCase();\n    return this.getAll().filter(\n      (item) =>\n        item.label.toLowerCase().includes(lowerQuery) || item.id.toLowerCase().includes(lowerQuery),\n    );\n  },\n};\n\n// Make available globally\nif (typeof window !== 'undefined') {\n  window.Items = Items;\n}\n","size_bytes":8558},"README.md":{"content":"# Garage Layout Planner\n\n**Professional, Enterprise-Grade Garage & Storage Layout Planning Tool**\n\nA browser-based garage layout planner built with pure HTML5, CSS3, and JavaScript ES6. No frameworks, no build tools - just open and use.\n\n## Features\n\n### Core Functionality\n\n- **7 Pre-Defined Floor Plans** - From 20×25' to 24×50' (500-1200 sq ft)\n- **20+ Realistic Items** - Vehicles, RVs, boats, storage with accurate dimensions\n- **Drag & Drop Interface** - Intuitive item placement\n- **Boundary Detection** - Items stay inside floor plan automatically\n- **Entry Zone Warnings** - Bottom 20% marked for garage door clearance\n\n### Item Manipulation\n\n- **Selection Tools** - Single-click, multi-select (Shift+click), selection box\n- **Transform Operations** - Move, rotate (90° or free), duplicate, delete\n- **Alignment Tools** - Left, right, center, top, bottom, middle\n- **Z-Order Control** - Bring to front, send to back\n- **Lock/Unlock** - Prevent accidental movement\n\n### Professional Tools\n\n- **50-Level Undo/Redo** - Full history stack\n- **Magnifying Glass** - 2.5x zoom for precision\n- **Measurement Tool** - Click two points to measure distance\n- **Dimensions Display** - Real-time size and position info\n- **Area Calculations** - Total vs occupied space\n- **Snap to Grid** - 1-foot increments\n\n### Export & Save\n\n- **JSON Export** - Complete layout data\n- **PNG Export** - Multiple resolutions (1x, 2x, 4x, 8x)\n- **PDF Export** - Professional reports with item list\n- **Auto-Save** - Every 30 seconds to localStorage\n- **Save/Load Layouts** - Manage multiple projects\n\n### Keyboard Shortcuts\n\n- **Arrow Keys** - Nudge items (2px, Shift = 10px)\n- **Delete/Backspace** - Remove selected items\n- **R** - Rotate 90°\n- **Ctrl+D** - Duplicate\n- **Ctrl+C/V** - Copy/Paste\n- **Ctrl+Z/Y** - Undo/Redo\n- **Ctrl+A** - Select all\n- **Esc** - Deselect\n\n## Installation\n\n### Option 1: Direct Open\n\n1. Download or clone this repository\n2. Open `index.html` in your browser\n3. Start planning!\n\n### Option 2: Local Web Server\n\n```bash\n# Python 3\npython3 -m http.server 5000\n\n# Python 2\npython -m SimpleHTTPServer 5000\n\n# Node.js\nnpx http-server -p 5000\n```\n\nThen open `http://localhost:5000` in your browser.\n\n## Usage Guide\n\n### Getting Started\n\n1. **Select a Floor Plan** - Click a floor plan from the left sidebar\n2. **Add Items** - Switch to \"Items\" tab and click items to add them\n3. **Arrange Layout** - Drag items, rotate, resize as needed\n4. **Save** - Click the save button to store your layout\n\n### Item Management\n\n- **Add Item** - Click any item in the palette (added to center)\n- **Move Item** - Click and drag or use arrow keys\n- **Rotate Item** - Click rotate button or press R\n- **Duplicate Item** - Select and press Ctrl+D\n- **Delete Item** - Select and press Delete\n- **Lock Item** - Prevent movement (coming soon)\n\n### Alignment\n\n- Select multiple items (Shift+click)\n- Use alignment buttons to align edges or centers\n- Items snap together for precise placement\n\n### Export Options\n\n- **JSON** - Save complete layout data for backup/sharing\n- **PNG** - High-resolution images for presentations\n- **PDF** - Professional reports with measurements\n\n## Browser Support\n\n- Chrome 90+ ✓\n- Firefox 88+ ✓\n- Safari 14+ ✓\n- Edge 90+ ✓\n- Modern mobile browsers (iOS 14+, Android)\n\n## Technology Stack\n\n- **Pure HTML5, CSS3, JavaScript ES6** - No frameworks\n- **Fabric.js 5.3.0** - Canvas rendering\n- **Turf.js 6.x** - Geometry operations\n- **jsPDF** - PDF generation\n- **html2canvas** - Canvas screenshots\n\n## Architecture\n\n### Modular Design\n\n- **State Management** - Centralized state with observer pattern\n- **Event Bus** - Decoupled module communication\n- **Manager Classes** - Separation of concerns\n  - CanvasManager - Fabric.js operations\n  - FloorPlanManager - Floor plan CRUD\n  - ItemManager - Item library and operations\n  - SelectionManager - Selection and manipulation\n  - ExportManager - JSON/PNG/PDF exports\n  - HistoryManager - Undo/redo stack\n\n### File Structure\n\n```\n├── index.html\n├── css/\n│   ├── reset.css\n│   ├── variables.css\n│   ├── layout.css\n│   ├── components/\n│   └── main.css\n├── js/\n│   ├── core/          # State, EventBus, Config, App\n│   ├── managers/      # 6 manager classes\n│   ├── features/      # Magnifier, Measurement, etc.\n│   ├── ui/            # UI components\n│   ├── utils/         # Helper functions\n│   └── data/          # Floor plans, items, icons\n├── assets/\n└── docs/\n```\n\n## Scaling & Dimensions\n\n- **1 foot = 10 pixels** (PX_PER_FOOT = 10)\n- All items are **vertical by default** (length = height)\n- Realistic dimensions based on actual vehicles/items\n- Automatic unit conversion (feet ↔ meters)\n\n## Customization\n\n### Adding Custom Items\n\nEdit `js/data/items.js` to add new items:\n\n```javascript\n{\n  id: 'custom-item',\n  label: 'Custom Item',\n  lengthFt: 10,\n  widthFt: 5,\n  color: '#FF5722',\n  category: 'storage'\n}\n```\n\n### Custom Floor Plans\n\nPhase 2 will include custom floor plan drawing tool.\n\n## License\n\nMIT License - See LICENSE.txt for details\n\n## Credits\n\nBuilt as an enterprise-grade product for sale on Envato marketplace.\n\n## Support\n\nFor issues or questions, please create an issue on GitHub or contact support.\n\n## Roadmap\n\n### Phase 1 (Current - MVP) ✓\n\n- 7 rectangular floor plans\n- 20+ items\n- Complete manipulation tools\n- Export (JSON, PNG, PDF)\n- Undo/redo system\n- Keyboard shortcuts\n\n### Phase 2 (Advanced Features)\n\n- Custom floor plan drawing\n- L-shaped & T-shaped floor plans\n- Doors, windows, obstacles\n- Multiple rooms/zones\n- Import floor plan images\n- 30+ pre-made templates\n- Collaboration features\n\n### Phase 3 (Pro Features)\n\n- 3D preview mode\n- AI layout assistant\n- Cost estimation\n- Client management\n- Proposal generation\n- White-label branding\n\n---\n\n**Version:** 1.0.0  \n**Last Updated:** November 2025  \n**Status:** Production Ready\n","size_bytes":5961},"js/main.js":{"content":"/* global App */\n\n/**\n * Main Entry Point\n * Initialize application when DOM is ready\n */\n(function () {\n  'use strict';\n\n  // Wait for DOM to be ready\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', initApp);\n  } else {\n    initApp();\n  }\n\n  function initApp() {\n    console.log('DOM ready, starting application...');\n\n    // Create and initialize app\n    const app = new App();\n    app.init().catch((error) => {\n      console.error('Failed to initialize application:', error);\n      showError('Failed to initialize application. Please refresh the page.');\n    });\n\n    // Make app globally available\n    window.app = app;\n  }\n\n  function showError(message) {\n    const errorDiv = document.createElement('div');\n    errorDiv.style.cssText = `\n      position: fixed;\n      top: 20px;\n      right: 20px;\n      background: #f44336;\n      color: white;\n      padding: 16px 24px;\n      border-radius: 8px;\n      box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n      z-index: 10000;\n    `;\n    errorDiv.textContent = message;\n    document.body.appendChild(errorDiv);\n\n    setTimeout(() => {\n      errorDiv.remove();\n    }, 5000);\n  }\n})();\n","size_bytes":1172},"js/features/magnifier/Magnifier.js":{"content":"/* global Config */\n\n/**\n * Magnifier Tool\n * Provides 2.5x zoom magnifying glass over canvas\n */\nclass Magnifier {\n  constructor(canvas, config = {}) {\n    this.canvas = canvas;\n    this.zoom = config.zoom || Config.MAGNIFIER_ZOOM;\n    this.size = config.size || Config.MAGNIFIER_SIZE;\n    this.active = false;\n    this.magnifierEl = null;\n    this.magnifierCanvas = null;\n    this.magnifierCtx = null;\n  }\n\n  /**\n   * Initialize magnifier\n   */\n  init() {\n    this.createMagnifierElement();\n    this.setupEventListeners();\n  }\n\n  /**\n   * Create magnifier DOM element\n   */\n  createMagnifierElement() {\n    // Container\n    this.magnifierEl = document.createElement('div');\n    this.magnifierEl.style.cssText = `\n      position: absolute;\n      width: ${this.size}px;\n      height: ${this.size}px;\n      border: 3px solid #2196F3;\n      border-radius: 50%;\n      box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n      pointer-events: none;\n      display: none;\n      overflow: hidden;\n      z-index: 1000;\n    `;\n\n    // Canvas for magnified view\n    this.magnifierCanvas = document.createElement('canvas');\n    this.magnifierCanvas.width = this.size;\n    this.magnifierCanvas.height = this.size;\n    this.magnifierCtx = this.magnifierCanvas.getContext('2d');\n\n    this.magnifierEl.appendChild(this.magnifierCanvas);\n    document.body.appendChild(this.magnifierEl);\n  }\n\n  /**\n   * Setup event listeners\n   */\n  setupEventListeners() {\n    const canvasEl = this.canvas.lowerCanvasEl;\n\n    canvasEl.addEventListener('mousemove', (e) => {\n      if (!this.active) return;\n\n      const rect = canvasEl.getBoundingClientRect();\n      const x = e.clientX - rect.left;\n      const y = e.clientY - rect.top;\n\n      this.updateMagnifier(x, y, e.clientX, e.clientY);\n    });\n\n    canvasEl.addEventListener('mouseout', () => {\n      if (this.active) {\n        this.magnifierEl.style.display = 'none';\n      }\n    });\n\n    canvasEl.addEventListener('mouseover', () => {\n      if (this.active) {\n        this.magnifierEl.style.display = 'block';\n      }\n    });\n  }\n\n  /**\n   * Update magnifier position and content\n   */\n  updateMagnifier(canvasX, canvasY, screenX, screenY) {\n    // Position magnifier\n    const offset = 20;\n    this.magnifierEl.style.left = screenX + offset + 'px';\n    this.magnifierEl.style.top = screenY + offset + 'px';\n\n    // Clear magnifier canvas\n    this.magnifierCtx.clearRect(0, 0, this.size, this.size);\n\n    // Get source canvas\n    const sourceCanvas = this.canvas.lowerCanvasEl;\n\n    // Calculate source region\n    const sourceSize = this.size / this.zoom;\n    const sourceX = canvasX - sourceSize / 2;\n    const sourceY = canvasY - sourceSize / 2;\n\n    // Draw magnified region\n    this.magnifierCtx.save();\n    this.magnifierCtx.beginPath();\n    this.magnifierCtx.arc(this.size / 2, this.size / 2, this.size / 2, 0, Math.PI * 2);\n    this.magnifierCtx.clip();\n\n    this.magnifierCtx.drawImage(\n      sourceCanvas,\n      sourceX,\n      sourceY,\n      sourceSize,\n      sourceSize,\n      0,\n      0,\n      this.size,\n      this.size,\n    );\n\n    this.magnifierCtx.restore();\n\n    // Draw crosshair\n    this.drawCrosshair();\n  }\n\n  /**\n   * Draw crosshair in center\n   */\n  drawCrosshair() {\n    const center = this.size / 2;\n    this.magnifierCtx.strokeStyle = '#FF5722';\n    this.magnifierCtx.lineWidth = 1;\n\n    // Vertical line\n    this.magnifierCtx.beginPath();\n    this.magnifierCtx.moveTo(center, center - 10);\n    this.magnifierCtx.lineTo(center, center + 10);\n    this.magnifierCtx.stroke();\n\n    // Horizontal line\n    this.magnifierCtx.beginPath();\n    this.magnifierCtx.moveTo(center - 10, center);\n    this.magnifierCtx.lineTo(center + 10, center);\n    this.magnifierCtx.stroke();\n  }\n\n  /**\n   * Toggle magnifier\n   */\n  toggle() {\n    this.active = !this.active;\n    this.magnifierEl.style.display = this.active ? 'block' : 'none';\n    return this.active;\n  }\n\n  /**\n   * Activate magnifier\n   */\n  activate() {\n    this.active = true;\n  }\n\n  /**\n   * Deactivate magnifier\n   */\n  deactivate() {\n    this.active = false;\n    this.magnifierEl.style.display = 'none';\n  }\n\n  /**\n   * Destroy magnifier\n   */\n  destroy() {\n    if (this.magnifierEl) {\n      this.magnifierEl.remove();\n    }\n  }\n}\n\n// Make available globally\nif (typeof window !== 'undefined') {\n  window.Magnifier = Magnifier;\n}\n","size_bytes":4321},"css/components/info-panel.css":{"content":"/* Info Bar Styles - Inline Horizontal Layout */\n.info-bar {\n  display: flex;\n  align-items: center;\n  gap: 16px;\n  padding: 10px 16px;\n  background: var(--color-bg-panel);\n  border-bottom: 1px solid var(--color-border);\n  font-size: 13px;\n  min-height: 40px;\n  flex-shrink: 0;\n  flex-wrap: wrap;\n  row-gap: 8px;\n}\n\n.info-bar__segment {\n  display: inline-flex;\n  align-items: center;\n  gap: 6px;\n  white-space: nowrap;\n}\n\n.info-bar__label {\n  color: var(--color-text-secondary);\n  font-weight: 400;\n}\n\n.info-bar__value {\n  color: var(--color-text);\n  font-weight: 500;\n}\n\n.info-bar__divider {\n  width: 1px;\n  height: 16px;\n  background: var(--color-border);\n  display: inline-block;\n}\n\n.info-bar__placeholder {\n  color: var(--color-text-tertiary);\n  font-size: 13px;\n  font-style: italic;\n}\n\n@media (width <= 768px) {\n  .info-bar {\n    gap: 12px;\n    padding: 8px 12px;\n  }\n\n  .info-bar__segment {\n    font-size: 12px;\n  }\n}\n","size_bytes":925},"js/core/EventBus.js":{"content":"/**\n * EventBus - Decoupled event communication system\n * Implements pub/sub pattern for module communication\n */\nclass EventBus {\n  constructor() {\n    this.events = {};\n  }\n\n  /**\n   * Subscribe to an event\n   * @param {string} eventName - Event name (e.g., 'item:added')\n   * @param {function} callback - Callback function\n   */\n  on(eventName, callback) {\n    if (!this.events[eventName]) {\n      this.events[eventName] = [];\n    }\n    this.events[eventName].push(callback);\n  }\n\n  /**\n   * Unsubscribe from an event\n   * @param {string} eventName - Event name\n   * @param {function} callback - Callback to remove\n   */\n  off(eventName, callback) {\n    if (!this.events[eventName]) return;\n\n    this.events[eventName] = this.events[eventName].filter((cb) => cb !== callback);\n\n    if (this.events[eventName].length === 0) {\n      delete this.events[eventName];\n    }\n  }\n\n  /**\n   * Emit an event\n   * @param {string} eventName - Event name\n   * @param {any} data - Event data\n   */\n  emit(eventName, data) {\n    if (!this.events[eventName]) return;\n\n    this.events[eventName].forEach((callback) => {\n      try {\n        callback(data);\n      } catch (error) {\n        console.error(`Error in event handler for ${eventName}:`, error);\n      }\n    });\n  }\n\n  /**\n   * Subscribe to event once (auto-unsubscribe after first call)\n   * @param {string} eventName - Event name\n   * @param {function} callback - Callback function\n   */\n  once(eventName, callback) {\n    const onceCallback = (data) => {\n      callback(data);\n      this.off(eventName, onceCallback);\n    };\n    this.on(eventName, onceCallback);\n  }\n\n  /**\n   * Clear all event listeners\n   */\n  clear() {\n    this.events = {};\n  }\n\n  /**\n   * Get list of all registered events\n   */\n  getEvents() {\n    return Object.keys(this.events);\n  }\n}\n\n// Make available globally\nif (typeof window !== 'undefined') {\n  window.EventBus = EventBus;\n}\n","size_bytes":1903},"js/core/State.js":{"content":"/**\n * State Management - Single source of truth\n * Implements observer pattern for state changes\n */\nclass State {\n  constructor() {\n    this.state = {\n      floorPlan: null,\n      items: [],\n      selection: null,\n      history: [],\n      settings: {\n        unit: 'feet',\n        showGrid: true,\n        snapToGrid: false,\n        showLabels: true,\n        showDimensions: true,\n        showRuler: false,\n        entryZonePosition: 'bottom',\n        showEntryZoneLabel: true,\n        showEntryZoneBorder: true,\n        showItemLabels: true,\n      },\n      ui: {\n        sidebarOpen: true,\n        infoPanelOpen: true,\n        activeTab: 'floorplans',\n        magnifierActive: false,\n        measurementActive: false,\n      },\n      metadata: {\n        projectName: 'Untitled Layout',\n        clientName: '',\n        created: null,\n        modified: null,\n        version: '1.0.0',\n      },\n    };\n\n    this.observers = [];\n  }\n\n  /**\n   * Get current state (read-only)\n   */\n  getState() {\n    return JSON.parse(JSON.stringify(this.state));\n  }\n\n  /**\n   * Update state and notify observers\n   * @param {object} updates - Partial state updates\n   */\n  setState(updates) {\n    // Deep merge updates into state\n    this._deepMerge(this.state, updates);\n\n    // Update modified timestamp\n    this.state.metadata.modified = new Date().toISOString();\n\n    // Notify observers\n    this._notifyObservers();\n  }\n\n  /**\n   * Subscribe to state changes\n   * @param {function} callback - Observer callback\n   */\n  subscribe(callback) {\n    this.observers.push(callback);\n\n    // Return unsubscribe function\n    return () => {\n      this.observers = this.observers.filter((obs) => obs !== callback);\n    };\n  }\n\n  /**\n   * Get specific state property\n   * @param {string} path - Dot notation path (e.g., 'settings.unit')\n   */\n  get(path) {\n    return path.split('.').reduce((obj, key) => obj?.[key], this.state);\n  }\n\n  /**\n   * Set specific state property\n   * @param {string} path - Dot notation path\n   * @param {any} value - New value\n   */\n  set(path, value) {\n    const keys = path.split('.');\n    const lastKey = keys.pop();\n    const target = keys.reduce((obj, key) => obj[key], this.state);\n    target[lastKey] = value;\n\n    this.state.metadata.modified = new Date().toISOString();\n    this._notifyObservers();\n  }\n\n  /**\n   * Reset state to initial values\n   */\n  reset() {\n    const settings = { ...this.state.settings };\n\n    this.state = {\n      floorPlan: null,\n      items: [],\n      selection: null,\n      history: [],\n      settings: settings,\n      ui: {\n        sidebarOpen: true,\n        infoPanelOpen: true,\n        activeTab: 'floorplans',\n        magnifierActive: false,\n        measurementActive: false,\n      },\n      metadata: {\n        projectName: 'Untitled Layout',\n        clientName: '',\n        created: new Date().toISOString(),\n        modified: new Date().toISOString(),\n        version: '1.0.0',\n      },\n    };\n\n    this._notifyObservers();\n  }\n\n  /**\n   * Load state from object\n   * @param {object} savedState - Previously saved state\n   */\n  /**\n   * Load saved state\n   * Validates and merges saved state into current state\n   * @param {object} savedState - Previously saved state object\n   */\n  loadState(savedState) {\n    if (!savedState) {\n      console.warn('[State] Attempted to load null/undefined state');\n      return;\n    }\n\n    // Validate state structure\n    if (typeof savedState !== 'object') {\n      console.error('[State] Invalid state type:', typeof savedState);\n      return;\n    }\n\n    // [State] Loading state\n\n    // Merge saved state, preserving structure\n    this.state = {\n      ...this.state,\n      floorPlan: savedState.floorPlan || null,\n      items: Array.isArray(savedState.items) ? savedState.items : [],\n      settings: {\n        ...this.state.settings,\n        ...(savedState.settings || {}),\n      },\n      metadata: {\n        ...this.state.metadata,\n        ...(savedState.metadata || {}),\n        modified: new Date().toISOString(),\n      },\n    };\n\n    this._notifyObservers();\n  }\n\n  /**\n   * Serialize state to JSON\n   */\n  toJSON() {\n    return JSON.stringify(this.state, null, 2);\n  }\n\n  /**\n   * Notify all observers of state change\n   * @private\n   */\n  _notifyObservers() {\n    const state = this.getState();\n    this.observers.forEach((callback) => {\n      try {\n        callback(state);\n      } catch (error) {\n        console.error('Error in state observer:', error);\n      }\n    });\n  }\n\n  /**\n   * Deep merge objects\n   * @private\n   */\n  _deepMerge(target, source) {\n    for (const key in source) {\n      if (source[key] && typeof source[key] === 'object' && !Array.isArray(source[key])) {\n        if (!target[key]) target[key] = {};\n        this._deepMerge(target[key], source[key]);\n      } else {\n        target[key] = source[key];\n      }\n    }\n  }\n}\n\n// Make available globally\nif (typeof window !== 'undefined') {\n  window.State = State;\n}\n","size_bytes":4927},"js/utils/validation.js":{"content":"/* global Config */\n\n/**\n * Validation Utilities\n * Input validation and data checking\n */\nconst Validation = {\n  /**\n   * Validate floor plan data\n   */\n  validateFloorPlan(floorPlan) {\n    const errors = [];\n\n    if (!floorPlan) {\n      errors.push('Floor plan is required');\n      return { valid: false, errors };\n    }\n\n    if (!floorPlan.widthFt || floorPlan.widthFt <= 0) {\n      errors.push('Floor plan width must be greater than 0');\n    }\n\n    if (!floorPlan.heightFt || floorPlan.heightFt <= 0) {\n      errors.push('Floor plan height must be greater than 0');\n    }\n\n    if (floorPlan.widthFt * floorPlan.heightFt < 100) {\n      errors.push('Floor plan area must be at least 100 sq ft');\n    }\n\n    return {\n      valid: errors.length === 0,\n      errors,\n    };\n  },\n\n  /**\n   * Validate item data\n   */\n  validateItem(item) {\n    const errors = [];\n\n    if (!item) {\n      errors.push('Item is required');\n      return { valid: false, errors };\n    }\n\n    if (!item.id) {\n      errors.push('Item ID is required');\n    }\n\n    if (!item.label || item.label.trim() === '') {\n      errors.push('Item label is required');\n    }\n\n    if (!item.lengthFt || item.lengthFt <= 0) {\n      errors.push('Item length must be greater than 0');\n    }\n\n    if (!item.widthFt || item.widthFt <= 0) {\n      errors.push('Item width must be greater than 0');\n    }\n\n    return {\n      valid: errors.length === 0,\n      errors,\n    };\n  },\n\n  /**\n   * Validate layout name\n   */\n  validateLayoutName(name) {\n    const errors = [];\n\n    if (!name || name.trim() === '') {\n      errors.push('Layout name is required');\n    }\n\n    if (name.length > 100) {\n      errors.push('Layout name must be less than 100 characters');\n    }\n\n    return {\n      valid: errors.length === 0,\n      errors,\n    };\n  },\n\n  /**\n   * Validate export options\n   */\n  validateExportOptions(options) {\n    const errors = [];\n\n    if (options.type && !['json', 'png', 'pdf'].includes(options.type)) {\n      errors.push('Invalid export type');\n    }\n\n    if (options.resolution && !Config.EXPORT_RESOLUTIONS.includes(options.resolution)) {\n      errors.push('Invalid export resolution');\n    }\n\n    return {\n      valid: errors.length === 0,\n      errors,\n    };\n  },\n\n  /**\n   * Sanitize HTML string\n   */\n  sanitizeHTML(str) {\n    const div = document.createElement('div');\n    div.textContent = str;\n    return div.innerHTML;\n  },\n\n  /**\n   * Validate number within range\n   */\n  validateNumber(value, min, max) {\n    const num = parseFloat(value);\n    return !isNaN(num) && num >= min && num <= max;\n  },\n};\n\n// Make available globally\nif (typeof window !== 'undefined') {\n  window.Validation = Validation;\n}\n","size_bytes":2676},"css/components/sidebar.css":{"content":"/* Modern Sidebar - Clean & Minimal */\n\n/* Floor Plan List */\n#floorplan-list {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n\n.floorplan-item {\n  padding: 14px;\n  background: var(--color-bg-panel);\n  border: 1px solid var(--color-border);\n  border-radius: var(--radius-md);\n  cursor: pointer;\n  transition: all var(--transition-fast);\n}\n\n.floorplan-item:hover {\n  border-color: var(--color-border-hover);\n  box-shadow: var(--shadow-sm);\n  transform: translateY(-1px);\n}\n\n.floorplan-item.selected {\n  border-color: var(--color-primary);\n  background: var(--color-primary-light);\n  box-shadow: 0 0 0 1px var(--color-primary);\n}\n\n.floorplan-name {\n  font-weight: 600;\n  font-size: 14px;\n  color: var(--color-text);\n  margin-bottom: 4px;\n}\n\n.floorplan-info {\n  font-size: 12px;\n  color: var(--color-text-secondary);\n  margin-bottom: 6px;\n}\n\n.floorplan-area {\n  font-size: 13px;\n  color: var(--color-primary);\n  font-weight: 500;\n}\n\n/* Item Palette */\n#item-palette {\n  display: flex;\n  flex-direction: column;\n  gap: 20px;\n}\n\n.item-category {\n  margin-bottom: 16px;\n}\n\n.category-title {\n  font-size: 11px;\n  font-weight: 600;\n  color: var(--color-text-secondary);\n  text-transform: uppercase;\n  letter-spacing: 0.05em;\n  margin-bottom: 12px;\n}\n\n.category-items {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 8px;\n}\n\n.palette-item {\n  padding: 12px;\n  border: 1.5px solid;\n  border-radius: var(--radius-md);\n  cursor: pointer;\n  text-align: center;\n  transition: all var(--transition-base);\n  position: relative;\n  background: var(--color-bg-panel);\n}\n\n.palette-item:hover {\n  transform: translateY(-2px);\n  box-shadow: var(--shadow-md);\n  border-width: 2px;\n}\n\n.palette-item:active {\n  transform: translateY(0);\n}\n\n.palette-item .item-label {\n  font-weight: 600;\n  font-size: 12px;\n  color: #18181b;\n  margin-bottom: 4px;\n  line-height: 1.3;\n}\n\n.palette-item .item-size {\n  font-size: 11px;\n  color: #71717a;\n  font-weight: 500;\n}\n\n/* Saved Layouts */\n#saved-layouts-list {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n\n.saved-layout-item {\n  padding: 14px;\n  background: var(--color-bg-panel);\n  border: 1px solid var(--color-border);\n  border-radius: var(--radius-md);\n  transition: all var(--transition-fast);\n}\n\n.saved-layout-item:hover {\n  border-color: var(--color-border-hover);\n  box-shadow: var(--shadow-sm);\n}\n\n.saved-layout-name {\n  font-weight: 600;\n  font-size: 14px;\n  color: var(--color-text);\n  margin-bottom: 4px;\n}\n\n.saved-layout-date {\n  font-size: 12px;\n  color: var(--color-text-secondary);\n  margin-bottom: 10px;\n}\n\n.saved-layout-actions {\n  display: flex;\n  gap: 6px;\n}\n\n.btn-load-layout,\n.btn-delete-layout {\n  flex: 1;\n  padding: 6px 12px;\n  font-size: 12px;\n  font-weight: 500;\n  border-radius: var(--radius-sm);\n  border: none;\n  cursor: pointer;\n  transition: all var(--transition-fast);\n}\n\n.btn-load-layout {\n  background: var(--color-primary);\n  color: white;\n}\n\n.btn-load-layout:hover {\n  background: var(--color-primary-dark);\n  transform: translateY(-1px);\n  box-shadow: var(--shadow-sm);\n}\n\n.btn-delete-layout {\n  background: var(--color-bg);\n  color: var(--color-text-secondary);\n  border: 1px solid var(--color-border);\n}\n\n.btn-delete-layout:hover {\n  background: #fef2f2;\n  color: #dc2626;\n  border-color: #dc2626;\n}\n","size_bytes":3294},"js/core/Config.js":{"content":"/**\n * Configuration Constants\n * Central configuration for the Garage Layout Planner\n */\nconst Config = {\n  USE_IMAGES: true,\n  // Scaling\n  PX_PER_FOOT: 10,\n\n  // Floor Plans (in feet)\n  FLOOR_PLANS: [\n    {\n      id: 'fp-unit-a',\n      widthFt: 22,\n      heightFt: 55,\n      name: \"Units A - 22'×55'\",\n      area: 1210,\n      description: \"Door: 14' × 14'\",\n      doorWidth: 14,\n      doorHeight: 14,\n    },\n    {\n      id: 'fp-unit-b',\n      widthFt: 15,\n      heightFt: 55,\n      name: \"Units B - 15'×55'\",\n      area: 825,\n      description: \"Door: 13' × 14'\",\n      doorWidth: 13,\n      doorHeight: 14,\n    },\n    {\n      id: 'fp-unit-c',\n      widthFt: 15,\n      heightFt: 55,\n      name: \"Units C - 15'×55'\",\n      area: 825,\n      description: \"Door: 13' × 14'\",\n      doorWidth: 13,\n      doorHeight: 14,\n    },\n    {\n      id: 'fp-unit-d',\n      widthFt: 15,\n      heightFt: 50,\n      name: \"Units D - 15'×50'\",\n      area: 750,\n      description: \"Door: 13' × 14'\",\n      doorWidth: 13,\n      doorHeight: 14,\n    },\n    {\n      id: 'fp-unit-e',\n      widthFt: 14,\n      heightFt: 35,\n      name: \"Units E - 14'×35'\",\n      area: 490,\n      description: \"Door: 12' × 12'\",\n      doorWidth: 12,\n      doorHeight: 12,\n    },\n    {\n      id: 'fp-unit-f',\n      widthFt: 18,\n      heightFt: 50,\n      name: \"Units F - 18'×50'\",\n      area: 900,\n      description: \"Door: 14' × 14'\",\n      doorWidth: 14,\n      doorHeight: 14,\n    },\n    {\n      id: 'fp-unit-h',\n      widthFt: 15,\n      heightFt: 50,\n      name: \"Units H - 15'×50'\",\n      area: 750,\n      description: \"Door: 13' × 14'\",\n      doorWidth: 13,\n      doorHeight: 14,\n    },\n  ],\n\n  // Canvas\n  CANVAS_PADDING: 50,\n  GRID_SIZE: 10, // 1 foot in pixels\n\n  // History\n  MAX_HISTORY: 50,\n\n  // Auto-save\n  AUTOSAVE_INTERVAL: 30000, // 30 seconds\n\n  // Entry Zone\n  ENTRY_ZONE_PERCENTAGE: 0.05, // Bottom 5%\n\n  // Units\n  UNITS: {\n    FEET: 'feet',\n    METERS: 'meters',\n  },\n\n  // Export\n  EXPORT_RESOLUTIONS: [1, 2, 4, 8],\n  PDF_MARGINS: 0.5, // inches\n\n  // Magnifier\n  MAGNIFIER_ZOOM: 2.5,\n  MAGNIFIER_SIZE: 150,\n\n  // Keyboard\n  NUDGE_DISTANCE: 2, // pixels\n  NUDGE_DISTANCE_LARGE: 10, // pixels with Shift\n\n  // Colors\n  COLORS: {\n    floorPlan: '#ffffff',\n    floorPlanStroke: '#2c3e50',\n    grid: '#b0b0b0',\n    entryZone: 'rgba(255, 0, 0, 0.15)',\n    entryZoneWarning: 'rgba(255, 0, 0, 0.3)',\n    selection: '#2196F3',\n    alignmentGuide: '#FF5722',\n    dimension: '#666666',\n  },\n\n  // Storage Keys\n  STORAGE_KEYS: {\n    layouts: 'garage-planner-layouts',\n    settings: 'garage-planner-settings',\n    autosave: 'garage-planner-autosave',\n  },\n};\n\n// Make available globally\nif (typeof window !== 'undefined') {\n  window.Config = Config;\n}\n","size_bytes":2731},"js/managers/FloorPlanManager.js":{"content":"/* global Config, Validation */\n\n/**\n * Floor Plan Manager\n * Handles floor plan CRUD operations and validation\n */\nclass FloorPlanManager {\n  constructor(state, eventBus, canvasManager) {\n    this.state = state;\n    this.eventBus = eventBus;\n    this.canvasManager = canvasManager;\n  }\n\n  /**\n   * Set active floor plan\n   */\n  setFloorPlan(floorPlanId) {\n    const floorPlan = this._getFloorPlanById(floorPlanId);\n\n    if (!floorPlan) {\n      console.error('Floor plan not found:', floorPlanId);\n      return false;\n    }\n\n    // Validate\n    const validation = Validation.validateFloorPlan(floorPlan);\n    if (!validation.valid) {\n      console.error('Invalid floor plan:', validation.errors);\n      return false;\n    }\n\n    // [FloorPlanManager] Setting floor plan: id\n\n    // Update state\n    this.state.setState({ floorPlan });\n\n    // Reset viewport before drawing new floor plan\n    this.canvasManager.resetViewport();\n\n    // Draw on canvas\n    this.canvasManager.drawFloorPlan(floorPlan);\n\n    // Emit event\n    this.eventBus.emit('floorplan:changed', floorPlan);\n\n    return true;\n  }\n\n  /**\n   * Get current floor plan\n   */\n  getCurrentFloorPlan() {\n    return this.state.get('floorPlan');\n  }\n\n  /**\n   * Get all floor plan templates\n   */\n  getAllFloorPlans() {\n    return Config.FLOOR_PLANS || [];\n  }\n\n  /**\n   * Get floor plan by ID from Config\n   * @private\n   */\n  _getFloorPlanById(id) {\n    const floorPlans = Config.FLOOR_PLANS || [];\n    return floorPlans.find((fp) => fp.id === id);\n  }\n\n  /**\n   * Get floor plan area in square feet\n   */\n  getArea() {\n    const floorPlan = this.getCurrentFloorPlan();\n    if (!floorPlan) return 0;\n    return floorPlan.widthFt * floorPlan.heightFt;\n  }\n\n  /**\n   * Get occupied area (sum of all items)\n   */\n  getOccupiedArea() {\n    const items = this.state.get('items') || [];\n    return items.reduce((total, item) => {\n      return total + item.lengthFt * item.widthFt;\n    }, 0);\n  }\n\n  /**\n   * Get percentage of occupied space\n   */\n  getOccupancyPercentage() {\n    const total = this.getArea();\n    const occupied = this.getOccupiedArea();\n    return total > 0 ? (occupied / total) * 100 : 0;\n  }\n\n  /**\n   * Clear floor plan\n   */\n  clearFloorPlan() {\n    this.state.setState({ floorPlan: null, items: [] });\n    this.canvasManager.clear();\n    this.eventBus.emit('floorplan:cleared');\n  }\n}\n\n// Make available globally\nif (typeof window !== 'undefined') {\n  window.FloorPlanManager = FloorPlanManager;\n}\n","size_bytes":2474},"js/utils/geometry.js":{"content":"/* global Helpers */\n\n/**\n * Geometry Utilities using Turf.js\n * Complex geometric calculations and validations\n */\nconst Geometry = {\n  /**\n   * Convert Fabric.js rectangle to Turf.js polygon\n   */\n  rectToPolygon(rect) {\n    const bounds = rect.getBoundingRect();\n    return {\n      type: 'Polygon',\n      coordinates: [\n        [\n          [bounds.left, bounds.top],\n          [bounds.left + bounds.width, bounds.top],\n          [bounds.left + bounds.width, bounds.top + bounds.height],\n          [bounds.left, bounds.top + bounds.height],\n          [bounds.left, bounds.top], // Close the loop\n        ],\n      ],\n    };\n  },\n\n  /**\n   * Check if point is inside polygon (using Turf.js)\n   */\n  pointInPolygon(point, polygon) {\n    if (typeof turf !== 'undefined') {\n      const turfPoint = turf.point([point.x, point.y]);\n      return turf.booleanPointInPolygon(turfPoint, polygon);\n    }\n    // Fallback without Turf.js\n    return this._pointInPolygonFallback(point, polygon);\n  },\n\n  /**\n   * Calculate polygon area (using Turf.js)\n   */\n  calculateArea(polygon) {\n    if (typeof turf !== 'undefined') {\n      return turf.area(polygon); // Returns square meters\n    }\n    // Fallback: simple rectangle area\n    return 0;\n  },\n\n  /**\n   * Calculate distance between two points (using Turf.js)\n   */\n  distance(point1, point2, units = 'pixels') {\n    if (typeof turf !== 'undefined' && units === 'meters') {\n      const p1 = turf.point([point1.x, point1.y]);\n      const p2 = turf.point([point2.x, point2.y]);\n      return turf.distance(p1, p2, { units: 'meters' });\n    }\n    // Fallback: Euclidean distance\n    return Helpers.distance(point1.x, point1.y, point2.x, point2.y);\n  },\n\n  /**\n   * Validate polygon (check for self-intersections)\n   */\n  validatePolygon(polygon) {\n    if (typeof turf !== 'undefined') {\n      const kinks = turf.kinks(polygon);\n      return {\n        valid: kinks.features.length === 0,\n        intersections: kinks.features,\n      };\n    }\n    return { valid: true, intersections: [] };\n  },\n\n  /**\n   * Simplify polygon\n   */\n  simplifyPolygon(polygon, tolerance = 0.01) {\n    if (typeof turf !== 'undefined') {\n      return turf.simplify(polygon, { tolerance });\n    }\n    return polygon;\n  },\n\n  /**\n   * Calculate bounding box of polygon\n   */\n  getBoundingBox(polygon) {\n    if (typeof turf !== 'undefined') {\n      const bbox = turf.bbox(polygon);\n      return {\n        left: bbox[0],\n        top: bbox[1],\n        right: bbox[2],\n        bottom: bbox[3],\n        width: bbox[2] - bbox[0],\n        height: bbox[3] - bbox[1],\n      };\n    }\n    return null;\n  },\n\n  /**\n   * Point in polygon fallback (ray casting algorithm)\n   * @private\n   */\n  _pointInPolygonFallback(point, polygon) {\n    const coords = polygon.coordinates[0];\n    let inside = false;\n\n    for (let i = 0, j = coords.length - 1; i < coords.length; j = i++) {\n      const xi = coords[i][0],\n        yi = coords[i][1];\n      const xj = coords[j][0],\n        yj = coords[j][1];\n\n      const intersect =\n        yi > point.y !== yj > point.y && point.x < ((xj - xi) * (point.y - yi)) / (yj - yi) + xi;\n\n      if (intersect) inside = !inside;\n    }\n\n    return inside;\n  },\n};\n\n// Make available globally\nif (typeof window !== 'undefined') {\n  window.Geometry = Geometry;\n}\n","size_bytes":3282},"js/ui/Modal.js":{"content":"/**\n * Modal and Toast UI System\n */\nclass Modal {\n  static showConfirm(title, message) {\n    return new Promise((resolve) => {\n      const overlay = document.createElement('div');\n      overlay.className = 'modal-overlay';\n      overlay.style.display = 'flex';\n\n      const modal = document.createElement('div');\n      modal.className = 'modal';\n      modal.innerHTML = `\n        <div class=\"modal-header\">\n          <h3 class=\"modal-title\">${title}</h3>\n        </div>\n        <div class=\"modal-body\">\n          <p>${message}</p>\n        </div>\n        <div class=\"modal-footer\">\n          <button class=\"modal-btn modal-btn-secondary\" data-action=\"cancel\">Cancel</button>\n          <button class=\"modal-btn modal-btn-primary\" data-action=\"confirm\">Confirm</button>\n        </div>\n      `;\n\n      overlay.appendChild(modal);\n      document.body.appendChild(overlay);\n\n      const handleClose = (confirmed) => {\n        document.removeEventListener('keydown', keyHandler);\n        overlay.remove();\n        resolve(confirmed);\n      };\n\n      const keyHandler = (e) => {\n        if (e.key === 'Enter') {\n          e.preventDefault();\n          e.stopPropagation();\n          handleClose(true);\n        } else if (e.key === 'Escape') {\n          e.preventDefault();\n          e.stopPropagation();\n          handleClose(false);\n        }\n      };\n\n      modal.querySelector('[data-action=\"confirm\"]').addEventListener('click', () => {\n        handleClose(true);\n      });\n\n      modal.querySelector('[data-action=\"cancel\"]').addEventListener('click', () => {\n        handleClose(false);\n      });\n\n      overlay.addEventListener('click', (e) => {\n        if (e.target === overlay) handleClose(false);\n      });\n\n      document.addEventListener('keydown', keyHandler);\n    });\n  }\n\n  static showPrompt(title, message, defaultValue = '') {\n    return new Promise((resolve) => {\n      const overlay = document.createElement('div');\n      overlay.className = 'modal-overlay';\n      overlay.style.display = 'flex';\n\n      const modal = document.createElement('div');\n      modal.className = 'modal';\n      modal.innerHTML = `\n        <div class=\"modal-header\">\n          <h3 class=\"modal-title\">${title}</h3>\n        </div>\n        <div class=\"modal-body\">\n          <p>${message}</p>\n          <input type=\"text\" class=\"modal-input\" value=\"${defaultValue}\" autofocus>\n        </div>\n        <div class=\"modal-footer\">\n          <button class=\"modal-btn modal-btn-secondary\" data-action=\"cancel\">Cancel</button>\n          <button class=\"modal-btn modal-btn-primary\" data-action=\"ok\">OK</button>\n        </div>\n      `;\n\n      overlay.appendChild(modal);\n      document.body.appendChild(overlay);\n\n      const input = modal.querySelector('.modal-input');\n      input.focus();\n      input.select();\n\n      const handleClose = (value) => {\n        document.removeEventListener('keydown', keyHandler);\n        overlay.remove();\n        resolve(value);\n      };\n\n      const keyHandler = (e) => {\n        if (e.key === 'Enter') {\n          e.preventDefault();\n          e.stopPropagation();\n          handleClose(input.value || null);\n        } else if (e.key === 'Escape') {\n          e.preventDefault();\n          e.stopPropagation();\n          handleClose(null);\n        }\n      };\n\n      modal.querySelector('[data-action=\"ok\"]').addEventListener('click', () => {\n        handleClose(input.value || null);\n      });\n\n      modal.querySelector('[data-action=\"cancel\"]').addEventListener('click', () => {\n        handleClose(null);\n      });\n\n      overlay.addEventListener('click', (e) => {\n        if (e.target === overlay) handleClose(null);\n      });\n\n      document.addEventListener('keydown', keyHandler);\n    });\n  }\n\n  static show(title, content) {\n    return new Promise((resolve) => {\n      // Guard: Close any existing modal before opening new one\n      if (Modal._currentModal) {\n        console.warn('Modal already open, closing previous modal');\n        Modal.close();\n      }\n\n      const overlay = document.createElement('div');\n      overlay.className = 'modal-overlay';\n      overlay.style.display = 'flex';\n\n      const modal = document.createElement('div');\n      modal.className = 'modal';\n\n      // Create modal structure\n      const header = document.createElement('div');\n      header.className = 'modal-header';\n      header.innerHTML = `<h3 class=\"modal-title\">${title}</h3>`;\n\n      const body = document.createElement('div');\n      body.className = 'modal-body';\n\n      // Append content (can be string or DOM element)\n      if (typeof content === 'string') {\n        body.innerHTML = content;\n      } else {\n        body.appendChild(content);\n      }\n\n      const footer = document.createElement('div');\n      footer.className = 'modal-footer';\n      footer.innerHTML = `\n        <button class=\"modal-btn modal-btn-secondary\" data-action=\"close\">Close</button>\n      `;\n\n      modal.appendChild(header);\n      modal.appendChild(body);\n      modal.appendChild(footer);\n      overlay.appendChild(modal);\n      document.body.appendChild(overlay);\n\n      const handleClose = () => {\n        document.removeEventListener('keydown', keyHandler);\n        overlay.remove();\n        Modal._currentModal = null;\n        resolve(true);\n      };\n\n      const keyHandler = (e) => {\n        if (e.key === 'Escape') {\n          e.preventDefault();\n          e.stopPropagation();\n          handleClose();\n        }\n      };\n\n      // Store reference for Modal.close() - including keyHandler for proper cleanup\n      Modal._currentModal = {\n        overlay,\n        resolve,\n        keyHandler,\n      };\n\n      footer.querySelector('[data-action=\"close\"]').addEventListener('click', handleClose);\n\n      overlay.addEventListener('click', (e) => {\n        if (e.target === overlay) handleClose();\n      });\n\n      document.addEventListener('keydown', keyHandler);\n    });\n  }\n\n  static close() {\n    if (Modal._currentModal) {\n      const { overlay, resolve, keyHandler } = Modal._currentModal;\n\n      // Clean up event listener if keyHandler exists\n      if (keyHandler) {\n        document.removeEventListener('keydown', keyHandler);\n      }\n\n      overlay.remove();\n      Modal._currentModal = null;\n      resolve(true);\n    }\n  }\n\n  static showToast(message, type = 'success', duration = 3000) {\n    let container = document.querySelector('.toast-container');\n    if (!container) {\n      container = document.createElement('div');\n      container.className = 'toast-container';\n      document.body.appendChild(container);\n    }\n\n    const toast = document.createElement('div');\n    toast.className = `toast toast-${type}`;\n    toast.textContent = message;\n\n    container.appendChild(toast);\n\n    setTimeout(() => {\n      toast.style.opacity = '0';\n      setTimeout(() => toast.remove(), 300);\n    }, duration);\n  }\n\n  static showSuccess(message) {\n    this.showToast(message, 'success');\n  }\n\n  static showError(message) {\n    this.showToast(message, 'error');\n  }\n\n  static showInfo(message) {\n    this.showToast(message, 'info');\n  }\n}\n\nif (typeof window !== 'undefined') {\n  window.Modal = Modal;\n}\n","size_bytes":7107},"css/responsive.css":{"content":"/* ================================\n   RESPONSIVE DESIGN\n   Mobile-First Approach\n   Breakpoints: 480px, 767px, 1024px\n   ================================ */\n\n/* ================================\n   DESKTOP (default > 1024px)\n   ================================ */\n\n/* No changes needed - existing layout is optimized for desktop */\n\n/* ================================\n   TABLET LANDSCAPE (1024px - 768px)\n   ================================ */\n@media (width <= 1024px) {\n  /* Sidebar becomes collapsible */\n  .sidebar {\n    transition:\n      transform 0.3s ease,\n      width 0.3s ease;\n  }\n\n  .sidebar.collapsed {\n    width: 0;\n    transform: translateX(-100%);\n    overflow: hidden;\n  }\n\n  /* Hamburger menu button */\n  .mobile-menu-toggle {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    width: 40px;\n    height: 40px;\n    padding: 0;\n    background: transparent;\n    border: none;\n    border-radius: var(--radius-sm);\n    cursor: pointer;\n    transition: background var(--transition-fast);\n  }\n\n  .mobile-menu-toggle:hover {\n    background: var(--color-bg-hover);\n  }\n\n  .mobile-menu-toggle svg {\n    width: 20px;\n    height: 20px;\n    color: var(--color-text);\n  }\n\n  /* Canvas expands when sidebar collapsed */\n  .main-content {\n    transition: padding-left 0.3s ease;\n  }\n\n  /* Compact toolbar */\n  .toolbar {\n    padding: 8px 12px;\n    gap: 8px;\n  }\n\n  .toolbar-group {\n    gap: 6px;\n  }\n\n  /* Touch-friendly button sizes */\n  .btn {\n    min-width: 40px;\n    min-height: 40px;\n    padding: 8px 12px;\n  }\n\n  .btn-icon {\n    min-width: 44px;\n    min-height: 44px;\n  }\n\n  /* Dropdown menus touch-optimized */\n  .dropdown-item {\n    padding: 12px 16px;\n    min-height: 44px;\n  }\n}\n\n/* ================================\n   TABLET PORTRAIT (767px - 481px)\n   ================================ */\n@media (width <= 767px) {\n  /* Header compact */\n  .header {\n    height: 56px;\n    padding: 8px 12px;\n    gap: 12px;\n  }\n\n  .project-name-container {\n    flex: 1;\n    max-width: none;\n  }\n\n  #project-name {\n    font-size: 15px;\n  }\n\n  #btn-rename-project {\n    width: 32px;\n    height: 32px;\n  }\n\n  /* Sidebar becomes full-screen drawer */\n  .sidebar {\n    position: fixed;\n    top: 0;\n    left: 0;\n    bottom: 0;\n    width: 100%;\n    max-width: 320px;\n    height: 100vh;\n    z-index: 999;\n    background: var(--color-bg-panel);\n    border-right: 1px solid var(--color-border);\n    box-shadow: var(--shadow-floating);\n    transform: translateX(-100%);\n    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  }\n\n  .sidebar.active {\n    transform: translateX(0);\n  }\n\n  /* Sidebar backdrop */\n  .sidebar-backdrop {\n    display: none;\n    position: fixed;\n    inset: 0;\n    background: rgb(0 0 0 / 50%);\n    backdrop-filter: blur(4px);\n    z-index: 998;\n    opacity: 0;\n    transition: opacity 0.3s ease;\n  }\n\n  .sidebar-backdrop.active {\n    display: block;\n    opacity: 1;\n  }\n\n  /* Sidebar close button */\n  .sidebar-close {\n    position: absolute;\n    top: 12px;\n    right: 12px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 36px;\n    height: 36px;\n    background: transparent;\n    border: none;\n    border-radius: var(--radius-sm);\n    cursor: pointer;\n    z-index: 10;\n    transition: background var(--transition-fast);\n  }\n\n  .sidebar-close:hover {\n    background: var(--color-bg-hover);\n  }\n\n  .sidebar-close svg {\n    width: 20px;\n    height: 20px;\n    color: var(--color-text);\n  }\n\n  /* Toolbar simplified */\n  .toolbar {\n    padding: 6px 8px;\n    gap: 6px;\n    overflow-x: auto;\n    -webkit-overflow-scrolling: touch;\n    scrollbar-width: none;\n  }\n\n  .toolbar::-webkit-scrollbar {\n    display: none;\n  }\n\n  /* Hide non-essential toolbar items */\n  .toolbar-group:not(:first-child, :last-child) {\n    display: none;\n  }\n\n  /* Canvas full height */\n  .canvas-container {\n    flex: 1;\n  }\n\n  /* Info bar bottom fixed, compact */\n  .info-bar {\n    position: fixed;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    height: 40px;\n    padding: 8px 12px;\n    background: var(--color-bg-panel);\n    border-top: 1px solid var(--color-border);\n    z-index: 10;\n    overflow-x: auto;\n    -webkit-overflow-scrolling: touch;\n    scrollbar-width: none;\n  }\n\n  .info-bar::-webkit-scrollbar {\n    display: none;\n  }\n\n  .info-bar__divider {\n    margin: 0 8px;\n  }\n\n  /* Item palette 2-column grid */\n  .items-grid {\n    grid-template-columns: repeat(2, 1fr);\n    gap: 10px;\n  }\n\n  .item-card {\n    padding: 12px;\n    min-height: 80px;\n  }\n\n  /* Floor plan cards touch-friendly */\n  .floor-plan-card {\n    padding: 14px;\n    min-height: 100px;\n  }\n}\n\n/* Tablet: Canvas padding for fixed info bar */\n@media (width <= 767px) and (width >= 481px) {\n  .canvas-container {\n    padding-bottom: calc(40px + env(safe-area-inset-bottom, 0px));\n  }\n}\n\n/* ================================\n   MOBILE (< 480px)\n   ================================ */\n@media (width <= 480px) {\n  /* Ultra-compact header */\n  .header {\n    height: 48px;\n    padding: 6px 10px;\n    gap: 8px;\n  }\n\n  #project-name {\n    font-size: 14px;\n    max-width: 140px;\n  }\n\n  /* Hide desktop toolbar completely */\n  .toolbar {\n    display: none;\n  }\n\n  /* Mobile bottom toolbar */\n  .mobile-toolbar {\n    display: flex;\n    position: fixed;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    height: 56px;\n    background: var(--color-bg-panel);\n    border-top: 1px solid var(--color-border);\n    box-shadow: 0 -2px 8px rgb(0 0 0 / 10%);\n    z-index: 100;\n    padding: 6px 12px;\n    padding-bottom: calc(6px + env(safe-area-inset-bottom, 0px));\n    gap: 8px;\n    align-items: center;\n    justify-content: space-around;\n  }\n\n  .mobile-toolbar .btn {\n    flex: 1;\n    max-width: 60px;\n    min-height: 44px;\n    padding: 6px 2px;\n    flex-direction: column;\n    gap: 2px;\n    font-size: 9px;\n    font-weight: 500;\n  }\n\n  .mobile-toolbar .btn svg {\n    width: 20px;\n    height: 20px;\n  }\n\n  .mobile-toolbar .btn-primary {\n    flex: 1.2;\n  }\n\n  /* Canvas adjusted for bottom toolbar */\n  .canvas-container {\n    padding-bottom: calc(56px + env(safe-area-inset-bottom, 0px));\n  }\n\n  /* Sidebar full width on mobile */\n  .sidebar {\n    max-width: 100%;\n    width: 100%;\n  }\n\n  /* Item palette single column for smallest screens */\n  .items-grid {\n    grid-template-columns: 1fr;\n  }\n\n  /* Info bar hidden on mobile (toolbar shows essential info) */\n  .info-bar {\n    display: none;\n  }\n\n  /* Compact sidebar tabs */\n  .sidebar-tabs {\n    gap: 4px;\n    padding: 8px;\n  }\n\n  .sidebar-tab {\n    padding: 10px 14px;\n    font-size: 13px;\n    min-height: 44px;\n  }\n\n  /* Dropdown menus full-width on mobile */\n  .dropdown-menu {\n    left: 0;\n    right: 0;\n    min-width: 100%;\n    max-width: 100%;\n    border-radius: 0;\n  }\n}\n\n/* ================================\n   LANDSCAPE ORIENTATION\n   ================================ */\n@media (height <= 500px) and (orientation: landscape) {\n  .header {\n    height: 44px;\n    padding: 6px 10px;\n  }\n\n  .mobile-toolbar {\n    height: 48px;\n    padding: 4px 10px;\n  }\n\n  .mobile-toolbar .btn {\n    min-height: 40px;\n    font-size: 9px;\n  }\n\n  .sidebar {\n    max-width: 280px;\n  }\n\n  .canvas-container {\n    padding-bottom: 48px;\n  }\n}\n\n/* ================================\n   TOUCH OPTIMIZATIONS\n   ================================ */\n@media (hover: none) and (pointer: coarse) {\n  /* All touch targets minimum 44x44px */\n  button,\n  .btn,\n  .dropdown-item,\n  .sidebar-tab,\n  .floor-plan-card,\n  .item-card {\n    min-width: 44px;\n    min-height: 44px;\n  }\n\n  /* Remove hover states on touch devices */\n  .btn:hover,\n  .dropdown-item:hover,\n  .sidebar-tab:hover {\n    background: transparent;\n  }\n\n  /* Active states for touch feedback */\n  .btn:active {\n    transform: scale(0.97);\n  }\n\n  /* Smooth scrolling */\n  * {\n    -webkit-overflow-scrolling: touch;\n  }\n\n  /* Prevent text selection during touch interactions */\n  .canvas-container,\n  .toolbar,\n  .mobile-toolbar {\n    user-select: none;\n    -webkit-touch-callout: none;\n  }\n}\n\n/* ================================\n   PERFORMANCE OPTIMIZATIONS\n   ================================ */\n\n/* Use GPU acceleration for smooth animations */\n.sidebar,\n.sidebar-backdrop,\n.mobile-toolbar,\n.dropdown-menu {\n  will-change: transform, opacity;\n  backface-visibility: hidden;\n}\n\n/* Reduce motion for accessibility */\n@media (prefers-reduced-motion: reduce) {\n  *,\n  *::before,\n  *::after {\n    animation-duration: 0.01ms !important;\n    animation-iteration-count: 1 !important;\n    transition-duration: 0.01ms !important;\n  }\n}\n\n/* ================================\n   MOBILE DRAWER SCROLL LOCK\n   ================================ */\n\n/* Prevent body scroll when mobile sidebar is open */\nbody.drawer-open {\n  overflow: hidden;\n}\n","size_bytes":8712},"css/components/cards.css":{"content":"/**\n * Card Component System\n * Modern card variants for content organization\n */\n\n/* === BASE CARD === */\n\n.card-v3 {\n  background-color: var(--color-surface-elevated);\n  border: 1px solid var(--color-border);\n  border-radius: var(--radius-xl);\n  overflow: hidden;\n  transition: all var(--transition-base);\n}\n\n/* === CARD HOVER STATES === */\n\n.card-v3-interactive {\n  cursor: pointer;\n  user-select: none;\n}\n\n.card-v3-interactive:hover {\n  border-color: var(--color-primary-300);\n  box-shadow: var(--shadow-md);\n  transform: translateY(-2px);\n}\n\n.card-v3-interactive:active {\n  transform: translateY(0);\n  box-shadow: var(--shadow-sm);\n}\n\n/* === CARD VARIANTS === */\n\n.card-v3-elevated {\n  border: none;\n  box-shadow: var(--shadow-md);\n}\n\n.card-v3-outlined {\n  background-color: transparent;\n  border: 2px solid var(--color-border);\n}\n\n.card-v3-filled {\n  background-color: var(--color-gray-50);\n  border: none;\n}\n\n/* === CARD STATES === */\n\n.card-v3-selected {\n  border-color: var(--color-primary-500);\n  box-shadow: 0 0 0 3px var(--color-primary-100);\n  background-color: var(--color-primary-50);\n}\n\n.card-v3-disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n  pointer-events: none;\n}\n\n/* === CARD HEADER === */\n\n.card-v3-header {\n  padding: var(--spacing-4);\n  border-bottom: 1px solid var(--color-border);\n}\n\n.card-v3-title {\n  font-size: var(--font-size-lg);\n  font-weight: var(--font-weight-semibold);\n  color: var(--color-text-primary);\n  margin: 0;\n}\n\n.card-v3-subtitle {\n  font-size: var(--font-size-sm);\n  color: var(--color-text-secondary);\n  margin: var(--spacing-1) 0 0 0;\n}\n\n/* === CARD BODY === */\n\n.card-v3-body {\n  padding: var(--spacing-4);\n}\n\n/* === CARD FOOTER === */\n\n.card-v3-footer {\n  padding: var(--spacing-4);\n  border-top: 1px solid var(--color-border);\n  background-color: var(--color-surface);\n}\n\n/* === CARD MEDIA === */\n\n.card-v3-media {\n  width: 100%;\n  height: auto;\n  display: block;\n}\n\n.card-v3-media-container {\n  position: relative;\n  overflow: hidden;\n  background-color: var(--color-gray-100);\n}\n\n/* === COMPACT CARD (for mobile lists) === */\n\n.card-v3-compact {\n  padding: var(--spacing-3);\n}\n\n.card-v3-compact .card-v3-title {\n  font-size: var(--font-size-base);\n}\n\n.card-v3-compact .card-v3-subtitle {\n  font-size: var(--font-size-xs);\n}\n\n/* === CARD WITH ICON === */\n\n.card-v3-icon-wrapper {\n  width: 48px;\n  height: 48px;\n  border-radius: var(--radius-lg);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background-color: var(--color-primary-100);\n  color: var(--color-primary-600);\n  margin-bottom: var(--spacing-3);\n}\n\n.card-v3-icon-wrapper svg {\n  width: 24px;\n  height: 24px;\n}\n","size_bytes":2649},"css/design-system.css":{"content":"/**\n * Garage Layout Planner - Design System\n * Modern, professional design tokens for unified desktop/mobile experience\n * Version: 3.0.0\n */\n\n:root {\n  /* === COLOR PALETTE === */\n\n  /* Primary Brand Colors - Modern Blue-Indigo */\n  --color-primary-50: #eef2ff;\n  --color-primary-100: #e0e7ff;\n  --color-primary-200: #c7d2fe;\n  --color-primary-300: #a5b4fc;\n  --color-primary-400: #818cf8;\n  --color-primary-500: #6366f1;\n  --color-primary-600: #4f46e5;\n  --color-primary-700: #4338ca;\n  --color-primary-800: #3730a3;\n  --color-primary-900: #312e81;\n\n  /* Accent Colors - Vibrant Purple */\n  --color-accent-50: #faf5ff;\n  --color-accent-100: #f3e8ff;\n  --color-accent-200: #e9d5ff;\n  --color-accent-300: #d8b4fe;\n  --color-accent-400: #c084fc;\n  --color-accent-500: #a855f7;\n  --color-accent-600: #9333ea;\n  --color-accent-700: #7e22ce;\n  --color-accent-800: #6b21a8;\n  --color-accent-900: #581c87;\n\n  /* Success/Warning/Error */\n  --color-success-50: #f0fdf4;\n  --color-success-500: #22c55e;\n  --color-success-600: #16a34a;\n  --color-success-700: #15803d;\n  --color-warning-50: #fffbeb;\n  --color-warning-500: #f59e0b;\n  --color-warning-600: #d97706;\n  --color-warning-700: #b45309;\n  --color-error-50: #fef2f2;\n  --color-error-500: #ef4444;\n  --color-error-600: #dc2626;\n  --color-error-700: #b91c1c;\n\n  /* Neutral Grays - Modern, soft */\n  --color-gray-50: #f9fafb;\n  --color-gray-100: #f3f4f6;\n  --color-gray-200: #e5e7eb;\n  --color-gray-300: #d1d5db;\n  --color-gray-400: #9ca3af;\n  --color-gray-500: #6b7280;\n  --color-gray-600: #4b5563;\n  --color-gray-700: #374151;\n  --color-gray-800: #1f2937;\n  --color-gray-900: #111827;\n\n  /* Semantic Colors (Light Mode) */\n  --color-background: #fff;\n  --color-surface: var(--color-gray-50);\n  --color-surface-elevated: #fff;\n  --color-border: var(--color-gray-200);\n  --color-border-hover: var(--color-gray-300);\n  --color-text-primary: var(--color-gray-900);\n  --color-text-secondary: var(--color-gray-600);\n  --color-text-tertiary: var(--color-gray-500);\n  --color-text-inverse: #fff;\n\n  /* Interactive States */\n  --color-interactive: var(--color-primary-600);\n  --color-interactive-hover: var(--color-primary-700);\n  --color-interactive-pressed: var(--color-primary-800);\n  --color-interactive-disabled: var(--color-gray-300);\n\n  /* === TYPOGRAPHY === */\n\n  /* Font Families */\n  --font-family-sans:\n    -apple-system, blinkmacsystemfont, 'Segoe UI', roboto, 'Helvetica Neue', arial, sans-serif;\n  --font-family-mono: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Code', 'Courier New', monospace;\n\n  /* Font Sizes */\n  --font-size-xs: 0.75rem; /* 12px */\n  --font-size-sm: 0.875rem; /* 14px */\n  --font-size-base: 1rem; /* 16px */\n  --font-size-lg: 1.125rem; /* 18px */\n  --font-size-xl: 1.25rem; /* 20px */\n  --font-size-2xl: 1.5rem; /* 24px */\n  --font-size-3xl: 1.875rem; /* 30px */\n  --font-size-4xl: 2.25rem; /* 36px */\n\n  /* Font Weights */\n  --font-weight-normal: 400;\n  --font-weight-medium: 500;\n  --font-weight-semibold: 600;\n  --font-weight-bold: 700;\n\n  /* Line Heights */\n  --line-height-tight: 1.25;\n  --line-height-normal: 1.5;\n  --line-height-relaxed: 1.75;\n\n  /* === SPACING === */\n\n  --spacing-1: 0.25rem; /* 4px */\n  --spacing-2: 0.5rem; /* 8px */\n  --spacing-3: 0.75rem; /* 12px */\n  --spacing-4: 1rem; /* 16px */\n  --spacing-5: 1.25rem; /* 20px */\n  --spacing-6: 1.5rem; /* 24px */\n  --spacing-8: 2rem; /* 32px */\n  --spacing-10: 2.5rem; /* 40px */\n  --spacing-12: 3rem; /* 48px */\n  --spacing-16: 4rem; /* 64px */\n\n  /* === BORDER RADIUS === */\n\n  --radius-none: 0;\n  --radius-sm: 0.375rem; /* 6px */\n  --radius-md: 0.5rem; /* 8px */\n  --radius-lg: 0.75rem; /* 12px */\n  --radius-xl: 1rem; /* 16px */\n  --radius-2xl: 1.5rem; /* 24px */\n  --radius-full: 9999px;\n\n  /* === SHADOWS === */\n\n  --shadow-xs: 0 1px 2px 0 rgb(0 0 0 / 5%);\n  --shadow-sm: 0 1px 3px 0 rgb(0 0 0 / 10%), 0 1px 2px -1px rgb(0 0 0 / 10%);\n  --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 10%), 0 2px 4px -2px rgb(0 0 0 / 10%);\n  --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 10%), 0 4px 6px -4px rgb(0 0 0 / 10%);\n  --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 10%), 0 8px 10px -6px rgb(0 0 0 / 10%);\n  --shadow-2xl: 0 25px 50px -12px rgb(0 0 0 / 25%);\n\n  /* === Z-INDEX === */\n\n  --z-base: 0;\n  --z-dropdown: 1000;\n  --z-sticky: 1100;\n  --z-overlay: 1200;\n  --z-modal: 1300;\n  --z-popover: 1400;\n  --z-toast: 1500;\n\n  /* === TRANSITIONS === */\n\n  --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);\n  --transition-base: 200ms cubic-bezier(0.4, 0, 0.2, 1);\n  --transition-slow: 300ms cubic-bezier(0.4, 0, 0.2, 1);\n  --transition-spring: 400ms cubic-bezier(0.34, 1.56, 0.64, 1);\n\n  /* === MOBILE-SPECIFIC === */\n\n  --mobile-header-height: 56px;\n  --mobile-tab-bar-height: 64px;\n  --mobile-fab-size: 56px;\n  --mobile-touch-target: 48px;\n  --mobile-safe-area-bottom: env(safe-area-inset-bottom, 0px);\n\n  /* === BREAKPOINTS (for JS usage) === */\n\n  --breakpoint-mobile: 480px;\n  --breakpoint-tablet: 768px;\n  --breakpoint-desktop: 1024px;\n  --breakpoint-wide: 1280px;\n}\n\n/* === DARK MODE SUPPORT === */\n\n@media (prefers-color-scheme: dark) {\n  :root {\n    /* Semantic Colors (Dark Mode) */\n    --color-background: var(--color-gray-900);\n    --color-surface: var(--color-gray-800);\n    --color-surface-elevated: var(--color-gray-700);\n    --color-border: var(--color-gray-700);\n    --color-border-hover: var(--color-gray-600);\n    --color-text-primary: var(--color-gray-50);\n    --color-text-secondary: var(--color-gray-300);\n    --color-text-tertiary: var(--color-gray-400);\n    --color-text-inverse: var(--color-gray-900);\n\n    /* Adjust shadows for dark mode */\n    --shadow-xs: 0 1px 2px 0 rgb(0 0 0 / 30%);\n    --shadow-sm: 0 1px 3px 0 rgb(0 0 0 / 40%), 0 1px 2px -1px rgb(0 0 0 / 40%);\n    --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 40%), 0 2px 4px -2px rgb(0 0 0 / 40%);\n    --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 40%), 0 4px 6px -4px rgb(0 0 0 / 40%);\n    --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 40%), 0 8px 10px -6px rgb(0 0 0 / 40%);\n    --shadow-2xl: 0 25px 50px -12px rgb(0 0 0 / 60%);\n  }\n}\n\n/* === UTILITY CLASSES === */\n\n.text-primary {\n  color: var(--color-text-primary);\n}\n\n.text-secondary {\n  color: var(--color-text-secondary);\n}\n\n.text-tertiary {\n  color: var(--color-text-tertiary);\n}\n\n.bg-surface {\n  background-color: var(--color-surface);\n}\n\n.bg-elevated {\n  background-color: var(--color-surface-elevated);\n}\n\n.shadow-sm {\n  box-shadow: var(--shadow-sm);\n}\n\n.shadow-md {\n  box-shadow: var(--shadow-md);\n}\n\n.shadow-lg {\n  box-shadow: var(--shadow-lg);\n}\n\n.rounded-sm {\n  border-radius: var(--radius-sm);\n}\n\n.rounded-md {\n  border-radius: var(--radius-md);\n}\n\n.rounded-lg {\n  border-radius: var(--radius-lg);\n}\n\n.rounded-xl {\n  border-radius: var(--radius-xl);\n}\n\n.rounded-full {\n  border-radius: var(--radius-full);\n}\n\n.transition-fast {\n  transition: all var(--transition-fast);\n}\n\n.transition-base {\n  transition: all var(--transition-base);\n}\n\n.transition-slow {\n  transition: all var(--transition-slow);\n}\n","size_bytes":6960},"css/components/buttons.css":{"content":"/**\n * Button Component System\n * Modern, touch-optimized button variants\n */\n\n/* === BASE BUTTON === */\n\n.btn-v3 {\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  gap: var(--spacing-2);\n  padding: var(--spacing-3) var(--spacing-4);\n  min-height: var(--mobile-touch-target);\n  font-family: var(--font-family-sans);\n  font-size: var(--font-size-base);\n  font-weight: var(--font-weight-medium);\n  line-height: var(--line-height-tight);\n  border: none;\n  border-radius: var(--radius-lg);\n  cursor: pointer;\n  user-select: none;\n  white-space: nowrap;\n  transition: all var(--transition-base);\n\n  /* Prevent text selection on double-tap */\n  -webkit-tap-highlight-color: transparent;\n}\n\n.btn-v3:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n  pointer-events: none;\n}\n\n.btn-v3:focus-visible {\n  outline: 2px solid var(--color-primary-500);\n  outline-offset: 2px;\n}\n\n/* === PRIMARY BUTTON === */\n\n.btn-v3-primary {\n  background: linear-gradient(135deg, var(--color-primary-600), var(--color-primary-500));\n  color: var(--color-text-inverse);\n  box-shadow: var(--shadow-sm);\n}\n\n.btn-v3-primary:hover {\n  background: linear-gradient(135deg, var(--color-primary-700), var(--color-primary-600));\n  box-shadow: var(--shadow-md);\n  transform: translateY(-1px);\n}\n\n.btn-v3-primary:active {\n  background: var(--color-primary-800);\n  transform: translateY(0);\n  box-shadow: var(--shadow-xs);\n}\n\n/* === SECONDARY BUTTON === */\n\n.btn-v3-secondary {\n  background-color: var(--color-surface);\n  color: var(--color-text-primary);\n  border: 1.5px solid var(--color-border);\n  box-shadow: var(--shadow-xs);\n}\n\n.btn-v3-secondary:hover {\n  background-color: var(--color-surface-elevated);\n  border-color: var(--color-border-hover);\n  box-shadow: var(--shadow-sm);\n}\n\n.btn-v3-secondary:active {\n  background-color: var(--color-gray-100);\n  transform: scale(0.98);\n}\n\n/* === GHOST BUTTON === */\n\n.btn-v3-ghost {\n  background-color: transparent;\n  color: var(--color-text-secondary);\n}\n\n.btn-v3-ghost:hover {\n  background-color: var(--color-gray-100);\n  color: var(--color-text-primary);\n}\n\n.btn-v3-ghost:active {\n  background-color: var(--color-gray-200);\n}\n\n/* === ICON BUTTON === */\n\n.btn-v3-icon {\n  padding: var(--spacing-3);\n  min-width: var(--mobile-touch-target);\n  min-height: var(--mobile-touch-target);\n}\n\n.btn-v3-icon svg {\n  width: 24px;\n  height: 24px;\n}\n\n/* === ACCENT BUTTON === */\n\n.btn-v3-accent {\n  background: linear-gradient(135deg, var(--color-accent-600), var(--color-accent-500));\n  color: var(--color-text-inverse);\n  box-shadow: var(--shadow-sm);\n}\n\n.btn-v3-accent:hover {\n  background: linear-gradient(135deg, var(--color-accent-700), var(--color-accent-600));\n  box-shadow: var(--shadow-md);\n  transform: translateY(-1px);\n}\n\n.btn-v3-accent:active {\n  background: var(--color-accent-800);\n  transform: translateY(0);\n}\n\n/* === DANGER BUTTON === */\n\n.btn-v3-danger {\n  background-color: var(--color-error-500);\n  color: var(--color-text-inverse);\n  box-shadow: var(--shadow-sm);\n}\n\n.btn-v3-danger:hover {\n  background-color: var(--color-error-600);\n  box-shadow: var(--shadow-md);\n}\n\n.btn-v3-danger:active {\n  background-color: var(--color-error-700);\n}\n\n/* === SIZE VARIANTS === */\n\n.btn-v3-sm {\n  padding: var(--spacing-2) var(--spacing-3);\n  font-size: var(--font-size-sm);\n  min-height: 36px;\n}\n\n.btn-v3-lg {\n  padding: var(--spacing-4) var(--spacing-6);\n  font-size: var(--font-size-lg);\n  min-height: 56px;\n}\n\n/* === FULL WIDTH === */\n\n.btn-v3-block {\n  width: 100%;\n}\n\n/* === LOADING STATE === */\n\n.btn-v3-loading {\n  position: relative;\n  color: transparent;\n  pointer-events: none;\n}\n\n.btn-v3-loading::after {\n  content: '';\n  position: absolute;\n  width: 16px;\n  height: 16px;\n  top: 50%;\n  left: 50%;\n  margin-left: -8px;\n  margin-top: -8px;\n  border: 2px solid currentcolor;\n  border-radius: 50%;\n  border-top-color: transparent;\n  animation: btn-spin 0.6s linear infinite;\n}\n\n@keyframes btn-spin {\n  to {\n    transform: rotate(360deg);\n  }\n}\n","size_bytes":3987},"css/mobile-redesign.css":{"content":"/**\n * Storage Caves - Professional Mobile UI\n * Clean, minimal, enterprise-grade mobile interface\n * Inspired by Notion, Canva, GitHub\n */\n\n/* ===== MOBILE LAYOUT ACTIVATION ===== */\n\n@media (width <= 767px) {\n  /* Hide desktop UI elements on mobile */\n  .mobile-layout .mobile-hide-desktop {\n    display: none !important;\n  }\n\n  /* Ensure canvas wrapper is hidden by default on mobile */\n  .mobile-layout .canvas-wrapper {\n    display: none;\n  }\n\n  /* Show canvas when canvas tab is active */\n  .mobile-layout .canvas-wrapper.mobile-show-canvas {\n    display: block;\n    position: fixed;\n    inset: 0 0 calc(var(--mobile-tab-height) + var(--mobile-safe-area-bottom));\n    z-index: 1;\n  }\n\n  /* Mobile content area */\n  .mobile-layout .mobile-content {\n    display: none;\n    position: fixed;\n    inset: 0 0 calc(var(--mobile-tab-height) + var(--mobile-safe-area-bottom));\n    background: var(--color-bg);\n    overflow-y: auto;\n    -webkit-overflow-scrolling: touch;\n  }\n\n  .mobile-layout .mobile-content.mobile-show-content {\n    display: block;\n  }\n}\n\n/* ===== MOBILE UI CONTAINER ===== */\n\n.mobile-ui-container {\n  position: fixed;\n  inset: 0;\n  z-index: var(--z-base);\n  pointer-events: none;\n}\n\n.mobile-ui-container * {\n  pointer-events: auto;\n}\n\n/* ===== MOBILE VIEWS ===== */\n\n.mobile-view {\n  display: none;\n  padding: var(--spacing-lg);\n  padding-bottom: var(--spacing-4xl);\n}\n\n.mobile-view.mobile-view-active {\n  display: block;\n}\n\n.mobile-view-header {\n  margin-bottom: var(--spacing-2xl);\n}\n\n.mobile-view-header h2 {\n  font-size: var(--font-size-3xl);\n  font-weight: var(--font-weight-bold);\n  color: var(--color-text-primary);\n  margin: 0 0 var(--spacing-sm) 0;\n}\n\n.mobile-view-header p {\n  font-size: var(--font-size-base);\n  color: var(--color-text-secondary);\n  margin: 0;\n}\n\n/* ===== BOTTOM TAB BAR ===== */\n\n.mobile-tab-bar {\n  position: fixed;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  height: calc(var(--mobile-tab-height) + var(--mobile-safe-area-bottom));\n  background: var(--color-bg-elevated);\n  border-top: 1px solid var(--color-border);\n  display: flex;\n  align-items: flex-start;\n  justify-content: space-around;\n  padding: 0 0 var(--mobile-safe-area-bottom) 0;\n  z-index: var(--z-toolbar);\n  box-shadow: 0 -2px 8px rgb(0 0 0 / 4%);\n}\n\n.mobile-tab {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  gap: var(--spacing-xs);\n  min-height: var(--mobile-touch-target);\n  padding: var(--spacing-sm) var(--spacing-xs);\n  background: none;\n  border: none;\n  color: var(--color-text-tertiary);\n  font-size: var(--font-size-xs);\n  font-weight: var(--font-weight-medium);\n  cursor: pointer;\n  transition: color var(--transition-fast);\n  position: relative;\n}\n\n.mobile-tab::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: 50%;\n  transform: translateX(-50%);\n  width: 32px;\n  height: 2px;\n  background: var(--color-primary);\n  border-radius: 0 0 2px 2px;\n  opacity: 0;\n  transition: opacity var(--transition-fast);\n}\n\n.mobile-tab.mobile-tab-active {\n  color: var(--color-primary);\n}\n\n.mobile-tab.mobile-tab-active::before {\n  opacity: 1;\n}\n\n.mobile-tab-icon {\n  width: 24px;\n  height: 24px;\n}\n\n.mobile-tab span {\n  line-height: 1;\n}\n\n/* ===== MOBILE FAB CANVAS CONTROLS ===== */\n\n.mobile-fab {\n  position: fixed;\n  right: var(--spacing-lg);\n  bottom: calc(var(--mobile-tab-height) + var(--mobile-safe-area-bottom) + var(--spacing-lg));\n  width: 56px;\n  height: 56px;\n  border-radius: 50%;\n  border: none;\n  background: #e74c3c;\n  color: white;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  box-shadow: 0 8px 16px rgb(231 76 60 / 25%);\n  cursor: pointer;\n  z-index: calc(var(--z-toolbar) + 2);\n  transition:\n    transform 0.2s ease,\n    box-shadow 0.2s ease;\n}\n\n.mobile-fab svg {\n  width: 24px;\n  height: 24px;\n}\n\n.mobile-fab:active {\n  transform: scale(0.94);\n  box-shadow: 0 8px 18px rgb(231 76 60 / 35%);\n}\n\n.mobile-action-panel {\n  position: fixed;\n  left: var(--spacing-lg);\n  right: var(--spacing-lg);\n  bottom: calc(var(--mobile-safe-area-bottom) * -1);\n  background: var(--color-bg-elevated, #fff);\n  border-radius: var(--radius-2xl) var(--radius-2xl) 0 0;\n  box-shadow: 0 -18px 32px rgb(15 23 42 / 12%);\n  transform: translateY(110%);\n  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  z-index: calc(var(--z-toolbar) + 1);\n  padding: var(--spacing-xl) var(--spacing-lg)\n    calc(var(--spacing-xl) + var(--mobile-safe-area-bottom)) var(--spacing-lg);\n}\n\n.mobile-action-panel-open {\n  transform: translateY(0);\n}\n\n.mobile-action-panel-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  margin-bottom: var(--spacing-lg);\n}\n\n.mobile-action-panel-header span {\n  font-size: var(--font-size-lg);\n  font-weight: var(--font-weight-semibold);\n  color: var(--color-text-primary);\n}\n\n.mobile-action-close {\n  background: none;\n  border: none;\n  padding: var(--spacing-xs);\n  border-radius: var(--radius-md);\n  cursor: pointer;\n  color: var(--color-text-tertiary);\n  transition: background var(--transition-fast);\n}\n\n.mobile-action-close svg {\n  width: 20px;\n  height: 20px;\n}\n\n.mobile-action-close:active {\n  background: var(--color-bg-secondary);\n}\n\n.mobile-action-panel-grid {\n  display: grid;\n  grid-template-columns: repeat(2, minmax(0, 1fr));\n  gap: var(--spacing-md);\n}\n\n.mobile-action-btn {\n  background: var(--color-bg-secondary);\n  border: 1px solid transparent;\n  border-radius: var(--radius-lg);\n  padding: var(--spacing-lg);\n  text-align: center;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: var(--spacing-sm);\n  color: var(--color-text-secondary);\n  font-size: var(--font-size-sm);\n  font-weight: var(--font-weight-medium);\n  cursor: pointer;\n  transition: all var(--transition-fast);\n}\n\n.mobile-action-btn svg {\n  width: 24px;\n  height: 24px;\n}\n\n.mobile-action-btn span {\n  line-height: 1.1;\n}\n\n.mobile-action-btn:active {\n  background: var(--color-bg-elevated);\n  border-color: var(--color-border);\n  transform: scale(0.97);\n}\n\n.mobile-action-danger {\n  background: rgb(231 76 60 / 8%);\n  color: #e74c3c;\n}\n\n.mobile-action-danger:active {\n  background: rgb(231 76 60 / 16%);\n  border-color: rgb(231 76 60 / 35%);\n}\n\n@media (width >= 480px) {\n  .mobile-action-panel-grid {\n    grid-template-columns: repeat(3, minmax(0, 1fr));\n  }\n}\n\n/* ===== FLOOR PLANS LIST ===== */\n\n.mobile-floor-plan-list {\n  display: flex;\n  flex-direction: column;\n  gap: var(--spacing-md);\n}\n\n.mobile-floor-plan-card {\n  background: var(--color-bg-elevated);\n  border: 1px solid var(--color-border);\n  border-radius: var(--radius-lg);\n  padding: var(--spacing-xl);\n  text-align: center;\n  cursor: pointer;\n  transition: all var(--transition-fast);\n  position: relative;\n}\n\n.mobile-floor-plan-card:active {\n  transform: scale(0.98);\n  background: var(--color-bg-secondary);\n}\n\n.mobile-floor-plan-card.mobile-card-selected {\n  border-color: var(--color-primary);\n  background: var(--color-primary-light);\n}\n\n.mobile-floor-plan-card.mobile-card-selected::after {\n  content: 'Selected';\n  position: absolute;\n  top: var(--spacing-md);\n  right: var(--spacing-md);\n  padding: var(--spacing-xs) var(--spacing-md);\n  background: var(--color-primary);\n  color: white;\n  font-size: var(--font-size-xs);\n  font-weight: var(--font-weight-semibold);\n  border-radius: var(--radius-full);\n}\n\n.mobile-card-icon {\n  width: 48px;\n  height: 48px;\n  margin: 0 auto var(--spacing-lg) auto;\n  background: var(--color-graphite-100);\n  border-radius: var(--radius-md);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: var(--color-text-secondary);\n}\n\n.mobile-card-icon svg {\n  width: 24px;\n  height: 24px;\n}\n\n.mobile-floor-plan-card h3 {\n  font-size: var(--font-size-lg);\n  font-weight: var(--font-weight-semibold);\n  color: var(--color-text-primary);\n  margin: 0 0 var(--spacing-sm) 0;\n}\n\n.mobile-card-meta {\n  display: flex;\n  flex-direction: column;\n  gap: var(--spacing-xs);\n  justify-content: center;\n  font-size: var(--font-size-sm);\n  color: var(--color-text-secondary);\n  align-items: center;\n}\n\n/* ===== ITEMS LIST ===== */\n\n.mobile-item-list {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: var(--spacing-md);\n}\n\n.mobile-item-card {\n  background: var(--color-bg-elevated);\n  border: 1px solid var(--color-border);\n  border-radius: var(--radius-lg);\n  padding: var(--spacing-lg);\n  text-align: center;\n  cursor: pointer;\n  transition: all var(--transition-fast);\n  display: flex;\n  flex-direction: column;\n  gap: var(--spacing-sm);\n}\n\n.mobile-item-card:active {\n  transform: scale(0.95);\n  background: var(--color-bg-secondary);\n}\n\n.mobile-card-image {\n  width: 100%;\n  height: 80px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: var(--color-graphite-50);\n  border-radius: var(--radius-md);\n  overflow: hidden;\n  margin-bottom: var(--spacing-sm);\n}\n\n.mobile-card-image img {\n  max-width: 100%;\n  max-height: 100%;\n  object-fit: contain;\n}\n\n.mobile-item-card h4 {\n  font-size: var(--font-size-sm);\n  font-weight: var(--font-weight-medium);\n  color: var(--color-text-primary);\n  margin: 0;\n  line-height: var(--line-height-tight);\n}\n\n.mobile-item-size {\n  font-size: var(--font-size-xs);\n  color: var(--color-text-tertiary);\n}\n\n/* ===== MORE MENU ===== */\n\n.mobile-more-list {\n  display: flex;\n  flex-direction: column;\n  gap: var(--spacing-sm);\n}\n\n.mobile-more-item {\n  display: flex;\n  align-items: center;\n  gap: var(--spacing-lg);\n  padding: var(--spacing-lg);\n  background: var(--color-bg-elevated);\n  border: 1px solid var(--color-border);\n  border-radius: var(--radius-lg);\n  cursor: pointer;\n  transition: all var(--transition-fast);\n  min-height: var(--mobile-touch-target);\n}\n\n.mobile-more-item:active {\n  transform: scale(0.98);\n  background: var(--color-bg-secondary);\n}\n\n.mobile-more-item svg {\n  width: 24px;\n  height: 24px;\n  color: var(--color-text-secondary);\n  flex-shrink: 0;\n}\n\n.mobile-more-item span {\n  font-size: var(--font-size-base);\n  font-weight: var(--font-weight-medium);\n  color: var(--color-text-primary);\n}\n\n/* ===== MOBILE CANVAS ADJUSTMENTS ===== */\n\n@media (width <= 767px) {\n  .mobile-layout .mobile-show-canvas #canvas {\n    touch-action: none;\n  }\n\n  .mobile-layout .mobile-show-canvas .canvas-overlay-controls {\n    bottom: var(--spacing-lg);\n    right: var(--spacing-lg);\n  }\n}\n\n/* ===== ACCESSIBILITY ===== */\n\n@media (prefers-reduced-motion: reduce) {\n  .mobile-tab,\n  .mobile-tool-btn,\n  .mobile-floor-plan-card,\n  .mobile-item-card,\n  .mobile-more-item {\n    transition: none;\n  }\n}\n\n/* ===== LOADING STATES ===== */\n\n.mobile-view.loading {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  min-height: 200px;\n}\n\n.mobile-view.loading::after {\n  content: '';\n  width: 32px;\n  height: 32px;\n  border: 3px solid var(--color-border);\n  border-top-color: var(--color-primary);\n  border-radius: 50%;\n  animation: mobile-spin 0.8s linear infinite;\n}\n\n@keyframes mobile-spin {\n  to {\n    transform: rotate(360deg);\n  }\n}\n\n/* ===== SAFE AREA SUPPORT ===== */\n\n@supports (padding: env(safe-area-inset-bottom)) {\n  .mobile-tab-bar {\n    padding-bottom: calc(var(--spacing-sm) + env(safe-area-inset-bottom));\n  }\n\n  .mobile-layout .canvas-wrapper.mobile-show-canvas {\n    bottom: calc(var(--mobile-tab-height) + env(safe-area-inset-bottom));\n  }\n\n  .mobile-layout .mobile-content {\n    bottom: calc(var(--mobile-tab-height) + env(safe-area-inset-bottom));\n  }\n}\n\n/* ===== SAVED LAYOUTS ===== */\n\n.mobile-saved-list {\n  display: flex;\n  flex-direction: column;\n  gap: var(--spacing-md);\n}\n\n.mobile-saved-item {\n  background: var(--color-bg-elevated);\n  border: 1px solid var(--color-border);\n  border-radius: var(--radius-lg);\n  padding: var(--spacing-lg);\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  gap: var(--spacing-md);\n}\n\n.mobile-saved-info {\n  flex: 1;\n  min-width: 0;\n}\n\n.mobile-saved-name {\n  font-size: var(--font-size-base);\n  font-weight: var(--font-weight-semibold);\n  color: var(--color-text-primary);\n  margin-bottom: var(--spacing-xs);\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n.mobile-saved-date {\n  font-size: var(--font-size-sm);\n  color: var(--color-text-secondary);\n}\n\n.mobile-saved-actions {\n  display: flex;\n  gap: var(--spacing-sm);\n  flex-shrink: 0;\n}\n\n.mobile-btn-load,\n.mobile-btn-delete {\n  padding: var(--spacing-sm) var(--spacing-lg);\n  font-size: var(--font-size-sm);\n  font-weight: var(--font-weight-medium);\n  border-radius: var(--radius-md);\n  border: none;\n  cursor: pointer;\n  transition: all var(--transition-fast);\n  min-height: 36px;\n}\n\n.mobile-btn-load {\n  background: var(--color-primary);\n  color: white;\n}\n\n.mobile-btn-load:active {\n  background: var(--color-primary-dark);\n  transform: scale(0.95);\n}\n\n.mobile-btn-delete {\n  background: var(--color-bg);\n  color: var(--color-text-secondary);\n  border: 1px solid var(--color-border);\n}\n\n.mobile-btn-delete:active {\n  background: #fef2f2;\n  color: #dc2626;\n  border-color: #dc2626;\n  transform: scale(0.95);\n}\n\n.mobile-empty-state {\n  text-align: center;\n  padding: var(--spacing-4xl) var(--spacing-xl);\n  color: var(--color-text-tertiary);\n}\n\n.mobile-empty-state svg {\n  width: 48px;\n  height: 48px;\n  margin: 0 auto var(--spacing-lg) auto;\n  opacity: 0.4;\n}\n\n.mobile-empty-state p {\n  margin: 0;\n}\n\n/* ===== HIDE JSON EXPORT ON MOBILE ===== */\n\n.mobile-json-export {\n  display: none !important;\n}\n\n/* ===== PROJECT HEADER ===== */\n\n.mobile-project-header {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  height: 56px;\n  background: var(--color-bg-elevated);\n  border-bottom: 1px solid var(--color-border);\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  z-index: calc(var(--z-toolbar) + 1);\n  padding: 0 var(--spacing-lg);\n}\n\n.mobile-menu-btn {\n  width: 40px;\n  height: 40px;\n  background: none;\n  border: none;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  border-radius: var(--radius-md);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all var(--transition-fast);\n  flex-shrink: 0;\n}\n\n.mobile-menu-btn svg {\n  width: 24px;\n  height: 24px;\n}\n\n.mobile-menu-btn:active {\n  background: var(--color-bg-secondary);\n  transform: scale(0.95);\n}\n\n.mobile-project-name {\n  font-size: var(--font-size-lg);\n  font-weight: var(--font-weight-semibold);\n  color: var(--color-text-primary);\n  margin: 0;\n  cursor: pointer;\n  padding: var(--spacing-sm) var(--spacing-md);\n  border-radius: var(--radius-md);\n  transition: background var(--transition-fast);\n  flex: 1;\n  text-align: center;\n}\n\n.mobile-project-name:active {\n  background: var(--color-bg-secondary);\n}\n\n/* ===== TOP TAB STRIP ===== */\n\n.mobile-top-tabs {\n  position: fixed;\n  inset: 56px 0 calc(var(--mobile-tab-height) + var(--mobile-safe-area-bottom));\n  background: var(--color-bg);\n  z-index: var(--z-toolbar);\n  transform: translateX(0);\n  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  display: flex;\n  flex-direction: column;\n}\n\n.mobile-top-tabs.mobile-top-tabs-closed {\n  transform: translateX(-100%);\n}\n\n.mobile-top-tabs-strip {\n  display: flex;\n  background: var(--color-bg-elevated);\n  border-bottom: 1px solid var(--color-border);\n  padding: 0;\n}\n\n.mobile-top-tab {\n  flex: 1;\n  padding: var(--spacing-md) var(--spacing-sm);\n  background: none;\n  border: none;\n  border-bottom: 2px solid transparent;\n  font-size: var(--font-size-base);\n  font-weight: var(--font-weight-medium);\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  transition: all var(--transition-fast);\n}\n\n.mobile-top-tab.mobile-top-tab-active {\n  color: var(--color-primary);\n  border-bottom-color: var(--color-primary);\n}\n\n.mobile-top-tabs-content {\n  flex: 1;\n  overflow-y: auto;\n  -webkit-overflow-scrolling: touch;\n  padding: var(--spacing-lg);\n}\n\n/* ===== BOTTOM NAV 3-BUTTON LAYOUT ===== */\n\n@media (width <= 767px) {\n  .mobile-tab-bar {\n    justify-content: space-between;\n    padding: 0 var(--spacing-xl) var(--mobile-safe-area-bottom) var(--spacing-xl);\n  }\n\n  .mobile-tab {\n    flex: 0 1 auto;\n    min-width: 70px;\n  }\n\n  .mobile-tab-canvas {\n    position: relative;\n  }\n\n  .mobile-tab-canvas::before {\n    width: 40px;\n  }\n}\n\n/* ===== VIEW OPTIONS ===== */\n\n.mobile-view-options {\n  margin-top: var(--spacing-2xl);\n  padding-top: var(--spacing-2xl);\n  border-top: 1px solid var(--color-border);\n}\n\n.mobile-view-options h3 {\n  margin: 0 0 var(--spacing-lg) 0;\n  font-size: var(--font-size-lg);\n  font-weight: var(--font-weight-semibold);\n  color: var(--color-text-primary);\n}\n\n.mobile-toggle-group,\n.mobile-view-options-toggles {\n  display: grid;\n  grid-template-columns: 1fr;\n  gap: var(--spacing-sm);\n  margin-bottom: var(--spacing-xl);\n}\n\n.mobile-view-options-group h4 {\n  margin: 0 0 var(--spacing-md) 0;\n  font-size: var(--font-size-base);\n  font-weight: var(--font-weight-semibold);\n  color: var(--color-text-secondary);\n}\n\n.mobile-toggle-btn {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: var(--spacing-lg);\n  background: var(--color-bg-secondary);\n  border: 1px solid transparent;\n  border-radius: var(--radius-lg);\n  font-size: var(--font-size-base);\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  transition: all var(--transition-fast);\n}\n\n.mobile-toggle-btn:active {\n  transform: scale(0.98);\n  background: var(--color-bg-elevated);\n}\n\n.mobile-toggle-btn.mobile-toggle-active {\n  background: var(--color-primary-light);\n  border-color: var(--color-primary);\n  color: var(--color-primary);\n}\n\n.mobile-toggle-btn svg {\n  width: 20px;\n  height: 20px;\n  opacity: 0;\n  transition: opacity var(--transition-fast);\n}\n\n.mobile-toggle-btn.mobile-toggle-active svg {\n  opacity: 1;\n}\n\n.mobile-position-group,\n.mobile-view-options-positions {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: var(--spacing-sm);\n  margin-bottom: var(--spacing-xl);\n}\n\n.mobile-position-btn {\n  padding: var(--spacing-lg);\n  background: var(--color-bg-secondary);\n  border: 1px solid transparent;\n  border-radius: var(--radius-lg);\n  font-size: var(--font-size-base);\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  transition: all var(--transition-fast);\n  text-align: center;\n}\n\n.mobile-position-btn:active {\n  transform: scale(0.98);\n  background: var(--color-bg-elevated);\n}\n\n.mobile-position-btn.mobile-position-active {\n  background: var(--color-primary-light);\n  border-color: var(--color-primary);\n  color: var(--color-primary);\n  font-weight: var(--font-weight-semibold);\n}\n","size_bytes":18516},"js/ui/mobile/MobileUIManager.js":{"content":"/**\n * MobileUIManager - Professional Mobile Interface for Storage Caves\n *\n * Architecture:\n * - Dedicated mobile containers (no style.display manipulation)\n * - Class-based toggling (.mobile-active, .mobile-hide-desktop)\n * - Explicit mobile rendering (no desktop tab .click() triggers)\n * - Uses existing managers through public APIs\n * - Clean teardown on viewport change\n */\n\nclass MobileUIManager {\n  constructor(app) {\n    this.app = app;\n    this.state = app.state;\n    this.eventBus = app.eventBus;\n\n    // Manager references\n    this.floorPlanManager = null;\n    this.itemManager = null;\n    this.canvasManager = null;\n    this.historyManager = null;\n    this.selectionManager = null;\n\n    // Mobile state\n    this.activeTab = 'canvas';\n    this.isMobile = false;\n    this.initialized = false;\n    this.topTabOpen = false;\n    this.lastTopTab = 'floorplans';\n\n    // Mobile containers\n    this.mobileContainer = null;\n    this.tabBar = null;\n    this.mobileToolbar = null;\n    this.moreMenu = null;\n\n    // Media query\n    this.mediaQuery = window.matchMedia('(max-width: 767px)');\n\n    // Bind methods\n    this.handleMediaChange = this.handleMediaChange.bind(this);\n    this.handleTabClick = this.handleTabClick.bind(this);\n  }\n\n  /**\n   * Initialize mobile UI (only if mobile viewport)\n   */\n  init() {\n    this.isMobile = this.mediaQuery.matches;\n\n    if (!this.isMobile) {\n      console.log('[MobileUI] Desktop viewport detected');\n      return;\n    }\n\n    if (this.initialized) return;\n\n    console.log('[MobileUI] Initializing mobile interface');\n\n    // Wait for managers\n    setTimeout(() => {\n      this.cacheManagers();\n      this.createMobileContainers();\n      this.applyMobileClasses();\n      this.setupEventListeners();\n      this.renderInitialTab();\n      this.initialized = true;\n      console.log('[MobileUI] Mobile interface ready');\n    }, 100);\n\n    // Listen for viewport changes\n    this.mediaQuery.addEventListener('change', this.handleMediaChange);\n  }\n\n  /**\n   * Cache manager references\n   */\n  cacheManagers() {\n    this.floorPlanManager = this.app.floorPlanManager;\n    this.itemManager = this.app.itemManager;\n    this.canvasManager = this.app.canvasManager;\n    this.historyManager = this.app.historyManager;\n    this.selectionManager = this.app.selectionManager;\n  }\n\n  /**\n   * Create dedicated mobile containers\n   */\n  createMobileContainers() {\n    // Main mobile container\n    this.mobileContainer = document.createElement('div');\n    this.mobileContainer.id = 'mobile-ui-container';\n    this.mobileContainer.className = 'mobile-ui-container';\n\n    // Mobile content area with project header and top tabs\n    this.mobileContainer.innerHTML = `\n      <div id=\"mobile-project-header\" class=\"mobile-project-header\">\n        <button id=\"mobile-menu-btn\" class=\"mobile-menu-btn\" title=\"Open menu\">\n          <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n            <line x1=\"3\" y1=\"12\" x2=\"21\" y2=\"12\"/><line x1=\"3\" y1=\"6\" x2=\"21\" y2=\"6\"/><line x1=\"3\" y1=\"18\" x2=\"21\" y2=\"18\"/>\n          </svg>\n        </button>\n        <h1 id=\"mobile-project-name\" class=\"mobile-project-name\">Untitled Layout</h1>\n      </div>\n      <div id=\"mobile-top-tabs\" class=\"mobile-top-tabs\">\n        <div class=\"mobile-top-tabs-strip\">\n          <button class=\"mobile-top-tab mobile-top-tab-active\" data-top-tab=\"floorplans\">Floor Plans</button>\n          <button class=\"mobile-top-tab\" data-top-tab=\"items\">Items</button>\n          <button class=\"mobile-top-tab\" data-top-tab=\"saved\">Saved</button>\n        </div>\n        <div class=\"mobile-top-tabs-content\">\n          <div id=\"mobile-floor-plans-view\" class=\"mobile-view mobile-view-active\"></div>\n          <div id=\"mobile-items-view\" class=\"mobile-view\"></div>\n          <div id=\"mobile-saved-view\" class=\"mobile-view\"></div>\n        </div>\n      </div>\n      <div id=\"mobile-content\" class=\"mobile-content\">\n        <div id=\"mobile-more-view\" class=\"mobile-view\"></div>\n      </div>\n    `;\n\n    document.body.appendChild(this.mobileContainer);\n\n    // Create bottom tab bar\n    this.createTabBar();\n\n    // Create mobile toolbar (for canvas actions - now will be FAB)\n    this.createMobileToolbar();\n\n    // Setup project name editing\n    this.setupProjectName();\n\n    // Setup top tab listeners\n    this.setupTopTabs();\n  }\n\n  /**\n   * Apply mobile CSS classes (no style.display)\n   */\n  applyMobileClasses() {\n    document.body.classList.add('mobile-layout');\n\n    // Mark desktop elements to hide on mobile (via CSS)\n    const desktopElements = ['.sidebar', '.toolbar', '.header', '.info-bar'];\n\n    desktopElements.forEach((selector) => {\n      const el = document.querySelector(selector);\n      if (el) el.classList.add('mobile-hide-desktop');\n    });\n  }\n\n  /**\n   * Create bottom tab navigation\n   */\n  createTabBar() {\n    this.tabBar = document.createElement('nav');\n    this.tabBar.id = 'mobile-tab-bar';\n    this.tabBar.className = 'mobile-tab-bar';\n    this.tabBar.innerHTML = `\n      <button class=\"mobile-tab\" data-action=\"new-layout\">\n        <svg class=\"mobile-tab-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n          <line x1=\"12\" y1=\"5\" x2=\"12\" y2=\"19\"/><line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\"/>\n        </svg>\n        <span>New</span>\n      </button>\n      <button class=\"mobile-tab mobile-tab-active mobile-tab-canvas\" data-tab=\"canvas\">\n        <svg class=\"mobile-tab-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n          <path d=\"M12 19l7-7 3 3-7 7-3-3z\"/><path d=\"M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z\"/>\n        </svg>\n        <span>Canvas</span>\n      </button>\n      <button class=\"mobile-tab\" data-tab=\"more\">\n        <svg class=\"mobile-tab-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n          <line x1=\"3\" y1=\"12\" x2=\"21\" y2=\"12\"/><line x1=\"3\" y1=\"6\" x2=\"21\" y2=\"6\"/><line x1=\"3\" y1=\"18\" x2=\"21\" y2=\"18\"/>\n        </svg>\n        <span>More</span>\n      </button>\n    `;\n\n    document.body.appendChild(this.tabBar);\n  }\n\n  /**\n   * Create mobile toolbar for canvas actions\n   */\n  createMobileToolbar() {\n    const fab = document.createElement('button');\n    fab.id = 'mobile-fab';\n    fab.className = 'mobile-fab';\n    fab.innerHTML = `\n      <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n        <circle cx=\"12\" cy=\"12\" r=\"10\"/><line x1=\"12\" y1=\"8\" x2=\"12\" y2=\"16\"/><line x1=\"8\" y1=\"12\" x2=\"16\" y2=\"12\"/>\n      </svg>\n    `;\n\n    this.mobileToolbar = document.createElement('div');\n    this.mobileToolbar.id = 'mobile-action-panel';\n    this.mobileToolbar.className = 'mobile-action-panel';\n    this.mobileToolbar.innerHTML = `\n      <div class=\"mobile-action-panel-header\">\n        <h3>Canvas Actions</h3>\n        <button class=\"mobile-action-close\" aria-label=\"Close\">\n          <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n            <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"/><line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"/>\n          </svg>\n        </button>\n      </div>\n      <div class=\"mobile-action-panel-grid\">\n        <button class=\"mobile-action-btn\" data-action=\"zoom-in\">\n          <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n            <circle cx=\"11\" cy=\"11\" r=\"8\"/><line x1=\"21\" y1=\"21\" x2=\"16.65\" y2=\"16.65\"/><line x1=\"11\" y1=\"8\" x2=\"11\" y2=\"14\"/><line x1=\"8\" y1=\"11\" x2=\"14\" y2=\"11\"/>\n          </svg>\n          <span>Zoom In</span>\n        </button>\n        <button class=\"mobile-action-btn\" data-action=\"zoom-out\">\n          <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n            <circle cx=\"11\" cy=\"11\" r=\"8\"/><line x1=\"21\" y1=\"21\" x2=\"16.65\" y2=\"16.65\"/><line x1=\"8\" y1=\"11\" x2=\"14\" y2=\"11\"/>\n          </svg>\n          <span>Zoom Out</span>\n        </button>\n        <button class=\"mobile-action-btn\" data-action=\"fit-view\">\n          <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n            <path d=\"M8 3H5a2 2 0 00-2 2v3m18 0V5a2 2 0 00-2-2h-3m0 18h3a2 2 0 002-2v-3M3 16v3a2 2 0 002 2h3\"/>\n          </svg>\n          <span>Fit View</span>\n        </button>\n        <button class=\"mobile-action-btn\" data-action=\"rotate\">\n          <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n            <polyline points=\"23 4 23 10 17 10\"/><path d=\"M20.49 15a9 9 0 11-2.12-9.36L23 10\"/>\n          </svg>\n          <span>Rotate</span>\n        </button>\n        <button class=\"mobile-action-btn\" data-action=\"duplicate\">\n          <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n            <rect x=\"9\" y=\"9\" width=\"13\" height=\"13\" rx=\"2\"/><path d=\"M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1\"/>\n          </svg>\n          <span>Duplicate</span>\n        </button>\n        <button class=\"mobile-action-btn\" data-action=\"delete\">\n          <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n            <polyline points=\"3 6 5 6 21 6\"/><path d=\"M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2\"/>\n          </svg>\n          <span>Delete</span>\n        </button>\n        <button class=\"mobile-action-btn\" data-action=\"bring-front\">\n          <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n            <polyline points=\"17 11 12 6 7 11\"/><polyline points=\"17 18 12 13 7 18\"/>\n          </svg>\n          <span>Bring Front</span>\n        </button>\n        <button class=\"mobile-action-btn\" data-action=\"send-back\">\n          <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n            <polyline points=\"7 13 12 18 17 13\"/><polyline points=\"7 6 12 11 17 6\"/>\n          </svg>\n          <span>Send Back</span>\n        </button>\n      </div>\n    `;\n\n    fab.addEventListener('click', () => {\n      this.mobileToolbar.classList.toggle('mobile-action-panel-open');\n    });\n\n    const closeBtn = this.mobileToolbar.querySelector('.mobile-action-close');\n    closeBtn.addEventListener('click', () => {\n      this.mobileToolbar.classList.remove('mobile-action-panel-open');\n    });\n\n    document.body.appendChild(fab);\n    document.body.appendChild(this.mobileToolbar);\n  }\n\n  /**\n   * Setup event listeners\n   */\n  setupEventListeners() {\n    // Tab navigation\n    if (this.tabBar) {\n      this.tabBar.addEventListener('click', this.handleTabClick);\n    }\n\n    // Toolbar actions\n    if (this.mobileToolbar) {\n      this.mobileToolbar.addEventListener('click', (e) => {\n        const btn = e.target.closest('.mobile-action-btn');\n        if (btn) this.handleToolAction(btn.dataset.action);\n      });\n    }\n\n    // Listen to manager events\n    this.eventBus.on('floorplan:changed', () => this.onFloorPlanSelected());\n    this.eventBus.on('item:added', () => this.onItemAdded());\n  }\n\n  /**\n   * Setup project name editing\n   */\n  setupProjectName() {\n    const projectName = document.getElementById('mobile-project-name');\n    const menuBtn = document.getElementById('mobile-menu-btn');\n\n    if (projectName) {\n      // Update from state\n      const metadata = this.state.get('metadata') || {};\n      projectName.textContent = metadata.projectName || 'Untitled Layout';\n\n      // Click to edit\n      projectName.addEventListener('click', async () => {\n        const currentMetadata = this.state.get('metadata') || {};\n        const newName = await window.Modal?.showPrompt(\n          'Rename Layout',\n          'Enter a name for your layout:',\n          currentMetadata.projectName || 'Untitled Layout',\n        );\n        if (newName && newName.trim()) {\n          this.state.set('metadata', { ...currentMetadata, projectName: newName.trim() });\n          projectName.textContent = newName.trim();\n        }\n      });\n    }\n\n    // Menu button to toggle top tabs\n    if (menuBtn) {\n      menuBtn.addEventListener('click', () => {\n        // Toggle top tabs visibility\n        if (this.topTabOpen) {\n          this.closeTopTabs();\n        } else {\n          // switchTopTab will open tabs with forceOpen=true by default\n          this.switchTopTab(this.lastTopTab || 'floorplans');\n        }\n      });\n    }\n  }\n\n  /**\n   * Setup top tab strip listeners\n   */\n  setupTopTabs() {\n    const topTabsStrip = document.querySelector('.mobile-top-tabs-strip');\n    if (!topTabsStrip) return;\n\n    topTabsStrip.addEventListener('click', (e) => {\n      const tab = e.target.closest('.mobile-top-tab');\n      if (!tab) return;\n\n      const tabName = tab.dataset.topTab;\n      this.switchTopTab(tabName);\n    });\n  }\n\n  /**\n   * Switch top tabs (Floor Plans / Items / Saved)\n   * @param {string} tabName - The tab to switch to\n   * @param {Object} options - Options for tab switching\n   * @param {boolean} options.forceOpen - Whether to force open the top tabs (default: true)\n   */\n  switchTopTab(tabName, { forceOpen = true } = {}) {\n    this.lastTopTab = tabName;\n\n    // Update tab active state\n    document.querySelectorAll('.mobile-top-tab').forEach((t) => {\n      t.classList.toggle('mobile-top-tab-active', t.dataset.topTab === tabName);\n    });\n\n    // Update views\n    const views = document.querySelectorAll('#mobile-top-tabs .mobile-view');\n    views.forEach((v) => v.classList.remove('mobile-view-active'));\n\n    if (tabName === 'floorplans') {\n      document.getElementById('mobile-floor-plans-view')?.classList.add('mobile-view-active');\n      this.renderFloorPlans();\n    } else if (tabName === 'items') {\n      document.getElementById('mobile-items-view')?.classList.add('mobile-view-active');\n      this.renderItems();\n    } else if (tabName === 'saved') {\n      document.getElementById('mobile-saved-view')?.classList.add('mobile-view-active');\n      this.renderSaved();\n    }\n\n    // Conditionally open top tabs if requested\n    if (forceOpen) {\n      this.openTopTabs();\n    }\n  }\n\n  /**\n   * Open top tabs sheet (slide right animation)\n   */\n  openTopTabs() {\n    const topTabsSheet = document.getElementById('mobile-top-tabs');\n    if (topTabsSheet) {\n      topTabsSheet.classList.remove('mobile-top-tabs-closed');\n      this.topTabOpen = true;\n    }\n  }\n\n  /**\n   * Close top tabs sheet (slide left animation)\n   */\n  closeTopTabs() {\n    const topTabsSheet = document.getElementById('mobile-top-tabs');\n    if (topTabsSheet) {\n      topTabsSheet.classList.add('mobile-top-tabs-closed');\n      this.topTabOpen = false;\n    }\n  }\n\n  /**\n   * Handle tab click\n   */\n  handleTabClick(e) {\n    const tab = e.target.closest('.mobile-tab');\n    if (!tab) return;\n\n    // Handle new layout action\n    if (tab.dataset.action === 'new-layout') {\n      this.handleNewLayout();\n      return;\n    }\n\n    const tabName = tab.dataset.tab;\n    if (tabName) {\n      this.switchTab(tabName);\n    }\n  }\n\n  /**\n   * Switch tabs\n   */\n  switchTab(tabName) {\n    // Update bottom tab bar active states\n    const tabs = this.tabBar?.querySelectorAll('.mobile-tab');\n    tabs?.forEach((t) => {\n      t.classList.toggle('mobile-tab-active', t.dataset.tab === tabName);\n    });\n\n    // Get key elements\n    const canvasWrapper = document.querySelector('.canvas-wrapper');\n    const mobileContent = document.getElementById('mobile-content');\n\n    if (tabName === 'canvas') {\n      // Show canvas, hide content views, close top tabs\n      if (canvasWrapper) canvasWrapper.classList.add('mobile-show-canvas');\n      if (mobileContent) mobileContent.classList.remove('mobile-show-content');\n      this.closeTopTabs();\n\n      // Defer canvas resize/fit until visible\n      requestAnimationFrame(() => {\n        this.canvasManager?.resizeCanvas();\n        if (this.canvasManager?.isAutoFitMode) {\n          this.canvasManager?.centerAndFit();\n        }\n      });\n    } \n    else if (tabName === 'more') {\n      // Hide canvas, show content, close top tabs, show More view\n      if (canvasWrapper) canvasWrapper.classList.remove('mobile-show-canvas');\n      if (mobileContent) mobileContent.classList.add('mobile-show-content');\n      this.closeTopTabs();\n\n      const views = document.querySelectorAll('.mobile-view');\n      views.forEach((v) => v.classList.remove('mobile-view-active'));\n      document.getElementById('mobile-more-view')?.classList.add('mobile-view-active');\n      this.renderMore();\n    }\n    else if (tabName === 'floorplans' || tabName === 'items' || tabName === 'saved') {\n      // Hide canvas, show content, show specific view\n      if (canvasWrapper) canvasWrapper.classList.remove('mobile-show-canvas');\n      if (mobileContent) mobileContent.classList.add('mobile-show-content');\n\n      // Switch to the specific top tab view (will open tabs with forceOpen=true by default)\n      this.switchTopTab(tabName);\n    }\n  }\n\n  /**\n   * Handle new layout button click\n   */\n  handleNewLayout() {\n    const btn = document.querySelector('#btn-new');\n    if (btn) btn.click();\n  }\n\n  /**\n   * Render initial tab\n   */\n  renderInitialTab() {\n    // Initialize topTabOpen to match DOM state (tabs start open)\n    this.topTabOpen = true;\n    // Render floor plans (tabs already open by default)\n    this.switchTopTab('floorplans');\n  }\n\n  /**\n   * Render floor plans view\n   */\n  renderFloorPlans() {\n    const container = document.getElementById('mobile-floor-plans-view');\n    if (!container) return;\n\n    // Get floor plans from manager (NOT window.FLOOR_PLANS)\n    const floorPlans = this.floorPlanManager?.getAllFloorPlans() || [];\n    const currentPlan = this.state.get('floorPlan');\n\n    container.innerHTML = `\n      <div class=\"mobile-view-header\">\n        <h2>Floor Plans</h2>\n        <p>Select a garage layout</p>\n      </div>\n      <div class=\"mobile-floor-plan-list\">\n        ${floorPlans\n          .map(\n            (plan) => `\n          <button class=\"mobile-floor-plan-card ${currentPlan?.id === plan.id ? 'mobile-card-selected' : ''}\" \n                  data-floor-plan-id=\"${plan.id}\">\n            <h3>${plan.name}</h3>\n            <div class=\"mobile-card-meta\">\n              <span>${plan.widthFt}' × ${plan.heightFt}'</span>\n              <span>Door: ${plan.description}</span>\n              <span>${plan.area} sq ft</span>\n            </div>\n          </button>\n        `,\n          )\n          .join('')}\n      </div>\n    `;\n\n    // Setup floor plan click handlers\n    container.querySelectorAll('.mobile-floor-plan-card').forEach((card) => {\n      card.addEventListener('click', () => {\n        const planId = card.dataset.floorPlanId;\n        this.selectFloorPlan(planId);\n      });\n    });\n  }\n\n  /**\n   * Render items view\n   */\n  renderItems() {\n    const container = document.getElementById('mobile-items-view');\n    if (!container || !this.itemManager) return;\n\n    // Get items from Items.getAll() (loaded from js/data/items.js)\n    const items = window.Items?.getAll() || [];\n\n    container.innerHTML = `\n      <div class=\"mobile-view-header\">\n        <h2>Items</h2>\n        <p>Add items to your layout</p>\n      </div>\n      <div class=\"mobile-item-list\">\n        ${items\n          .map(\n            (item) => `\n          <button class=\"mobile-item-card\" data-item-id=\"${item.id}\">\n            <div class=\"mobile-card-image\">\n              <img src=\"${item.paletteImage}\" alt=\"${item.label}\" loading=\"lazy\" onerror=\"this.style.display='none'\">\n            </div>\n            <h4>${item.label}</h4>\n            <span class=\"mobile-item-size\">${item.lengthFt}' × ${item.widthFt}'</span>\n          </button>\n        `,\n          )\n          .join('')}\n      </div>\n    `;\n\n    // Setup item click handlers\n    container.querySelectorAll('.mobile-item-card').forEach((card) => {\n      card.addEventListener('click', () => {\n        const itemId = card.dataset.itemId;\n        this.addItem(itemId);\n      });\n    });\n  }\n\n  /**\n   * Render more menu\n   */\n  renderMore() {\n    const container = document.getElementById('mobile-more-view');\n    if (!container) return;\n\n    // Read current settings state\n    const settings = this.state.get('settings') || {};\n    const showGrid = settings.showGrid !== undefined ? settings.showGrid : true;\n    const showEntryZoneLabel =\n      settings.showEntryZoneLabel !== undefined ? settings.showEntryZoneLabel : true;\n    const showEntryZoneBorder =\n      settings.showEntryZoneBorder !== undefined ? settings.showEntryZoneBorder : true;\n    const entryZonePosition = settings.entryZonePosition || 'bottom';\n\n    container.innerHTML = `\n      <div class=\"mobile-view-header\">\n        <h2>Actions</h2>\n        <p>Export and manage your layout</p>\n      </div>\n      <div class=\"mobile-more-list\">\n        <button class=\"mobile-more-item\" data-action=\"save-layout\">\n          <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <path d=\"M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z\"/>\n            <polyline points=\"17 21 17 13 7 13 7 21\"/>\n            <polyline points=\"7 3 7 8 15 8\"/>\n          </svg>\n          <span>Save Layout</span>\n        </button>\n        <button class=\"mobile-more-item\" data-action=\"export-png\">\n          <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <path d=\"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4\"/>\n            <polyline points=\"7 10 12 15 17 10\"/><line x1=\"12\" y1=\"15\" x2=\"12\" y2=\"3\"/>\n          </svg>\n          <span>Export as PNG</span>\n        </button>\n        <button class=\"mobile-more-item\" data-action=\"export-pdf\">\n          <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <path d=\"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z\"/>\n            <polyline points=\"14 2 14 8 20 8\"/>\n          </svg>\n          <span>Export as PDF</span>\n        </button>\n        <button class=\"mobile-more-item mobile-json-export\" data-action=\"export-json\">\n          <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <path d=\"M13 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V9z\"/>\n          </svg>\n          <span>Export as JSON</span>\n        </button>\n        <button class=\"mobile-more-item\" data-action=\"share-email\">\n          <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <path d=\"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z\"/>\n            <polyline points=\"22,6 12,13 2,6\"/>\n          </svg>\n          <span>Share via Email</span>\n        </button>\n      </div>\n      <div class=\"mobile-view-options\">\n        <h3>View Options</h3>\n        <div class=\"mobile-view-options-group\">\n          <h4>Display</h4>\n          <div class=\"mobile-view-options-toggles\">\n            <button class=\"mobile-toggle-btn ${showGrid ? 'mobile-toggle-active' : ''}\" data-action=\"toggle-grid\">\n              <span>Grid</span>\n              ${showGrid ? '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><polyline points=\"20 6 9 17 4 12\"/></svg>' : ''}\n            </button>\n            <button class=\"mobile-toggle-btn ${showEntryZoneLabel ? 'mobile-toggle-active' : ''}\" data-action=\"toggle-entry-label\">\n              <span>Entry Label</span>\n              ${showEntryZoneLabel ? '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><polyline points=\"20 6 9 17 4 12\"/></svg>' : ''}\n            </button>\n            <button class=\"mobile-toggle-btn ${showEntryZoneBorder ? 'mobile-toggle-active' : ''}\" data-action=\"toggle-entry-border\">\n              <span>Entry Border</span>\n              ${showEntryZoneBorder ? '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><polyline points=\"20 6 9 17 4 12\"/></svg>' : ''}\n            </button>\n          </div>\n        </div>\n        <div class=\"mobile-view-options-group\">\n          <h4>Entry Zone Position</h4>\n          <div class=\"mobile-view-options-positions\">\n            <button class=\"mobile-position-btn ${entryZonePosition === 'bottom' ? 'mobile-position-active' : ''}\" data-action=\"set-entry-position\" data-position=\"bottom\">Bottom</button>\n            <button class=\"mobile-position-btn ${entryZonePosition === 'left' ? 'mobile-position-active' : ''}\" data-action=\"set-entry-position\" data-position=\"left\">Left</button>\n            <button class=\"mobile-position-btn ${entryZonePosition === 'right' ? 'mobile-position-active' : ''}\" data-action=\"set-entry-position\" data-position=\"right\">Right</button>\n            <button class=\"mobile-position-btn ${entryZonePosition === 'top' ? 'mobile-position-active' : ''}\" data-action=\"set-entry-position\" data-position=\"top\">Top</button>\n          </div>\n        </div>\n      </div>\n    `;\n\n    // Setup more item click handlers\n    container.querySelectorAll('.mobile-more-item').forEach((item) => {\n      item.addEventListener('click', () => {\n        this.handleMoreAction(item.dataset.action);\n      });\n    });\n\n    // Setup View Options handlers\n    container.querySelectorAll('.mobile-toggle-btn').forEach((btn) => {\n      btn.addEventListener('click', () => {\n        this.handleViewOptionToggle(btn.dataset.action);\n      });\n    });\n\n    container.querySelectorAll('.mobile-position-btn').forEach((btn) => {\n      btn.addEventListener('click', () => {\n        this.handleEntryPositionChange(btn.dataset.position);\n      });\n    });\n  }\n\n  /**\n   * Render saved layouts\n   */\n  renderSaved() {\n    const container = document.getElementById('mobile-saved-view');\n    if (!container) return;\n\n    const layouts = window.Storage?.load(window.Config?.STORAGE_KEYS?.layouts) || [];\n\n    container.innerHTML = `\n      <div class=\"mobile-view-header\">\n        <h2>Saved Layouts</h2>\n        <p>Load or manage saved layouts</p>\n      </div>\n      <div class=\"mobile-saved-list\">\n        ${\n          layouts.length === 0\n            ? `\n          <div class=\"mobile-empty-state\">\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n              <path d=\"M19 21l-7-5-7 5V5a2 2 0 012-2h10a2 2 0 012 2z\"/>\n            </svg>\n            <p>No saved layouts</p>\n            <p style=\"font-size: 12px; margin-top: 8px;\">Save your current layout from the More tab</p>\n          </div>\n        `\n            : layouts\n                .map(\n                  (layout) => `\n          <div class=\"mobile-saved-item\">\n            <div class=\"mobile-saved-info\">\n              <div class=\"mobile-saved-name\">${layout.name}</div>\n              <div class=\"mobile-saved-date\">${new Date(layout.created).toLocaleDateString()}</div>\n            </div>\n            <div class=\"mobile-saved-actions\">\n              <button class=\"mobile-btn-load\" data-layout-id=\"${layout.id}\">Load</button>\n              <button class=\"mobile-btn-delete\" data-layout-id=\"${layout.id}\">Delete</button>\n            </div>\n          </div>\n        `,\n                )\n                .join('')\n        }\n      </div>\n    `;\n\n    // Setup load handlers\n    container.querySelectorAll('.mobile-btn-load').forEach((btn) => {\n      btn.addEventListener('click', () => {\n        const layoutId = btn.dataset.layoutId;\n        if (this.app && this.app.loadLayout) {\n          this.app.loadLayout(layoutId);\n          // Close top tabs and switch to canvas\n          this.closeTopTabs();\n          setTimeout(() => this.switchTab('canvas'), 300);\n        }\n      });\n    });\n\n    // Setup delete handlers\n    container.querySelectorAll('.mobile-btn-delete').forEach((btn) => {\n      btn.addEventListener('click', async () => {\n        const layoutId = btn.dataset.layoutId;\n        if (this.app && this.app.deleteLayout) {\n          const confirmed = await window.Modal?.showConfirm(\n            'Delete Layout?',\n            'Are you sure you want to delete this layout? This cannot be undone.',\n          );\n          if (confirmed) {\n            this.app.deleteLayout(layoutId);\n            // Re-render after delete\n            this.renderSaved();\n          }\n        }\n      });\n    });\n  }\n\n  /**\n   * Select floor plan\n   */\n  selectFloorPlan(planId) {\n    if (this.floorPlanManager) {\n      this.floorPlanManager.setFloorPlan(planId);\n    }\n  }\n\n  /**\n   * Add item to canvas\n   */\n  addItem(itemId) {\n    if (this.itemManager) {\n      this.itemManager.addItem(itemId);\n    }\n  }\n\n  /**\n   * Handle toolbar actions\n   */\n  handleToolAction(action) {\n    switch (action) {\n      case 'zoom-in':\n        this.canvasManager?.zoomIn();\n        break;\n      case 'zoom-out':\n        this.canvasManager?.zoomOut();\n        break;\n      case 'fit-view':\n        this.canvasManager?.centerAndFit();\n        break;\n      case 'rotate': {\n        const selection = this.canvasManager?.getCanvas()?.getActiveObjects() || [];\n        selection.forEach((item) => {\n          const currentAngle = item.angle || 0;\n          item.rotate(currentAngle + 90);\n        });\n        this.canvasManager?.getCanvas()?.renderAll();\n        break;\n      }\n      case 'duplicate':\n        this.canvasManager\n          ?.getCanvas()\n          ?.getActiveObjects()\n          .forEach((item) => {\n            if (item.customData?.id) {\n              this.itemManager?.duplicateItem(item.customData.id);\n            }\n          });\n        break;\n      case 'delete':\n        this.canvasManager\n          ?.getCanvas()\n          ?.getActiveObjects()\n          .forEach((item) => {\n            if (item.customData?.id) {\n              this.itemManager?.removeItem(item.customData.id);\n            }\n          });\n        break;\n      case 'bring-front':\n        if (this.selectionManager) {\n          this.selectionManager.bringToFront();\n        }\n        break;\n      case 'send-back':\n        if (this.selectionManager) {\n          this.selectionManager.sendToBack();\n        }\n        break;\n    }\n    // Close action panel after action\n    this.mobileToolbar?.classList.remove('mobile-action-panel-open');\n  }\n\n  /**\n   * Handle more menu actions\n   */\n  async handleMoreAction(action) {\n    if (action === 'save-layout') {\n      await this.saveMobileLayout();\n      return;\n    }\n\n    const actions = {\n      'export-png': '#btn-export-png',\n      'export-pdf': '#btn-export-pdf',\n      'export-json': '#btn-export-json',\n      'share-email': '#btn-share-email',\n      new: '#btn-new',\n    };\n\n    const btn = document.querySelector(actions[action]);\n    if (btn) {\n      btn.click();\n      // Switch to canvas after export actions\n      if (action.startsWith('export-')) {\n        this.switchTab('canvas');\n      }\n    }\n  }\n\n  /**\n   * Handle View Options toggle actions\n   */\n  handleViewOptionToggle(action) {\n    const settings = this.state.get('settings') || {};\n\n    switch (action) {\n      case 'toggle-grid':\n        if (this.canvasManager && this.canvasManager.toggleGrid) {\n          this.canvasManager.toggleGrid();\n        }\n        this.switchTab('canvas');\n        break;\n\n      case 'toggle-entry-label':\n        settings.showEntryZoneLabel = !settings.showEntryZoneLabel;\n        this.state.set('settings', settings);\n        this.redrawFloorPlan();\n        this.switchTab('canvas');\n        break;\n\n      case 'toggle-entry-border':\n        settings.showEntryZoneBorder = !settings.showEntryZoneBorder;\n        this.state.set('settings', settings);\n        this.redrawFloorPlan();\n        this.switchTab('canvas');\n        break;\n    }\n  }\n\n  /**\n   * Handle Entry Zone position change\n   */\n  handleEntryPositionChange(position) {\n    const settings = this.state.get('settings') || {};\n    settings.entryZonePosition = position;\n    this.state.set('settings', settings);\n    this.redrawFloorPlan();\n    this.switchTab('canvas');\n  }\n\n  /**\n   * Redraw floor plan\n   */\n  redrawFloorPlan() {\n    const floorPlan = this.state.get('floorPlan');\n    if (floorPlan && this.canvasManager && this.canvasManager.drawFloorPlan) {\n      this.canvasManager.drawFloorPlan(floorPlan);\n    }\n  }\n\n  /**\n   * Event handlers\n   */\n  onFloorPlanSelected() {\n    // Close top tabs and switch to canvas after selecting floor plan\n    this.closeTopTabs();\n    setTimeout(() => this.switchTab('canvas'), 300);\n  }\n\n  onItemAdded() {\n    // Close top tabs and switch to canvas after adding item\n    this.closeTopTabs();\n    setTimeout(() => this.switchTab('canvas'), 300);\n  }\n\n  /**\n   * Handle viewport change\n   */\n  handleMediaChange(e) {\n    if (e.matches && !this.initialized) {\n      this.init();\n    } else if (!e.matches && this.initialized) {\n      this.destroy();\n    }\n  }\n\n  /**\n   * Save layout (mobile-specific implementation)\n   */\n  async saveMobileLayout() {\n    try {\n      // Show one-time warning if storage is not fully persistent\n      if (window.Storage && !window.Storage.isPersistent && !window._storageWarningShown) {\n        window._storageWarningShown = true;\n        const mode = window.Storage.mode;\n        if (mode === 'session') {\n          window.Modal?.showInfo('Your layouts will be saved for this session, but will be cleared when you close this tab');\n        } else if (mode === 'memory') {\n          window.Modal?.showInfo('Your layouts will only be saved temporarily and will be lost when you reload this page');\n        }\n      }\n\n      // Close More menu BEFORE showing prompt to prevent z-index blocking\n      // Modal overlay (z-index 999) needs to be above More menu (z-index 1000)\n      this.switchTab('canvas');\n\n      // Small delay to ensure More menu animation completes\n      await new Promise(resolve => setTimeout(resolve, 100));\n\n      // Get layout name from user\n      const name = await window.Modal?.showPrompt('Save Layout', 'Enter layout name:');\n      if (!name || !name.trim()) {\n        // User cancelled or entered empty name - throw to trigger catch\n        throw new Error('Save cancelled');\n      }\n\n      const state = this.state.getState();\n      const layouts = window.Storage?.load(window.Config?.STORAGE_KEYS?.layouts) || [];\n\n      layouts.push({\n        id: window.Helpers.generateId('layout'),\n        name: name.trim(),\n        created: new Date().toISOString(),\n        state: state,\n        thumbnail: this.app.exportManager?.generateThumbnail() || null,\n      });\n\n      const saved = window.Storage?.save(window.Config?.STORAGE_KEYS?.layouts, layouts);\n      if (!saved) {\n        // Save failed - throw to trigger catch\n        window.Modal?.showError('Failed to save layout - storage error');\n        throw new Error('Save failed');\n      }\n\n      // Success! Show message and refresh list\n      window.Modal?.showSuccess('Layout saved successfully!');\n      this.app.renderSavedLayouts?.();\n      // Stay on canvas - user likely wants to continue working\n      \n    } catch (error) {\n      // Any cancellation, dismissal, or error - return to More menu\n      // This handles: cancel button, overlay click, back button, save errors\n      this.switchTab('more');\n    }\n  }\n\n  /**\n   * Clean up mobile UI\n   */\n  destroy() {\n    console.log('[MobileUI] Destroying mobile interface');\n\n    // Remove mobile classes\n    document.body.classList.remove('mobile-layout');\n\n    // Remove mobile-hide-desktop classes\n    document.querySelectorAll('.mobile-hide-desktop').forEach((el) => {\n      el.classList.remove('mobile-hide-desktop');\n    });\n\n    // Remove mobile containers\n    this.mobileContainer?.remove();\n    this.tabBar?.remove();\n    this.mobileToolbar?.remove();\n\n    this.initialized = false;\n  }\n}\n\nwindow.MobileUIManager = MobileUIManager;\n","size_bytes":35935}},"version":2}